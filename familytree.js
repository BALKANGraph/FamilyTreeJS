FamilyTree.prototype.expand=function(e,t,i){var r={id:e,ids:t};this._draw(!1,FamilyTree.action.expand,r,i)},FamilyTree.prototype.collapse=function(e,t,i){var r={id:e,ids:t};this._draw(!1,FamilyTree.action.collapse,r,i)},FamilyTree.prototype.changeRoots=function(e,t,i){this.config.roots=t;var r={id:e};this._draw(!1,FamilyTree.action.update,r,i)},FamilyTree.prototype.expandCollapse=function(e,t,i,r){Array.isArray(t)||(t=[]),Array.isArray(i)||(i=[]);var a={id:e,expandIds:t,collapseIds:i,ids:t.concat(i)};this._draw(!1,FamilyTree.action.collapse,a,r)},FamilyTree.prototype.expandCollapseToLevel=function(e,t,i,r){this.config.collapse=t,null==i&&(i={}),this.config.expand=i;var a={id:e,method:"expandCollapseToLevel"};this._draw(!1,FamilyTree.action.collapse,a,r)},FamilyTree.prototype.maximize=function(e,t,i,r){var a=this,n={id:e,options:{}};FamilyTree.isNEU(n.id)&&(n.id=this.roots[0].id,n.all=!0),n.options.horizontal=!1,n.options.vertical=!1,t&&(n.options.horizontal=t),i&&(n.options.vertical=i),this._draw(!1,FamilyTree.action.maximize,n,(function(){a.ripple(e),r&&r()}))},FamilyTree.prototype.minimize=function(e,t){var i=this,r={id:e};FamilyTree.isNEU(r.id)&&(r.id=this.roots[0].id,r.all=!0),this._draw(!1,FamilyTree.action.minimize,r,(function(){i.ripple(e),t&&t()}))},FamilyTree.prototype._expCollHandler=function(e){this.nodeMenuUI.hide(),this.nodeContextMenuUI.hide(),this.menuUI.hide(),this.nodeCircleMenuUI.hide();var t=this.getNode(e),i=this.getCollapsedIds(t);if(i.length){if(!1===FamilyTree.events.publish("expcollclick",[this,!1,e,i]))return!1;this.expand(e,i,!1)}else{if(!1===FamilyTree.events.publish("expcollclick",[this,!0,e,t.childrenIds]))return!1;this.collapse(e,t.childrenIds,!1)}},FamilyTree.prototype._upHandler=function(e){this.nodeMenuUI.hide(),this.nodeContextMenuUI.hide(),this.menuUI.hide(),this.nodeCircleMenuUI.hide();var t=this._upHandlerCreateArgs(e);if(!1===FamilyTree.events.publish("up-click",[this,t]))return!1;this.changeRoots(t.id,t.roots,!1)},FamilyTree.prototype._upHandlerCreateArgs=function(e){var t,i=this.getNode(e),r=Object.assign([],this.config.roots),a=this.getNode(i.pid);if(a&&(t=a),t){if(Array.isArray(r)){var n=r.indexOf(i.id);-1!=n&&r.splice(n,1)}else r=[];r.push(t.id)}return{id:i.id,roots:r}},void 0===FamilyTree&&(FamilyTree={}),FamilyTree._validateConfig=function(e){return!!e||(console.error("config is not defined"),!1)},FamilyTree._arrayContains=function(e,t){if(e&&Array.isArray(e))for(var i=e.length;i--;)if(e[i]===t)return!0;return!1},FamilyTree._interceptions=function(e,t){if(!e)return[];if(!t)return[];var i=[];if(Array.isArray(e)&&Array.isArray(t))for(var r in e)for(var a in t)e[r]==t[a]&&i.push(e[r]);else if(Array.isArray(e)&&!Array.isArray(t))for(var r in e)for(var a in t)e[r]==a&&i.push(e[r]);else if(!Array.isArray(e)&&Array.isArray(t))for(var r in e)for(var a in t)r==t[a]&&i.push(t[a]);return i},FamilyTree._getTags=function(e){return e.tags&&!Array.isArray(e.tags)?e.tags.split(","):e.tags&&Array.isArray(e.tags)?e.tags:[]},FamilyTree._centerPointInPercent=function(e,t,i){var r=e.getBoundingClientRect(),a=t-r.left,n=i-r.top;return[a/(r.width/100),n/(r.height/100)]},FamilyTree._trim=function(e){return e.replace(/^\s+|\s+$/g,"")},FamilyTree._getTransform=function(e){var t=e.getAttribute("transform");return t=t.replace("matrix","").replace("(","").replace(")",""),FamilyTree._browser().msie&&(t=t.replace(/ /g,",")),t="["+(t=FamilyTree._trim(t))+"]",t=JSON.parse(t)},FamilyTree.getScale=function(e,t,i,r,a,n,o,l){var s=1;if(e||r!==FamilyTree.match.boundary)if(e||r!==FamilyTree.match.width)if(e||r!==FamilyTree.match.height)if(e){var d,c;s=(d=t/e[2])>(c=i/e[3])?c:d}else s=r;else s=i/l;else s=t/o;else s=(d=t/o)>(c=i/l)?c:d;return s&&s>a&&(s=a),s&&s<n&&(s=n),s},FamilyTree.isObject=function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&null!==e},FamilyTree.fileUploadDialog=function(e,t){var i=document.createElement("INPUT");i.setAttribute("type","file"),i.style.display="none",i.onchange=function(){var e=this.files[0];t(e)},document.body.appendChild(i),i.click()},FamilyTree.mergeDeep=function(e,t){if(FamilyTree.isObject(e)&&FamilyTree.isObject(t))for(var i in t)FamilyTree.isObject(t[i])?(e[i]||Object.assign(e,{[i]:{}}),FamilyTree.mergeDeep(e[i],t[i])):Object.assign(e,{[i]:t[i]});return e},FamilyTree._lblIsImg=function(e,t){return!(!e.nodeBinding||"string"!=typeof t||-1==t.indexOf("img")||!e.nodeBinding[t])},FamilyTree._getFistImgField=function(e){if(e.nodeBinding)for(var t in e.nodeBinding)if(-1!=t.indexOf("img"))return e.nodeBinding[t];return!1},FamilyTree._fieldIsImg=function(e,t){if(e.nodeBinding)for(var i in e.nodeBinding)if(e.nodeBinding[i]==t)return FamilyTree._lblIsImg(e,i);return!1},FamilyTree._guid=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},FamilyTree.htmlRipple=function(e){var t=document.createElement("style");t.type="text/css",t.innerHTML=" .bg-ripple-container {position: absolute; top: 0; right: 0; bottom: 0; left: 0; } .bg-ripple-container span {transform: scale(0);border-radius:100%;position:absolute;opacity:0.75;background-color:#fff;animation: bg-ripple 1000ms; }@-moz-keyframes bg-ripple {to {opacity: 0;transform: scale(2);}}@-webkit-keyframes bg-ripple {to {opacity: 0;transform: scale(2);}}@-o-keyframes bg-ripple {to {opacity: 0;transform: scale(2);}}@keyframes bg-ripple {to {opacity: 0;transform: scale(2);}}",document.head.appendChild(t);var i,r,a,n=document.createElement("div");n.className="bg-ripple-container",e.addEventListener("mousedown",(function(t){var i,r,a,n,o;return this,r=document.createElement("span"),a=this.offsetWidth,i=this.getBoundingClientRect(),o=t.pageX-i.left-a/2,n="top:"+(t.pageY-i.top-a/2)+"px; left: "+o+"px; height: "+a+"px; width: "+a+"px;",e.rippleContainer.appendChild(r),r.setAttribute("style",n)})),e.addEventListener("mouseup",(i=function(){for(;this.rippleContainer.firstChild;)this.rippleContainer.removeChild(this.rippleContainer.firstChild)},r=2e3,a=void 0,function(){var e,t;return t=this,e=arguments,clearTimeout(a),a=setTimeout((function(){return i.apply(t,e)}),r)})),e.rippleContainer=n,e.appendChild(n)},FamilyTree._moveToBoundaryArea=function(e,t,i,r){var a=t.slice(0);t[0]<i.left&&t[0]<i.right&&(a[0]=i.left>i.right?i.right:i.left),t[0]>i.right&&t[0]>i.left&&(a[0]=i.left>i.right?i.left:i.right),t[1]<i.top&&t[1]<i.bottom&&(a[1]=i.top>i.bottom?i.bottom:i.top),t[1]>i.bottom&&t[1]>i.top&&(a[1]=i.top>i.bottom?i.top:i.bottom),t[0]!==a[0]||t[1]!==a[1]?FamilyTree.anim(e,{viewBox:t},{viewBox:a},300,FamilyTree.anim.outPow,(function(){r&&r()})):r&&r()},FamilyTree.randomId=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},FamilyTree._getClientXY=function(e){return-1==e.type.indexOf("touch")?{x:e.clientX,y:e.clientY}:e.changedTouches.length?{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:void 0},FamilyTree._getClientTouchesXY=function(e,t){return-1!=e.type.indexOf("touch")?e.touches.length<t+1?{x:null,y:null}:{x:e.touches[t].clientX,y:e.touches[t].clientY}:{x:e.clientX,y:e.clientY}},FamilyTree._getOffset=function(e,t){e&&(t.x+=e.offsetLeft,t.y+=e.offsetTop,FamilyTree._getOffset(e.offsetParent,t))},FamilyTree._getTopLeft=function(e){var t={x:0,y:0};return FamilyTree._getOffset(e,t),t},FamilyTree._getOffsetXY=function(e,t){if(-1==t.type.indexOf("touch"))return{x:t.offsetX,y:t.offsetY};if(t.touches.length){var i=FamilyTree._getTopLeft(e);return{x:t.touches[0].pageX-i.x,y:t.touches[0].pageY-i.y}}if(t.changedTouches.length){i=FamilyTree._getTopLeft(e);return{x:t.changedTouches[0].pageX-i.x,y:t.changedTouches[0].pageY-i.y}}},FamilyTree._pinchMiddlePointInPercent=function(e,t,i,r){var a=FamilyTree._getTopLeft(e),n=r.touches[0].pageX-a.x,o=r.touches[0].pageY-a.y,l=r.touches[1].pageX-a.x,s=r.touches[1].pageY-a.y;return[((n-l)/2+l)/(t/100),((o-s)/2+s)/(i/100)]},FamilyTree._browser=function(){var e=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,t="undefined"!=typeof InstallTrigger,i=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||"undefined"!=typeof safari&&safari.pushNotification).toString(),r=!!document.documentMode,a=!r&&!!window.StyleMedia,n=!(!window.chrome||!window.chrome.webstore&&!window.chrome.runtime);return{opera:e,firefox:t,safari:i,msie:r,edge:a,chrome:n,blink:(n||e)&&!!window.CSS}},FamilyTree._menuPosition=function(e,t,i){var r=e.getBoundingClientRect(),a=i.getBoundingClientRect(),n=t.getBoundingClientRect(),o=r.left-a.left,l=r.top-a.top;return r.top+n.height>a.top+a.height&&(l-=n.height),r.left-n.width<a.left&&(o+=n.width),{x:o,y:l}},FamilyTree._getTemplate=function(e,t,i){if(Array.isArray(e))for(var r=0;r<e.length;r++){var a=t[e[r]];if(a&&a.template)return a.template}return i},FamilyTree._getMin=function(e,t){if(e.tags&&e.tags.length&&t.tags)for(var i=0;i<e.tags.length;i++){var r=t.tags[e.tags[i]];if(r&&!0===r.min)return!0}return t.min},FamilyTree._getSubLevels=function(e,t){if(e&&e.length)for(var i=0;i<e.length;i++){var r=t[e[i]];if(r&&r.subLevels)return r.subLevels}return 0},FamilyTree._isHTML=function(e){var t=document.createElement("div");t.innerHTML=e;for(var i=t.childNodes,r=i.length;r--;)if(1==i[r].nodeType)return!0;return!1},FamilyTree._getTestDiv=function(){var e=document.getElementById("familytree_js_test_div");return e||((e=document.createElement("div")).id="familytree_js_test_div",e.style.position="fixed",e.style.top="-10000px",e.style.left="-10000px",document.body.appendChild(e)),e},FamilyTree._getLabelSize=function(e){var t=FamilyTree._getTestDiv();return t.innerHTML="<svg>"+e+"</svg>",t.querySelector("text").getBoundingClientRect()},FamilyTree.wrapText=function(e,t){var i=t.toLowerCase();if(-1==i.indexOf("<text"))return e;if(-1==i.indexOf(FamilyTree.attr.width))return e;if(-1!=i.indexOf("foreignobject"))return e;if(-1==t.indexOf(FamilyTree.attr.width))return e;if(FamilyTree._isHTML(e))return e;var r=FamilyTree._getTestDiv();t=t.replaceAll("{cw}",0),r.innerHTML="<svg>"+t+"</svg>";var a,n,o=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("text")[0],l=parseFloat(o.getAttribute("x")),s=parseFloat(o.getAttribute("y")),d=o.getAttribute("text-anchor"),c=o.getAttribute(FamilyTree.attr.width),m=o.getAttribute(FamilyTree.attr.text_overflow),p="http://www.w3.org/2000/svg",h=r.getElementsByTagName("svg")[0].getElementsByTagName("text")[0];m||(m="ellipsis");var u=m.split("-");if(u.length>1&&(a=parseInt(m.split("-")[1]),u.length>2&&"ellipsis"==u[2]&&(n=!0)),!c)return e;if(c=parseFloat(c),l||(l=0),s||(s=0),l||(d="start"),"ellipsis"==m){h.removeChild(h.firstChild),h.textContent=e;for(var y=h.getComputedTextLength(),f=2;y>c;)h.textContent=e.substring(0,e.length-f),h.textContent+="...",y=h.getComputedTextLength(),f++;return f>2?"<title>"+e+"</title>"+h.textContent:e}if(-1!=m.indexOf("multiline")){var g=e.split(" "),b=h.getBBox().height;h.textContent="";var T=document.createElementNS(p,"tspan"),v=document.createTextNode(g[0]);T.setAttributeNS(null,"x",l),T.setAttributeNS(null,"y",s),T.setAttributeNS(null,"text-anchor",d),T.appendChild(v),h.appendChild(T);f=1;for(var F=1,x=1;x<g.length;x++){var _=T.firstChild.data.length;if(T.firstChild.data+=" "+g[x],T.getComputedTextLength()>c){if(T.firstChild.data=T.firstChild.data.slice(0,_),F++,a&&F>a){if(n&&h.children.length==a){var w=h.children[a-1].textContent;h.children[a-1].textContent=w.substring(0,w.length-3)+"..."}break}(T=document.createElementNS(p,"tspan")).setAttributeNS(null,"x",l),T.setAttributeNS(null,"y",s+b*f),T.setAttributeNS(null,"text-anchor",d),v=document.createTextNode(g[x]),T.appendChild(v),h.appendChild(T),f++}}var k="";if(null!=h.innerHTML)k=h.innerHTML,h.innerHTML="";else{var S="";for(x=h.childNodes.length-1;x>=0;x--)S=XMLSerializer().serializeToString(h.childNodes[x])+S,h.removeChild(h.childNodes[x]);k=S}return k}},FamilyTree._downloadFile=function(e,t,i,r){var a=new Blob([t],{type:e});if(1==r){var n=URL.createObjectURL(a);window.open(n,"_blank").focus()}else if(navigator.msSaveBlob)navigator.msSaveBlob(a,i);else{var o=document.createElement("a");if(void 0!==o.download){n=URL.createObjectURL(a);o.setAttribute("href",n),o.setAttribute("download",i),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}},FamilyTree._getPosition=function(e,t,i,r){var a={x:t.x,y:t.y};if(null!=i&&(a.x=i),null!=r&&(a.y=i),e&&3==e.length){var n=e[0].indexOf(t.id);-1!=n&&null!=e[1][n].transform&&(null==i&&(a.x=e[1][n].transform[4]),null==r&&(a.y=e[1][n].transform[5]))}return a},FamilyTree._getOpacity=function(e,t){var i=1;if(e&&3==e.length){var r=e[0].indexOf(t.id);-1!=r&&null!=e[1][r].opacity&&(i=e[1][r].opacity)}return i},FamilyTree.t=function(e,t,i){var r=FamilyTree.templates[e],a=null;if(null!=i&&r.scaleLessThen){var n=[];for(var o in r.scaleLessThen){var l=parseFloat(o);i<l&&n.push(l)}if(n.length>0){n.sort((function(e,t){return e-t}));var s=r.scaleLessThen[n[0]];for(var d in s)null==a&&(a=Object.assign({},r)),a[d]=s[d]}}return t?null==a?r.min?r.min:r:a.min?a.min:a:null==a?r:a},FamilyTree.setNodeSize=function(e){var t=FamilyTree.t(e.templateName,e.min);e.w=t&&t.size?t.size[0]:0,e.h=t&&t.size?t.size[1]:0},FamilyTree._imgs2base64=function(e,t,i,r){var a=e.getElementsByTagName(t),n=a.length;0==n&&r();for(var o=0;o<n;o++)!function(){var e=o,t=a[e];FamilyTree._getDataUri(t.getAttribute(i),(function(a){a.success&&t.setAttribute(i,a.result),e==n-1&&r()}))}()},FamilyTree._getDataUri=function(e,t){if(-1!=e.indexOf("base64"))t({success:!1});else{var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){200===i.status?r.readAsDataURL(i.response):404===i.status&&t({success:!1,result:i.status})};var r=new FileReader;r.onloadend=function(){t({success:!0,result:r.result})},i.send()}},FamilyTree._csvToArray=function(e,t){t=t||",";for(var i=new RegExp("(\\"+t+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+t+"\\r\\n]*))","gi"),r=[[]],a=null;a=i.exec(e);){var n,o=a[1];o.length&&o!==t&&r.push([]),n=a[2]?a[2].replace(new RegExp('""',"g"),'"'):a[3],r[r.length-1].push(n)}return r},FamilyTree._json2xml=function(e){for(var t=document.implementation.createDocument("","",null),i=t.createElement("nodes"),r=0;r<e.length;r++){var a=t.createElement("node"),n=e[r];for(var o in n){var l=n[o];"tags"==o&&(l=l.join()),a.setAttribute(o,l)}i.appendChild(a)}return t.appendChild(i),'<?xml version="1.0" encoding="utf-8" ?>'+(new XMLSerializer).serializeToString(t.documentElement)},FamilyTree._xml2json=function(e){for(var t=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("node"),i=[],r=0;r<t.length;r++){for(var a=t[r],n={},o=0;o<a.attributes.length;o++){var l=a.attributes[o],s=l.value;"tags"==l.name&&(s=s.split(",")),n[l.name]=s}i.push(n)}return i},FamilyTree._json2csv=function(e){for(var t=[],i=function(e){for(var i="",r=0;r<t.length;r++){var a;(a="reportsTo"==t[r]?null:null==e[t[r]]?"":e[t[r]])instanceof Date&&(a=a.toLocaleString());var n=(a=null===a?"":a.toString()).replace(/"/g,'""');n.search(/("|,|\n)/g)>=0&&(n='"'+n+'"'),r>0&&(i+=","),i+=n}return i+"\n"},r="",a=0;a<e.length;a++)for(var n in e[a])FamilyTree._arrayContains(t,n)||(t.push(n),r+=n+",");r=r.substring(0,r.length-1),r+="\n";for(a=0;a<e.length;a++)r+=i(e[a]);return r=r.substring(0,r.length-1)},FamilyTree.accentFold=function(e){return(e=e.toString().toLowerCase()).replace(/([àáâãäå])|([ç])|([èéêë])|([ìíîï])|([ñ])|([òóôõöø])|([ß])|([ùúûü])|([ÿ])|([æ])/g,(function(e,t,i,r,a,n,o,l,s,d,c){return t?"a":i?"c":r?"e":a?"i":n?"n":o?"o":l?"s":s?"u":d?"y":c?"ae":void 0}))},FamilyTree.copy=function(e){if(null===e||"object"!=typeof e||"isActiveClone"in e)return e;if(e instanceof Date)var t=new e.constructor;else t=e.constructor();for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(e.isActiveClone=null,t[i]=FamilyTree.copy(e[i]),delete e.isActiveClone);return t},FamilyTree._getScrollSensitivity=function(){var e=FamilyTree._browser();return e.msie&&FamilyTree.scroll.ie?FamilyTree.scroll.ie:e.edge&&FamilyTree.scroll.edge?FamilyTree.scroll.edge:e.safari&&FamilyTree.scroll.safari?FamilyTree.scroll.safari:e.chrome&&FamilyTree.scroll.chrome?FamilyTree.scroll.chrome:e.firefox&&FamilyTree.scroll.firefox?FamilyTree.scroll.firefox:e.opera&&FamilyTree.scroll.opera?FamilyTree.scroll.opera:{smooth:FamilyTree.scroll.smooth,speed:FamilyTree.scroll.speed}},FamilyTree.isTrial=function(){return void 0!==FamilyTree.remote},FamilyTree.childrenCount=function(e,t,i){null==i&&(i=0);for(var r=0;r<t.childrenIds.length;r++){var a=e.nodes[t.childrenIds[r]];a&&(i++,FamilyTree.childrenCount(e,a,i))}return i},FamilyTree.collapsedChildrenCount=function(e,t,i){null==i&&(i=0);for(var r=0;r<t.childrenIds.length;r++){var a=e.nodes[t.childrenIds[r]];a&&(!0===a.collapsed&&i++,FamilyTree.collapsedChildrenCount(e,a,i))}return i},FamilyTree._setMinMaxXY=function(e,t){(null==t.minX||null!=e.x&&e.x<t.minX)&&(t.minX=e.x),(null==t.minY||null!=e.y&&e.y<t.minY)&&(t.minY=e.y),(null==t.maxX||null!=e.x&&e.x+e.w>t.maxX)&&(t.maxX=e.x+e.w),(null==t.maxY||null!=e.y&&e.y+e.h>t.maxY)&&(t.maxY=e.y+e.h)},FamilyTree.getStParentNodes=function(e,t){for(t||(t=[]);e.parent;)e=e.parent;return e.stParent&&(t.push(e.stParent),FamilyTree.getStParentNodes(e.stParent,t)),t},FamilyTree.getRootOf=function(e){for(;e&&e.parent;)e=e.parent;return e},FamilyTree._getViewBox=function(e){var t=null;return e?(t=(t="["+(t=e.getAttribute("viewBox"))+"]").replace(/\ /g,","),t=JSON.parse(t)):null},FamilyTree.isNEU=function(e){return null==e||""===e},FamilyTree.prototype._canUpdateLink=function(e,t){if(null==t||null==t)return!1;if(null==e||null==e)return!1;if(e==t)return!1;var i=this.getNode(t),r=this.getNode(e);return!(i&&r&&(i.isAssistant||i.isPartner||i.hasPartners&&r.isAssistant||i.hasAssistants&&r.isPartner))&&!this.isChild(e,t)},FamilyTree.prototype.updateNode=function(e,t,i){var r=this,a=this.get(e.id);if(!0===i&&!1===FamilyTree.events.publish("update",[this,a,e]))return!1;this.update(e);var n=this.getNode(e.id),o=n.pid;null==o&&(o=n.stpid),this._draw(!1,FamilyTree.action.update,{id:o},(function(){r.ripple(e.id),t&&t(),FamilyTree.events.publish("updated",[r,a,e])}))},FamilyTree.prototype.update=function(e){for(var t=0;t<this.config.nodes.length;t++)if(this.config.nodes[t].id==e.id){this.config.nodes[t]=e;break}return this},FamilyTree.prototype.removeNode=function(e,t,i){var r=this;if(!this.canRemove(e))return!1;var a=this._getNewPidsAndStpidsForIds(e);if(!0===i&&!1===FamilyTree.events.publish("remove",[this,e,a]))return!1;return this.remove(e),this._draw(!1,FamilyTree.action.update,null,(function(){r.config.sticky&&FamilyTree._moveToBoundaryArea(r.getSvg(),r.getViewBox(),r.response.boundary),t&&t(),FamilyTree.events.publish("removed",[r,e,a])})),!0},FamilyTree.prototype.remove=function(e){var t=this.get(e);if(t)for(var i=this.config.nodes.length-1;i>=0;i--)this.config.nodes[i].pid!=e&&this.config.nodes[i].stpid!=e||(this.config.nodes[i].pid=t.pid,this.config.nodes[i].stpid=t.stpid),this.config.nodes[i].id==e&&this.config.nodes.splice(i,1);return this},FamilyTree.prototype._getNewPidsAndStpidsForIds=function(e){var t=this.get(e),i={},r={};if(t)for(var a=this.config.nodes.length-1;a>=0;a--)this.config.nodes[a].pid==e?i[this.config.nodes[a].id]=t.pid:this.config.nodes[a].stpid==e&&(r[this.config.nodes[a].id]=t.stpid);return{newPidsForIds:i,newStpidsForIds:r}},FamilyTree.prototype.addNode=function(e,t,i){var r=this;if(!0===i&&!1===FamilyTree.events.publish("add",[this,e]))return!1;this.add(e),r._draw(!1,FamilyTree.action.insert,{id:e.pid,insertedNodeId:e.id},(function(){r.ripple(e.id),t&&t(),FamilyTree.events.publish("added",[r,e.id])})),FamilyTree.events.publish("adding",[r,e.id])},FamilyTree.prototype.add=function(e){return null==e.id&&console.error("Call addNode without id"),this.config.nodes.push(e),this},FamilyTree.prototype._get=function(e){for(var t=0;t<this.config.nodes.length;t++)if(this.config.nodes[t].id==e)return this.config.nodes[t];return null},FamilyTree.prototype.get=function(e){for(var t=0;t<this.config.nodes.length;t++)if(this.config.nodes[t].id==e)return JSON.parse(JSON.stringify(this.config.nodes[t]));return null},FamilyTree.prototype.canRemove=function(e){var t=this.getNode(e);return!!t&&(!t.hasPartners&&!t.hasAssistants)},FamilyTree.ui={_defsIds:{},defs:function(e){var t="";for(var i in FamilyTree.templates){var r=FamilyTree.templates[i];r.defs&&(FamilyTree.ui._defsIds[i]=FamilyTree.randomId(),t+=r.defs.replace("{randId}",FamilyTree.ui._defsIds[i]))}return"<defs>"+t+e+"</defs>"},lonely:function(e){return e.nodes&&e.nodes.length?"":FamilyTree.IT_IS_LONELY_HERE.replace("{link}",FamilyTree.RES.IT_IS_LONELY_HERE_LINK)},pointer:function(e,t,i){return t===FamilyTree.action.exporting?"":FamilyTree.t(e.template,!1,i).pointer},node:function(e,t,i,r,a,n,o,l,s,d){var c=FamilyTree.t(e.templateName,e.min,s),m=c.node.replaceAll("{w}",e.w).replaceAll("{h}",e.h);c.defs&&(m=m.replace("{randId}",FamilyTree.ui._defsIds[e.templateName])),null==o&&(o=r.nodeBinding);var p={node:e,data:t};for(var h in o){var u,y=o[h];if(t&&(u=t[y]),"function"==typeof y&&(u=y(d,e,t)),p.value=u,p.element=c[h],p.name=y,!1!==FamilyTree.events.publish("field",[d,p]))if(null!=p.value&&null!=p.value&&null!=p.element)FamilyTree._lblIsImg(r,h)||"string"!=typeof p.value||(p.value=FamilyTree.wrapText(p.value,p.element)),m+=p.element.replace("{val}",(function(){return p.value})).replaceAll("{ew}",e.w-(e.padding?e.padding[1]:0)).replaceAll("{cw}",e.w/2).replaceAll("{randId}",FamilyTree.randomId()).replaceAll("{randId2}",FamilyTree.randomId())}var f=FamilyTree._getPosition(i,e,a,n),g="node";Array.isArray(e.tags)&&e.tags.length&&(g+=" "+e.tags.join(" ")),e.layout&&(g+=" tree-layout");var b="";e.lcn&&(b='lcn="'+e.lcn+'"');var T=FamilyTree.nodeOpenTag.replace("{lcn}",b).replace("{id}",e.id).replace("{class}",g).replace("{sl}",e.sl).replace("{level}",e.level).replace("{x}",f.x).replace("{y}",f.y),v=FamilyTree._getOpacity(i,e);return m=(T=T.replace("{opacity}",v))+(m+=FamilyTree.ui.nodeBtns(r,e,l,c,d))+FamilyTree.grCloseTag},nodeBtns:function(e,t,i,r,a){var n="";return null==e.nodeMenu||t.isSplit||i===FamilyTree.action.exporting||(n+=r.nodeMenuButton.replace("{id}",t.id).replace("{cw}",t.w/2).replace("{ew}",t.w-(t.padding?t.padding[1]:0))),null==e.nodeCircleMenu||t.isSplit||i===FamilyTree.action.exporting||FamilyTree.isNEU(r.nodeCircleMenuButton)||(n+='<g style="cursor:pointer;" transform="matrix(1,0,0,1,'+r.nodeCircleMenuButton.x+","+r.nodeCircleMenuButton.y+')" '+FamilyTree.attr.control_node_circle_menu_id+'="'+t.id+'"><circle cx="0" cy="0" fill="'+r.nodeCircleMenuButton.color+'" r="'+r.nodeCircleMenuButton.radius+'" stroke-width="1" stroke="'+r.nodeCircleMenuButton.stroke+'"></circle><line x1="-'+r.nodeCircleMenuButton.radius/2+'" y1="-6" x2="'+r.nodeCircleMenuButton.radius/2+'" y2="-6" stroke-width="2" stroke="'+r.nodeCircleMenuButton.stroke+'"></line><line x1="-'+r.nodeCircleMenuButton.radius/2+'" y1="0" x2="'+r.nodeCircleMenuButton.radius/2+'" y2="0" stroke-width="2" stroke="'+r.nodeCircleMenuButton.stroke+'"></line><line x1="-'+r.nodeCircleMenuButton.radius/2+'" y1="6" x2="'+r.nodeCircleMenuButton.radius/2+'" y2="6" stroke-width="2" stroke="'+r.nodeCircleMenuButton.stroke+'"></line></g>'),n},expandCollapseBtn:function(e,t,i,r,a){var n="";if(r!==FamilyTree.action.exporting&&!t.isSplit){var o=i[t.lcn?t.lcn:"base"],l=0,s=0,d=FamilyTree.t(t.templateName,t.min,a);if(t.childrenIds.length>0){if(t.hasPartners){for(var c=!1,m=0;m<t.children.length;m++)t.children[m].parentPartner||t.children[m].isPartner||(c=!0);if(!c)return""}switch(o.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:l=t.x+t.w/2,s=t.y+t.h;break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:l=t.x+t.w/2,s=t.y;break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:l=t.x,s=t.y+t.h/2;break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:l=t.x+t.w,s=t.y+t.h/2}if(l-=d.expandCollapseSize/2,s-=d.expandCollapseSize/2,e.getCollapsedIds(t).length?(n+=FamilyTree.expcollOpenTag.replace("{id}",t.id).replace("{x}",l).replace("{y}",s),n+=d.plus,n+=FamilyTree.grCloseTag):(n+=FamilyTree.expcollOpenTag.replace("{id}",t.id).replace("{x}",l).replace("{y}",s),n+=d.minus,n+=FamilyTree.grCloseTag),n.indexOf("{collapsed-children-count}")){var p=FamilyTree.collapsedChildrenCount(e,t);n=n.replace("{collapsed-children-count}",p)}}e._nodeHasHiddenParent(t)&&(n+=FamilyTree.upOpenTag.replace("{id}",t.id).replace("{x}",t.x).replace("{y}",t.y),n+=d.up,n+=FamilyTree.grCloseTag)}var h={html:n,node:t};return FamilyTree.events.publish("renderbuttons",[e,h]),h.html},link:function(e,t,i,r,a,n){var o=e.lcn?e.lcn:"base",l=t._layoutConfigs[o],s=FamilyTree.t(e.templateName,e.min,i),d=[],c=l.levelSeparation/2;e.layout!=FamilyTree.mixed&&e.layout!=FamilyTree.tree||(c=l.mixedHierarchyNodesSeparation/2);var m=0,p=FamilyTree.getRootOf(e).id,h=r[p][e.sl],u=void 0;if(e.hasPartners){u={ids:[],indexes:{},ppnodes:{},lastLeft:null,firstRight:null,maxSidePartnersWithChildren:0,rightIds:[],leftIds:[],partnerChildrenSplitSeparation:t.config.partnerChildrenSplitSeparation};for(var y=0;y<e.children.length;y++){(f=e.children[y]).parentPartner?(u.ppnodes[f.id]=f.parentPartner,u.ids.push(f.id),1==f.parentPartner.isPartner?(-1==u.rightIds.indexOf(f.parentPartner.id)&&u.rightIds.push(f.parentPartner.id),u.indexes[f.id]=u.rightIds.indexOf(f.parentPartner.id),u.firstRight||(u.firstRight=f)):2==f.parentPartner.isPartner&&(-1==u.leftIds.indexOf(f.parentPartner.id)&&u.leftIds.push(f.parentPartner.id),u.indexes[f.id]=u.leftIds.indexOf(f.parentPartner.id),u.lastLeft=f)):f.isPartner||(u.lastLeft=f,u.firstRight||(u.firstRight=f))}u.maxSidePartnersWithChildren=Math.max(u.leftIds.length,u.rightIds.length),m=0==u.maxSidePartnersWithChildren?t.config.minPartnerSeparation/2:t.config.minPartnerSeparation/2+u.partnerChildrenSplitSeparation*u.maxSidePartnersWithChildren+u.partnerChildrenSplitSeparation/2}for(y=0;y<e.children.length;y++){var f=e.children[y],g=r[p][f.sl],b={xa:0,ya:0,xb:0,yb:0,xc:0,yc:0,xd:0,yd:0,x:0,y:0,rotate:0},T=(s=FamilyTree.t(f.templateName,f.min,i)).link;if(u&&-1!=u.ids.indexOf(f.id))switch(l.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:b=FamilyTree.ui._linkPpTop(u,e,f,g,h,s);break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:b=FamilyTree.ui._linkPpBottom(u,e,f,g,h,s);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:b=FamilyTree.ui._linkPpRight(u,e,f,g,h,s);break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:b=FamilyTree.ui._linkPpLeft(u,e,f,g,h,s)}else if((f.isAssistant||2==f.layout)&&f.rightNeighbor&&f.rightNeighbor.isSplit)switch(l.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:b=FamilyTree.ui._linkRightToLeft(f.rightNeighbor,f,s,c);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:b=FamilyTree.ui._linkBottomToTop(f.rightNeighbor,f,s,c)}else if((f.isAssistant||2==f.layout)&&f.leftNeighbor&&f.leftNeighbor.isSplit)switch(l.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:b=FamilyTree.ui._linkLeftToRight(f.leftNeighbor,f,s,c);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:b=FamilyTree.ui._linkTopToBottom(f.leftNeighbor,f,s,c)}else switch(l.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:if(1==f.isPartner)b=FamilyTree.ui._linkLeftToRight(e,f,s,m);else if(2==f.isPartner)b=FamilyTree.ui._linkRightToLeft(e,f,s,m);else{var v=1==f.layout?void 0:g.minY-(g.minY-h.maxY)/2;b=FamilyTree.ui._linkTopToBottom(e,f,s,c,v)}break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:if(1==f.isPartner)b=FamilyTree.ui._linkLeftToRight(e,f,s,m);else if(2==f.isPartner)b=FamilyTree.ui._linkRightToLeft(e,f,s,m);else{v=1==f.layout?void 0:g.maxY-(g.maxY-h.minY)/2;b=FamilyTree.ui._linkBottomToTop(e,f,s,c,v)}break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:if(1==f.isPartner)b=FamilyTree.ui._linkTopToBottom(e,f,s,m);else if(2==f.isPartner)b=FamilyTree.ui._linkBottomToTop(e,f,s,m);else{v=1==f.layout?void 0:g.maxX-(g.maxX-h.minX)/2;b=FamilyTree.ui._linkRightToLeft(e,f,s,c,v)}break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:if(1==f.isPartner)b=FamilyTree.ui._linkTopToBottom(e,f,s,m);else if(2==f.isPartner)b=FamilyTree.ui._linkBottomToTop(e,f,s,m);else{v=1==f.layout?void 0:g.minX-(g.minX-h.maxX)/2;b=FamilyTree.ui._linkLeftToRight(e,f,s,c,v)}}if(-1!=T.indexOf("{rounded}"))if(b.xa==b.xb&&b.xa==b.xc&&b.xa==b.xd||b.ya==b.yb&&b.ya==b.yc&&b.ya==b.yd)T=T.replace("{rounded}","M"+b.xa+","+b.ya+" L"+b.xd+","+b.yd);else{var F=FamilyTree.ui._roundedEdge(b.xa,b.ya,b.xb,b.yb,b.xc,b.yc),x=FamilyTree.ui._roundedEdge(b.xb,b.yb,b.xc,b.yc,b.xd,b.yd);T=T.replace("{rounded}","M"+F.x1+","+F.y1+" "+F.x2+","+F.y2+" Q"+F.qx1+","+F.qy1+" "+F.qx2+","+F.qy2+" L"+x.x2+","+x.y2+" Q"+x.qx1+","+x.qy1+" "+x.qx2+","+x.qy2+" L"+x.x3+","+x.y3)}else T=-1!=T.indexOf("{edge}")?T.replace("{edge}","M"+b.xa+","+b.ya+" "+b.xb+","+b.yb+" "+b.xc+","+b.yc+" L"+b.xd+","+b.yd):-1!=T.indexOf("{curve}")?T.replace("{curve}","M"+b.xa+","+b.ya+" C"+b.xb+","+b.yb+" "+b.xc+","+b.yc+" "+b.xd+","+b.yd):T.replaceAll("{xa}",b.xa).replaceAll("{ya}",b.ya).replaceAll("{xb}",b.xb).replaceAll("{yb}",b.yb).replaceAll("{xc}",b.xc).replaceAll("{yc}",b.yc).replaceAll("{xd}",b.xd).replaceAll("{yd}",b.yd);d.push(FamilyTree.linkOpenTag.replace("{id}",e.id).replace("{class}","link "+f.tags.join(" ")).replace("{child-id}",f.id));var _={node:e,cnode:f,p:b,html:T,action:n};FamilyTree.events.publish("render-link",[t,_]),d.push(_.html);var w="";for(var k in t.config.linkBinding){var S=t.config.linkBinding[k],I=t._get(f.id);if(I){var C=I[S];_.value=C,_.element=s[k],_.name=S,!1!==FamilyTree.events.publish("label",[t,_])&&(FamilyTree.isNEU(_.value)||FamilyTree.isNEU(_.element)||(w+=_.element.replace("{val}",_.value)))}}""!=w&&(w=FamilyTree.linkFieldsOpenTag.replace("{x}",b.x).replace("{y}",b.y).replace("{rotate}",0)+w+FamilyTree.grCloseTag,d.push(w)),d.push(FamilyTree.grCloseTag)}return d.join("")},svg:function(e,t,i,r,a,n){return FamilyTree.t(r.template,!1,n).svg.replace("{w}",e).replace("{h}",t).replace("{viewBox}",i).replace("{content}",(function(){return a}))},menuButton:function(e){return null==e.menu?"":FamilyTree.t(e.template,!1).menuButton.replaceAll("{p}",e.padding)},_roundedEdge:function(e,t,i,r,a,n){var o=FamilyTree.LINK_ROUNDED_CORNERS;Math.abs(e-a)<o&&(o=0),Math.abs(t-n)<o&&(o=0);var l,s,d,c=0;return e==i&&e==a||t==r&&t==n?(l=d=i,s=c=r):(e!=a&&i==a&&(l=d=i,s=r,t<n?c=r+o:t>n&&(c=r-o)),e<a&&i==a?i-=o:e>a&&i==a&&(i+=o),t!=n&&r==n&&(l=i,s=c=r,e<a?d=i+o:e>a&&(d=i-o)),t<n&&r==n?r-=o:t>n&&r==n&&(r+=o)),{x1:e,y1:t,x2:i,y2:r,x3:a,y3:n,qx1:l,qy1:s,qx2:d,qy2:c}},_linkTopToBottom:function(e,t,i,r,a){var n,o,l,s,d,c=0;return n=e.x+e.w/2+i.linkAdjuster.toX,o=e.y+e.h+i.linkAdjuster.toY,s=l=t.x+t.w/2+i.linkAdjuster.fromX,d=t.y+i.linkAdjuster.fromY,{xa:n,ya:o,xb:n,yb:c=e.rightNeighbor&&e.rightNeighbor.isAssistant&&"split"==t.templateName?e.rightNeighbor.y+e.rightNeighbor.h+r:"split"!=e.templateName||!t.isAssistant&&2!=t.layout?"split"==t.templateName?o+r:null!=a?a:d-r:d,xc:l,yc:c,xd:s,yd:d,x:l,y:c+16,rotate:0}},_linkBottomToTop:function(e,t,i,r,a){var n,o,l,s,d,c=0;return n=e.x+e.w/2+i.linkAdjuster.toX,o=e.y+i.linkAdjuster.toY,s=l=t.x+t.w/2+i.linkAdjuster.fromX,d=t.y+t.h+i.linkAdjuster.fromY,{xa:n,ya:o,xb:n,yb:c=e.rightNeighbor&&e.rightNeighbor.isAssistant&&"split"==t.templateName?e.rightNeighbor.y-r:"split"!=e.templateName||!t.isAssistant&&2!=t.layout?"split"==t.templateName?o-r:null!=a?a:d+r:d,xc:l,yc:c,xd:s,yd:d,x:l,y:c-14,rotate:0}},_linkRightToLeft:function(e,t,i,r,a){var n,o,l,s,d,c,m=0;return n=e.x+i.linkAdjuster.toX,o=e.y+e.h/2+i.linkAdjuster.toY,d=t.x+t.w+i.linkAdjuster.fromX,c=s=t.y+t.h/2+i.linkAdjuster.fromY,l=o,90,{xa:n,ya:o,xb:m=e.rightNeighbor&&e.rightNeighbor.isAssistant&&"split"==t.templateName?e.rightNeighbor.x-r:"split"!=e.templateName||!t.isAssistant&&2!=t.layout?"split"==t.templateName?n-r:null!=a?a:d+r:d,yb:l,xc:m,yc:s,xd:d,yd:c,x:m-16,y:s,rotate:90}},_linkLeftToRight:function(e,t,i,r,a){var n,o,l,s,d,c,m=0;return n=e.x+e.w+i.linkAdjuster.toX,o=e.y+e.h/2+i.linkAdjuster.toY,d=t.x+i.linkAdjuster.fromX,c=s=t.y+t.h/2+i.linkAdjuster.fromY,l=o,270,{xa:n,ya:o,xb:m=e.rightNeighbor&&e.rightNeighbor.isAssistant&&"split"==t.templateName?e.rightNeighbor.x+e.rightNeighbor.w+r:"split"!=e.templateName||!t.isAssistant&&2!=t.layout?"split"==t.templateName?n+r:null!=a?a:d-r:d,yb:l,xc:m,yc:s,xd:d,yd:c,x:m+14,y:s,rotate:270}},_linkPpTop:function(e,t,i,r,a,n){var o=e.ppnodes[i.id],l=o.y+o.h/2,s=r.minY-(r.minY-a.maxY)/2,d=(r.minY-a.maxY)/e.maxSidePartnersWithChildren/4,c=FamilyTree.ui.__linkPpBottomTop(e,t,i,s,d,o),m=c.x;return s=c.mid,FamilyTree.ui._linkTopToBottom({x:m,y:l,w:0,h:0},i,n,0,s)},_linkPpBottom:function(e,t,i,r,a,n){var o=e.ppnodes[i.id],l=o.y+o.h/2,s=r.maxY-(r.maxY-a.minY)/2,d=(r.maxY-a.minY)/e.maxSidePartnersWithChildren/4,c=FamilyTree.ui.__linkPpBottomTop(e,t,i,s,d,o),m=c.x;return s=c.mid,FamilyTree.ui._linkBottomToTop({x:m,y:l,w:0,h:0},i,n,0,s)},_linkPpLeft:function(e,t,i,r,a,n){var o=e.ppnodes[i.id],l=r.minX-(r.minX-a.maxX)/2,s=(r.minX-a.maxX)/e.maxSidePartnersWithChildren/4,d=o.x+o.w/2,c=FamilyTree.ui.__linkPpLeftRight(e,t,i,l,s,o),m=c.y;return l=c.mid,FamilyTree.ui._linkLeftToRight({x:d,y:m,w:0,h:0},i,n,0,l)},_linkPpRight:function(e,t,i,r,a,n){var o=e.ppnodes[i.id],l=r.maxX-(r.maxX-a.minX)/2,s=(r.maxX-a.minX)/e.maxSidePartnersWithChildren/4,d=o.x+o.w/2,c=FamilyTree.ui.__linkPpLeftRight(e,t,i,l,s,o),m=c.y;return l=c.mid,FamilyTree.ui._linkRightToLeft({x:d,y:m,w:0,h:0},i,n,0,l)},__linkPpBottomTop:function(e,t,i,r,a,n){var o=0;return 1==n.isPartner?(o=n.x-t.partnerSeparation/2+e.indexes[i.id]*e.partnerChildrenSplitSeparation-(e.rightIds.length-1)*e.partnerChildrenSplitSeparation/2,e.lastLeft&&o<e.lastLeft.x+e.lastLeft.w/2?o<i.x+i.w/2?r-=(e.indexes[i.id]+1)*a:r-=(e.rightIds.length-e.indexes[i.id])*a:o<i.x+i.w/2?r+=(e.rightIds.length-e.indexes[i.id])*a:r+=(e.indexes[i.id]+1)*a):2==n.isPartner&&(o=n.x+n.w+t.partnerSeparation/2+e.indexes[i.id]*e.partnerChildrenSplitSeparation-(e.leftIds.length-1)*e.partnerChildrenSplitSeparation/2,e.firstRight&&o>e.firstRight.x+e.firstRight.w/2?o<i.x+i.w/2?r-=(e.indexes[i.id]+1)*a:r-=(e.leftIds.length-e.indexes[i.id])*a:o<i.x+i.w/2?r+=(e.leftIds.length-e.indexes[i.id])*a:r+=(e.indexes[i.id]+1)*a),{x:o,mid:r}},__linkPpLeftRight:function(e,t,i,r,a,n){var o=0;return 1==n.isPartner?(o=n.y-t.partnerSeparation/2+e.indexes[i.id]*e.partnerChildrenSplitSeparation-(e.rightIds.length-1)*e.partnerChildrenSplitSeparation/2,e.lastLeft&&o<e.lastLeft.y+e.lastLeft.h/2?o<i.y+i.h/2?r-=(e.indexes[i.id]+1)*a:r-=(e.rightIds.length-e.indexes[i.id])*a:o<i.y+i.h/2?r+=(e.rightIds.length-e.indexes[i.id])*a:r+=(e.indexes[i.id]+1)*a):2==n.isPartner&&(o=n.y+n.h+t.partnerSeparation/2+e.indexes[i.id]*e.partnerChildrenSplitSeparation-(e.leftIds.length-1)*e.partnerChildrenSplitSeparation/2,e.firstRight&&o>e.firstRight.y+e.firstRight.h/2?o<i.y+i.h/2?r-=(e.indexes[i.id]+1)*a:r-=(e.leftIds.length-e.indexes[i.id])*a:o<i.y+i.h/2?r+=(e.leftIds.length-e.indexes[i.id])*a:r+=(e.indexes[i.id]+1)*a),{y:o,mid:r}}},FamilyTree.templates={},FamilyTree.templates.base={defs:`<g transform="matrix(1,0,0,1,0,0)" id="dot"><circle class="ba-fill" cx="0" cy="0" r="5" stroke="#aeaeae" stroke-width="1"></circle></g>\n            <g id="base_node_menu" style="cursor:pointer;"><rect x="0" y="0" fill="transparent" width="22" height="22"></rect><circle cx="4" cy="11" r="2" fill="#ffffff"></circle><circle cx="11" cy="11" r="2" fill="#ffffff"></circle><circle cx="18" cy="11" r="2" fill="#ffffff"></circle></g>\n            <g style="cursor: pointer;" id="base_tree_menu">\n                <rect x="0" y="0" width="25" height="25" fill="transparent"></rect>\n                ${FamilyTree.icon.addUser(25,25,"#fff",0,0)}\n            </g>\n            <g style="cursor: pointer;" id="base_tree_menu_close">\n                <circle cx="12.5" cy="12.5" r="12" fill="#F57C00"></circle>\n                ${FamilyTree.icon.close(25,25,"#fff",0,0)}\n            </g>            \n            <g id="base_up">\n                <circle cx="15" cy="15" r="15" fill="#fff" stroke="#aeaeae" stroke-width="1"></circle>\n                ${FamilyTree.icon.ft(20,20,"#aeaeae",5,5)}\n            </g>\n            <clipPath id="base_img_0"><rect id="base_img_0_stroke" stroke-width="3" stroke="#fff" x="170" y="-5" rx="25" ry="25" width="70" height="70"></rect></clipPath>`,size:[250,120],linkAdjuster:{fromX:0,fromY:0,toX:0,toY:0},ripple:{radius:0,color:"#e6e6e6",rect:null},expandCollapseSize:0,svg:'<svg class="{template} {mode}" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  style="display:block;" width="{w}" height="{h}" viewBox="{viewBox}">{content}</svg>',link:'<path stroke-linejoin="round" stroke="#aeaeae" stroke-width="1px" fill="none" d="{rounded}" />',assistanseLink:'<path stroke-linejoin="round" stroke="#aeaeae" stroke-width="2px" fill="none" d="M{xa},{ya} {xb},{yb} {xc},{yc} {xd},{yd} L{xe},{ye}"/>',pointer:'<g data-pointer="pointer" transform="matrix(0,0,0,0,100,100)"><radialGradient id="pointerGradient"><stop stop-color="#ffffff" offset="0" /><stop stop-color="#C1C1C1" offset="1" /></radialGradient><circle cx="16" cy="16" r="16" stroke-width="1" stroke="#acacac" fill="url(#pointerGradient)"></circle></g>',node:'<rect x="0" y="0" height="{h}" width="{w}" stroke-width="1" stroke="#aeaeae" rx="7" ry="7"></rect>',menuButton:'<div style="position:absolute;right:{p}px;top:{p}px; width:40px;height:50px;cursor:pointer;" '+FamilyTree.attr.control_export_menu+'=""><hr style="background-color: #7A7A7A; height: 3px; border: none;"><hr style="background-color: #7A7A7A; height: 3px; border: none;"><hr style="background-color: #7A7A7A; height: 3px; border: none;"></div>',padding:[50,20,35,20],nodeMenuButton:`<use ${FamilyTree.attr.control_node_menu_id}="{id}" x="220" y="95" xlink:href="#base_node_menu"/>`,nodeTreeMenuButton:'<use data-ctrl-n-t-menu-id="{id}" x="10" y="10" xlink:href="#base_tree_menu"/>',nodeTreeMenuCloseButton:'<use data-ctrl-n-t-menu-c="" x="10" y="10" xlink:href="#base_tree_menu_close"/>',up:'<use x="110" y="-10" xlink:href="#base_up"/>',img_0:'<use xlink:href="#base_img_0_stroke" /><image preserveAspectRatio="xMidYMid slice" clip-path="url(#base_img_0)" xlink:href="{val}"  x="170" y="-5"  width="70" height="70"></image>',link_field_0:'<text text-anchor="middle" fill="#aeaeae" '+FamilyTree.attr.width+'="290" x="0" y="0" style="font-size:10px;">{val}</text>'},FamilyTree.templates.tommy=Object.assign({},FamilyTree.templates.base),FamilyTree.templates.tommy.defs="<style>\n                                        .tommy .node>rect{\n                                            fill: #aeaeae;\n                                        }\n                                        .tommy .node.male>rect{\n                                            fill: #039BE5;\n                                        }        \n                                        .tommy .node.female>rect{\n                                            fill: #F57C00;\n                                        }\n                                        .tommy .edit-form-header, .tommy .ba-img-button{\n                                            background-color: #aeaeae;\n                                        }\n                                        .tommy.male .edit-form-header, .tommy.male .ba-img-button{\n                                            background-color: #039BE5;\n                                        }\n                                        .tommy.female .edit-form-header, .tommy.female .ba-img-button{\n                                            background-color: #F57C00;\n                                        }        \n                                        .tommy.female .ba-img-button:hover{\n                                            background-color: #039BE5 !important;\n                                        }\n                                    </style>",FamilyTree.templates.tommy.field_0="<text "+FamilyTree.attr.width+'="230" style="font-size: 18px;font-weight:bold;" fill="#ffffff" x="10" y="90" text-anchor="start">{val}</text>',FamilyTree.templates.tommy.field_1="<text "+FamilyTree.attr.width+'="150" style="font-size: 14px;" fill="#ffffff" x="10" y="65" text-anchor="start">{val}</text>',FamilyTree.templates.hugo=Object.assign({},FamilyTree.templates.base),FamilyTree.templates.hugo.defs=`<clipPath id="hugo_img_0"><rect id="hugo_img_0_stroke" stroke-width="2" stroke="#fff" x="90" y="-5" rx="25" ry="25" width="70" height="70"></rect></clipPath>\n                                    <linearGradient id="hugo_grad_female" x1="0%" y1="0%" x2="100%" y2="0%">\n                                        <stop offset="0%" style="stop-color:#FF8024;stop-opacity:1" />\n                                        <stop offset="100%" style="stop-color:#FF46A3;stop-opacity:1" />\n                                    </linearGradient>\n                                    <linearGradient id="hugo_grad_male" x1="0%" y1="0%" x2="100%" y2="0%">\n                                        <stop offset="0%" style="stop-color:#00D3A5;stop-opacity:1" />\n                                        <stop offset="100%" style="stop-color:#00A7D4;stop-opacity:1" />\n                                    </linearGradient>\n                                    <linearGradient id="hugo_grad" x1="0%" y1="0%" x2="100%" y2="0%">\n                                        <stop offset="0%" style="stop-color:#D0D0D0;stop-opacity:1" />\n                                        <stop offset="100%" style="stop-color:#909090;stop-opacity:1" />\n                                    </linearGradient>\n                                    <g id="hugo_up">\n                                        <circle cx="12" cy="12" r="15" fill="transparent" ></circle>\n                                        ${FamilyTree.icon.ft(24,24,"#fff",0,0)}\n                                    </g>\n                                    <g id="hugo_node_menu" style="cursor:pointer;"><rect x="0" y="0" fill="transparent" width="22" height="22"></rect><circle cx="11" cy="4" r="2" fill="#ffffff"></circle><circle cx="11" cy="11" r="2" fill="#ffffff"></circle><circle cx="11" cy="18" r="2" fill="#ffffff"></circle></g>\n                                    <style>\n                                        .hugo .node>rect{\n                                            fill: url(#hugo_grad);\n                                        }\n                                        .hugo .node.male>rect{\n                                            fill: url(#hugo_grad_male);;\n                                        }        \n                                        .hugo .node.female>rect{\n                                            fill: url(#hugo_grad_female);\n                                        }\n                                        .hugo .edit-form-header{\n                                            background: linear-gradient(90deg, #D0D0D0 0%, #909090 100%);\n                                        }\n                                        .hugo.male .edit-form-header{\n                                            background: linear-gradient(90deg, #00D3A5 0%, #00A7D4 100%);\n                                        }\n                                        .hugo.female .edit-form-header{\n                                            background: linear-gradient(90deg, #FF8024 0%, #FF46A3 100%);\n                                        }  \n                                        .hugo .ba-img-button{\n                                            background-color: #909090 !important;\n                                        }      \n                                        .hugo .ba-img-button:hover{\n                                            background-color: #D0D0D0 !important;\n                                        }\n                                        .hugo.male .ba-img-button{\n                                            background-color: #00A7D4 !important;\n                                        }      \n                                        .hugo.male .ba-img-button:hover{\n                                            background-color: #00D3A5 !important;\n                                        }\n                                        .hugo.female .ba-img-button{\n                                            background-color: #FF46A3 !important;\n                                        }      \n                                        .hugo.female .ba-img-button:hover{\n                                            background-color: #FF8024 !important;\n                                        }\n                                        \n                                    </style>`,FamilyTree.templates.hugo.img_0='<use xlink:href="#hugo_img_0_stroke" /><image preserveAspectRatio="xMidYMid slice" clip-path="url(#hugo_img_0)" xlink:href="{val}"  x="90" y="-5"  width="70" height="70"></image>',FamilyTree.templates.hugo.field_0="<text "+FamilyTree.attr.width+'="230" style="font-size: 18px;font-weight:bold;" fill="#ffffff" x="125" y="85" text-anchor="middle">{val}</text>',FamilyTree.templates.hugo.field_1="<text "+FamilyTree.attr.width+'="230" style="font-size: 14px;" fill="#ffffff" x="125" y="105" text-anchor="middle">{val}</text>',FamilyTree.templates.hugo.up='<use x="200" y="10" xlink:href="#hugo_up"/>',FamilyTree.templates.hugo.nodeMenuButton=`<use x="225" y="10" ${FamilyTree.attr.control_node_menu_id}="{id}" xlink:href="#hugo_node_menu"/>`,FamilyTree.templates.mother=Object.assign({},FamilyTree.templates.base),FamilyTree.templates.mother.up="",FamilyTree.templates.mother.node='<rect x="0" y="0" height="{h}" width="{w}" style="fill:transparent;"  stroke-width="1" stroke="#F57C00" rx="5" ry="5"></rect><text style="font-size: 18px;" fill="#F57C00" x="240" y="30" text-anchor="end">Add mother</text>'+FamilyTree.icon.mother(70,70,"#F57C00",10,40),FamilyTree.templates.mother.field_0="",FamilyTree.templates.mother.field_1="",FamilyTree.templates.father=Object.assign({},FamilyTree.templates.mother),FamilyTree.templates.father.node='<rect x="0" y="0" height="{h}" width="{w}" style="fill:transparent;height:{h}; width:{w};stroke-width:1;stroke:#039BE5;rx:5;ry:5;"></rect><text style="font-size: 18px;" fill="#039BE5" x="240" y="30" text-anchor="end">Add father</text>'+FamilyTree.icon.father(70,70,"#039BE5",10,40),FamilyTree.templates.partner=Object.assign({},FamilyTree.templates.mother),FamilyTree.templates.partner.node='<rect x="0" y="0" height="{h}" width="{w}" style="fill:transparent;height:{h}; width:{w};stroke-width:1;stroke:#aeaeae;rx:5;ry:5;"></rect><text style="font-size: 18px;" fill="#aeaeae" x="240" y="30" text-anchor="end">Add partner</text>',FamilyTree.templates.son=Object.assign({},FamilyTree.templates.mother),FamilyTree.templates.son.node='<rect x="0" y="0" height="{h}" width="{w}" style="fill:transparent;height:{h}; width:{w};stroke-width:1;stroke:#039BE5;rx:5;ry:5;"></rect><text style="font-size: 18px;" fill="#039BE5" x="240" y="30" text-anchor="end">Add son</text>'+FamilyTree.icon.son(70,70,"#039BE5",10,40),FamilyTree.templates.daughter=Object.assign({},FamilyTree.templates.mother),FamilyTree.templates.daughter.node='<rect x="0" y="0" height="{h}" width="{w}" style="fill:transparent;height:{h}; width:{w};stroke-width:1;stroke:#F57C00;rx:5;ry:5;"></rect><text style="font-size: 18px;" fill="#F57C00" x="240" y="30" text-anchor="end">Add daughter</text>'+FamilyTree.icon.daughter(70,70,"#F57C00",10,40),FamilyTree.templates.husband=Object.assign({},FamilyTree.templates.mother),FamilyTree.templates.husband.node='<rect x="0" y="0" height="{h}" width="{w}" style="fill:transparent;height:{h}; width:{w};stroke-width:1;stroke:#039BE5;rx:5;ry:5;"></rect><text style="font-size: 18px;" fill="#039BE5" x="240" y="30" text-anchor="end">Add husband</text>'+FamilyTree.icon.husband(70,70,"#039BE5",10,40),FamilyTree.templates.wife=Object.assign({},FamilyTree.templates.mother),FamilyTree.templates.wife.node='<rect x="0" y="0" height="{h}" width="{w}" style="fill:transparent;height:{h}; width:{w};stroke-width:1;stroke:#F57C00;rx:5;ry:5;"></rect><text style="font-size: 18px;" fill="#F57C00" x="240" y="30" text-anchor="end">Add wife</text>'+FamilyTree.icon.wife(70,70,"#F57C00",10,40),FamilyTree.templates.pet=Object.assign({},FamilyTree.templates.mother),FamilyTree.templates.pet.node='<rect x="0" y="0" style="fill:transparent;height:{h}; width:{w};stroke-width:1;stroke:#F57C00;rx:5;ry:5;"></rect><text style="font-size: 18px;" fill="#F57C00" x="240" y="30" text-anchor="end">Add pet</text>'+FamilyTree.icon.teddy(70,70,"#F57C00",10,40),FamilyTree.templates.cgroup=Object.assign({},FamilyTree.templates.base),FamilyTree.templates.cgroup.defs="",FamilyTree.templates.cgroup.size=[250,120],FamilyTree.templates.cgroup.padding=[0,0,0,0],FamilyTree.templates.cgroup.node="",FamilyTree.templates.split=Object.assign({},FamilyTree.templates.base),FamilyTree.templates.split.size=[10,10],FamilyTree.templates.split.node='<circle cx="5" cy="5" r="5" fill="none" stroke-width="1" stroke="#aeaeae"></circle>',FamilyTree.templates.mirror={linkAdjuster:{},link:"",node:"",nodeMenuButton:"",size:[0,0]},FamilyTree.prototype.hideTreeMenu=function(e,t){if(this._tree_menu_temp){var i=this._tree_menu_temp;if(this.manager.oldNodes=this.nodes,this.nodes=i.nodes,this.manager.maxX=i.maxX,this.manager.maxY=i.maxY,this.manager.minX=i.minX,this.manager.minY=i.minY,this.manager.roots=i.roots,this.manager.nodes=i.nodes,this.manager.rootList=i.rootList,this.manager.visibleNodeIds=i.visibleNodeIds,this.manager.bordersByRootIdAndLevel=i.bordersByRootIdAndLevel,this.config.roots=i.config.roots,this.config.nodes=i.config.nodes,this._tree_menu_temp=null,e){var r={id:i.id,animFromClickedNode:!1};this._draw(!0,FamilyTree.action.update,r,(function(){t&&t()}))}}},FamilyTree.prototype.showTreeMenu=function(e){null==e&&console.error("Call addNode without id");var t=this.getNode(e);t||console.error("Cannot get node id: "+e);var i=this.getNode(t.fid),r=this.getNode(t.mid),a=null,n=null,o=[],l=[];i&&(a=this.get(i.id)),r&&(n=this.get(r.id));for(var s=0;s<t.pids.length;s++){var d=this.get(t.pids[s]);d&&o.push(d)}for(s=0;s<t.ftChildrenIds.length;s++)l.push(this.get(t.ftChildrenIds[s]));var c=this.get(e);if(this._tree_menu_temp={maxX:this.manager.maxX,maxY:this.manager.maxY,minX:this.manager.minX,minY:this.manager.minY,roots:this.manager.roots,nodes:this.manager.nodes,rootList:this.manager.rootList,visibleNodeIds:this.manager.visibleNodeIds,bordersByRootIdAndLevel:this.manager.bordersByRootIdAndLevel,id:e,config:{roots:this.config.roots,nodes:this.config.nodes}},this.config.nodes=[],n)this.add(n);else{var m={id:"_ft_mother",templateName:"mother",_ft_method:"addParentNode",_ft_childId:e,_ft_type:"mid",_ft_data:{gender:"female"}};c.mid=m.id,a?(a.pids=[m.id],m.pids=[a.id],m._ft_data.pids=[a.id]):m.pids=["_ft_father"],this.add(m)}if(a)this.add(a);else{var p={id:"_ft_father",templateName:"father",_ft_method:"addParentNode",_ft_childId:e,_ft_type:"fid",_ft_data:{gender:"male"}};c.fid=p.id,n?(n.pids=[p.id],p.pids=[n.id],p._ft_data.pids=[n.id]):p.pids=["_ft_mother"],this.add(p)}for(s=0;s<o.length;s++)this.add(o[s]);c.pids||(c.pids=[]);var h={id:"_ft_partner",pids:[e],templateName:"partner",_ft_method:"addPartnerNode",_ft_data:{pids:[e]}};if("male"==c.gender?(h.templateName="wife",h._ft_data.gender="female"):"female"==c.gender&&(h.templateName="husband",h._ft_data.gender="male"),c.pids.push(h.id),this.add(h),c.pids)for(s=0;s<c.pids.length;s++){if(this.add({id:"_ft_child_group_"+s,mid:e,fid:c.pids[s],tags:["children-group"]}),"_ft_partner"==c.pids[s]){var u={id:"_ft_son_"+s,stpid:"_ft_child_group_"+s,templateName:"son",_ft_method:"addChildAndPartnerNodes",_ft_childData:{mid:t.id,fid:h.id,gender:"male"},_ft_parentData:{pids:[e]},_ft_id:e},y={id:"_ft_daughter_"+s,stpid:"_ft_child_group_"+s,templateName:"daughter",_ft_method:"addChildAndPartnerNodes",_ft_childData:{mid:t.id,fid:h.id,gender:"female"},_ft_parentData:{pids:[e]},_ft_id:e};"male"==c.gender&&"female"==h._ft_data.gender?(u._ft_childData.mid=h.id,u._ft_childData.fid=c.id,u._ft_parentData.gender=h._ft_data.gender,y._ft_childData.mid=h.id,y._ft_childData.fid=c.id,y._ft_parentData.gender=h._ft_data.gender):"female"==c.gender&&"male"==h._ft_data.gender&&(u._ft_childData.mid=c.id,u._ft_childData.fid=h.id,u._ft_parentData.gender=h._ft_data.gender,y._ft_childData.mid=c.id,y._ft_childData.fid=h.id,y._ft_parentData.gender=h._ft_data.gender),this.add(u),this.add(y)}else this.add({id:"_ft_son_"+s,stpid:"_ft_child_group_"+s,templateName:"son",_ft_method:"addChildNode",_ft_data:{mid:e,fid:c.pids[s],gender:"male"}}),this.add({id:"_ft_daughter_"+s,stpid:"_ft_child_group_"+s,templateName:"daughter",_ft_method:"addChildNode",_ft_data:{mid:e,fid:c.pids[s],gender:"female"}});for(var f=0;f<l.length;f++)l[f].mid!=c.pids[s]&&l[f].fid!=c.pids[s]||(l[f].mid=void 0,l[f].fid=void 0,l[f].stpid="_ft_child_group_"+s,this.add(l[f]))}this.add(c);var g=this;FamilyTree.isNEU(c.mid)?FamilyTree.isNEU(c.fid)||(this.config.roots=[c.fid]):this.config.roots=[c.mid];var b={id:e,treeMenuMode:!0};this._draw(!1,FamilyTree.action.update,b,(function(){FamilyTree._moveToBoundaryArea(g.getSvg(),g.getViewBox(),g.response.boundary)}))},void 0===FamilyTree&&(FamilyTree={}),FamilyTree.manager._initDinamicNode=function(e,t,i){t&&(e.lcn=t),i&&(e.isAssistant=!0);var r=FamilyTree.t(e.templateName);e.w=r&&r.size?r.size[0]:0,e.h=r&&r.size?r.size[1]:0,e.isSplit="split"==e.templateName},FamilyTree.manager._setCollpasedProperty=function(e,t,i,r,a,n,o){null==e.collapsed&&t.collapse&&t.collapse.allChildren?e.collapsed=!0:null==e.collapsed&&(e.collapsed=!1),a==FamilyTree.action.expand&&-1!=i.ids.indexOf(e.id)&&(e.collapsed=!1),a==FamilyTree.action.collapse&&(i.expandIds||i.collapseIds)?i.expandIds&&-1!=i.expandIds.indexOf(e.id)?e.collapsed=!1:i.collapseIds&&-1!=i.collapseIds.indexOf(e.id)&&(e.collapsed=!0):a==FamilyTree.action.collapse&&-1!=i.ids.indexOf(e.id)&&(e.collapsed=!0),a==FamilyTree.action.expand&&"all"==i.ids&&(e.collapsed=!1),a==FamilyTree.action.exporting&&i.expandChildren&&(e.collapsed=!1),a==FamilyTree.action.init&&null!=o?e.collapsed=!o.exp.has(e.id):a==FamilyTree.action.init?e.collapsed=t.collapse&&n>=t.collapse.level-1&&-1==r.indexOf(e.id):a!=FamilyTree.action.centerNode&&a!=FamilyTree.action.insert||-1!=r.indexOf(e.id)&&(e.collapsed=!1)},FamilyTree.manager._initNode=function(e,t,i,r,a,n,o,l,s,d,c){var m=n[i||"base"];null==e.parent&&FamilyTree.manager._setCollpasedProperty(e,m,s,l,a,r-1,c);for(var p=0;p<e.childrenIds.length;p++){var h=t[e.childrenIds[p]];if(FamilyTree.manager._setCollpasedProperty(h,m,s,l,a,r,c),!h.collapsed){if(h.parent=e,null!=h.ppid){var u=t[h.ppid];u&&(h.parentPartner=u)}(-1!=h.tags.indexOf("left-partner")||-1!=h.tags.indexOf("right-partner")||-1!=h.tags.indexOf("partner")||h.parentPartner)&&-1==d.indexOf(e.id)&&d.push(e.id),e.children.push(h)}}if(e.min||a!=FamilyTree.action.minimize||(s.all||s.id==e.id)&&(e.min=!0),!0===e.min&&a==FamilyTree.action.maximize&&(s.all||s.id==e.id)&&(e.min=!1),a==FamilyTree.action.init&&null!=c&&(e.min=c.min.has(e.id)),!e.min)for(p=0;p<e.stChildrenIds.length;p++){(h=t[e.stChildrenIds[p]]).stParent=e,e.stChildren.push(h)}var y=FamilyTree.t(e.templateName,e.min);e.w=y&&y.size?y.size[0]:0,e.h=y&&y.size?y.size[1]:0,e.padding=y&&y.padding?y.padding:[0,0,0,0],null!=r&&(e.level=r),i&&(e.lcn=i);var f=FamilyTree._getSubLevels(e.tags,o.tags);f>0&&(e.subLevels=f),-1!=e.tags.indexOf("assistant")&&null!=e.parent&&(e.isAssistant=!0),FamilyTree.events.publish("node-created",[e])},FamilyTree.manager._iterate=function(e,t,i,r,a,n,o,l,s,d,c,m,p,h,u,y){if(FamilyTree.manager._initNode(t,i,s,r,m,d,c,p,h,u,y),t.isAssistant&&(n[t.pid]||(n[t.pid]=[]),n[t.pid].push(t.id)),t.subLevels>0&&o.push(t.id),FamilyTree.MIXED_LAYOUT_FOR_NODES_WITH_COLLAPSED_CHILDREN&&!t.isAssistant&&t.parent){if(t.parent&&t.parent.children.length&&t.parent.children[t.parent.children.length-1]==t){for(var f=[],g=0,b=0,T=0;T<t.parent.children.length;T++){-1==(v=t.parent.children[T]).tags.indexOf("partner")&&-1==v.tags.indexOf("left-partner")&&-1==v.tags.indexOf("right-partner")&&-1==v.tags.indexOf("assistant")&&0==v.children.length?f.push(v.id):-1!=v.tags.indexOf("assistant")?g++:-1==v.tags.indexOf("partner")&&-1==v.tags.indexOf("left-partner")&&-1==v.tags.indexOf("right-partner")||b++}(FamilyTree.MIXED_LAYOUT_ALL_NODES&&f.length>1&&f.length==t.parent.children.length-g-b||!FamilyTree.MIXED_LAYOUT_ALL_NODES&&f.length>1)&&(l[t.pid]=f)}}else if(!t.isAssistant&&0==t.childrenIds.length&&t.parent&&!l[t.pid]){for(f=[],g=0,b=0,T=0;T<t.parent.children.length;T++){var v;-1==(v=t.parent.children[T]).tags.indexOf("partner")&&-1==v.tags.indexOf("left-partner")&&-1==v.tags.indexOf("right-partner")&&-1==v.tags.indexOf("assistant")&&0==v.childrenIds.length?f.push(v.id):-1!=v.tags.indexOf("assistant")?g++:-1==v.tags.indexOf("partner")&&-1==v.tags.indexOf("left-partner")&&-1==v.tags.indexOf("right-partner")||b++}(FamilyTree.MIXED_LAYOUT_ALL_NODES&&f.length>1&&f.length==t.parent.childrenIds.length-g-b||!FamilyTree.MIXED_LAYOUT_ALL_NODES&&f.length>1)&&(l[t.pid]=f)}t.stChildren.length&&(e.stContainerNodes||(e.stContainerNodes=[]),e.stContainerNodes.push(t));for(var F=0;F<t.stChildren.length;F++){var x="";for(T=0;T<t.tags.length;T++)if(d[t.tags[T]]){x=t.tags[T];break}a.push(t.stChildren[F].id),FamilyTree.manager._iterate(e,t.stChildren[F],i,0,a,n,o,l,x,d,c,m,p,h,u,y)}r++;for(F=0;F<t.children.length;F++)FamilyTree.manager._iterate(e,t.children[F],i,r,a,n,o,l,s,d,c,m,p,h,u,y)},FamilyTree.manager.__createNodes=function(e,t,i,r,a,n,o){for(var l=i.nodes,s=[],d=0;d<l.length;d++){var c,m=l[d];c=FamilyTree.STRING_TAGS?m.tags?m.tags.split(","):[]:Array.isArray(m.tags)?m.tags.slice(0):[];var p=FamilyTree._getTemplate(c,i.tags,i.template),h=new FamilyTree.node(m.id,m.pid,c,p);FamilyTree.isNEU(m.ppid)||(h.ppid=m.ppid),FamilyTree.isNEU(m.stpid)||(h.stpid=m.stpid),null!=i.orderBy&&(h.order=FamilyTree.manager._getOrderFieldValue(m,i.orderBy)),e[m.id]=h,s.push(m.id)}null!=i.orderBy&&s.sort((function(t,r){var a=e[t].order,n=e[r].order;return"number"==typeof a||"number"==typeof n?(null==a&&(a=-1),null==n&&(n=-1),i.orderBy.desc?n-a:a-n):"string"==typeof a||"string"==typeof n?(null==a&&(a=""),null==n&&(n=""),i.orderBy.desc?n.localeCompare(a):a.localeCompare(n)):void 0}));for(d=0;d<s.length;d++){var u=s[d],y=(h=e[u],n?n[u]:null),f=e[h.stpid],g=e[h.pid];if(f||(h.stpid=null),g||(h.pid=null),f){var b=n?n[f.id]:null;b&&(f.min=b.min),f.stChildrenIds.push(h.id)}else g?(y&&(h.collapsed=y.collapsed,h.min=y.min),g.childrenIds.push(h.id)):(y&&(h.collapsed=y.collapsed,h.min=y.min),t.push(h),o.push(h.id));r==FamilyTree.action.init&&(h.min=FamilyTree._getMin(h,i))}},FamilyTree.manager._createNodes=function(e,t,i,r,a,n){var o={},l=[],s=[];if(FamilyTree.manager.__createNodes(o,l,e,i,r,a,s),null!=e.roots){l=[];for(var d=0;d<e.roots.length;d++){var c=o[e.roots[d]];if(c&&i==FamilyTree.action.centerNode){for(var m=c;null!=m.pid||null!=m.stpid;)m=null==m.pid&&null!=m.stpid?o[m.stpid]:o[m.pid];for(var p=o[r.id];null!=p.pid||null!=p.stpid;)p=null==p.pid&&null!=p.stpid?o[p.stpid]:o[p.pid];m==p&&(c=m)}if(c){for(var h=!1,u=0;u<l.length;u++)if(l[u].id==c.id){h=!0;break}if(!h){if(!FamilyTree.isNEU(c.pid))(B=(K=o[c.pid]).childrenIds.indexOf(c.id))>-1&&K.childrenIds.splice(B,1);l.push(c)}}}e.roots=[];for(d=0;d<l.length;d++)e.roots.push(l[d].id)}i==FamilyTree.action.exporting&&null!=r.id&&((f=o[r.id])&&(f.pid=null,l=[f]));var y=[];if(i==FamilyTree.action.init&&e.expand&&e.expand.nodes&&null==n)for(d=0;d<e.expand.nodes.length;d++){var f=o[e.expand.nodes[d]];for(!0===e.expand.allChildren&&FamilyTree.manager._addExpandedNodeIdsIterate(f,o,y);f;)y.push(f.id),null==f.pid&&null!=f.stpid?(f=o[f.stpid]).min=!1:f=o[f.pid]}else if(i==FamilyTree.action.centerNode){for(var g=o[r.id];g;){if(y.push(g.id),r.options.parentState===FamilyTree.COLLAPSE_PARENT_NEIGHBORS&&g)for(d=0;d<g.childrenIds.length;d++){(O=o[g.childrenIds[d]]).collapsed=!0}null==g.pid&&null!=g.stpid?(g=o[g.stpid]).min=!1:g=o[g.pid]}g=o[r.id];if(r.options.childrenState===FamilyTree.COLLAPSE_SUB_CHILDRENS)for(d=0;d<g.childrenIds.length;d++){(T=o[g.childrenIds[d]]).collapsed=!1;for(var b=0;b<T.childrenIds.length;b++){o[T.childrenIds[b]].collapsed=!0}}if(r.options.parentState===FamilyTree.COLLAPSE_PARENT_SUB_CHILDREN_EXCEPT_CLICKED)if(K=o[g.pid])for(d=0;d<K.childrenIds.length;d++){var T;if((T=o[K.childrenIds[d]])!=g){T.collapsed=!1;for(b=0;b<T.childrenIds.length;b++){o[T.childrenIds[b]].collapsed=!0}}}}else if(i==FamilyTree.action.insert)for(f=o[r.insertedNodeId];f;)y.push(f.id),null==f.pid&&null!=f.stpid?(f=o[f.stpid]).min=!1:f=o[f.pid];var v=[],F={},x=[],_={},w=[];for(d=0;d<l.length;d++)FamilyTree.manager._iterate(l[d],l[d],o,0,v,F,x,_,"",t,e,i,y,r,w,n);for(d=l.length-1;d>=0;d--)l[d].collapsed&&l.splice(d,1);for(d=0;d<w.length;d++){f=o[w[d]];var k=[],S=[],I=[],C={},A=0,N=0,L=0,M=[],E=[];for(b=0;b<f.children.length;b++){(O=f.children[b]).isAssistant?k.push(O.id):-1!=O.tags.indexOf("right-partner")?(O.isPartner=1,O.children=[],S.push(O.id)):-1!=O.tags.indexOf("left-partner")?(O.isPartner=2,O.children=[],I.push(O.id)):-1==O.tags.indexOf("partner")||A%2?-1!=O.tags.indexOf("partner")&&A%2?(O.isPartner=2,O.children=[],I.push(O.id),A++):O.parentPartner?(C[O.parentPartner.id]||(C[O.parentPartner.id]=[]),C[O.parentPartner.id].push(O.id)):k.push(O.id):(O.isPartner=1,O.children=[],S.push(O.id),A++)}f.children=[];for(b=0;b<S.length;b++){C[(O=o[S[b]]).id]?f.children.push(O):f.children.splice(0,0,O)}for(b=0;b<I.length;b++){C[(O=o[I[b]]).id]?f.children.push(O):f.children.splice(0,0,O)}for(b=I.length-1;b>=0;b--)if(C[I[b]])for(u=0;u<C[I[b]].length;u++)f.children.push(o[C[I[b]][u]]),N++,-1==E.indexOf(I[b])&&E.push(I[b]);for(b=0;b<k.length;b++){var O=o[k[b]];f.children.push(O)}for(b=0;b<S.length;b++)if(C[S[b]])for(u=0;u<C[S[b]].length;u++)f.children.push(o[C[S[b]][u]]),L++,-1==M.indexOf(S[b])&&M.push(S[b]);f.partnerSeparation=Math.max(E.length,M.length)*e.partnerChildrenSplitSeparation+e.minPartnerSeparation,k.length||!N||L?k.length||N||!L?k.length||1!=N||1!=L?k.length||N||L?!k.length||N||L?k.length&&(N||L)?f.hasPartners=7:f.hasPartners=1:f.hasPartners=6:f.hasPartners=5:f.hasPartners=4:f.hasPartners=3:f.hasPartners=2}for(d=0;d<x.length;d++){if((J=t[(f=o[x[d]]).lcn?f.lcn:"base"]).layout==FamilyTree.normal||!_[f.pid])for(b=0;b<f.subLevels;b++){var B,P=new FamilyTree.node(f.id+"_sub_level_index_"+b,f.pid,[],"subLevel");if(FamilyTree.manager._initDinamicNode(P,f.lcn),K=f.parent)(B=K.children.indexOf(f))>-1&&(K.children.splice(B,1),K.children.splice(B,0,P)),P.children.push(f),P.parent=K,f.parent=P,o[P.id]=P}}for(var U in F){(K=o[U]).hasAssistants=!0;P=new FamilyTree.node(K.id+"_split_assitant_0",K.id,["assistant"],"split");FamilyTree.manager._initDinamicNode(P,K.lcn,!0),o[P.id]=P;var H=[];for(b=K.children.length-1;b>=0;b--){(O=K.children[b]).isAssistant?(O.parent=null,K.children.splice(b,1),H.splice(0,0,O.id)):O.isPartner||(O.parent&&_[O.parent.id]&&P&&O.parent.id!=P.id&&(Object.defineProperty(_,P.id,Object.getOwnPropertyDescriptor(_,O.parent.id)),delete _[O.parent.id]),O.parent=P,P.children.unshift(O),K.children.splice(b,1))}if(H.length%2){var z=o[H[H.length-1]],j=new FamilyTree.node(z.id+"_mirror",z.pid,[],"mirror");FamilyTree.manager._initDinamicNode(j,z.lcn,!0),z._m=j.id,j.isAssistant=!0,j.w=z.w,j.h=z.h,o[j.id]=j,H.splice(H.length-1,0,j.id)}var D=1;for(b=H.length-1;b>=0;b--)if(b%2&&b!=H.length-1){var R=new FamilyTree.node(K.id+"_split_assitant_"+D,null,[],"split");FamilyTree.manager._initDinamicNode(R,K.lcn,!0),o[R.id]=R,H.splice(b,0,R.id),D++}else b%2&&H.splice(b,0,P.id);for(b=0;b<H.length;b+=3){var q=null;q=0==b?K:o[H[b-2]];var X=o[H[b]],Y=o[H[b+1]],V=o[H[b+2]];X.parent=q,Y.parent=q,V.parent=q,q.children.push(X),q.children.push(Y),q.children.push(V)}}var $=!1;for(var W in t){if((J=t[W]).layout==FamilyTree.mixed||J.layout==FamilyTree.tree||J.layout==FamilyTree.treeRightOffset||J.layout==FamilyTree.treeLeftOffset){$=!0;break}}if($){var G={nodes:o,config:e,action:i,actionParams:r};for(var U in _){var K,J;if((J=t[(K=o[U]).lcn?K.lcn:"base"]).layout==FamilyTree.mixed||J.layout==FamilyTree.tree||J.layout==FamilyTree.treeRightOffset||J.layout==FamilyTree.treeLeftOffset)if(G.pnode=K,G.layout=J.layout,G.childrenIds=_[U],G.lastChildrenPidIds=_,FamilyTree.events.publish("layout",[G]),G.layout==FamilyTree.mixed){var Z=G.childrenIds;for(d=Z.length-1;d>=0;d--){K=(O=o[Z[d]]).parent,O.layout=FamilyTree.mixed;for(b=K.children.length-1;b>=0;b--)if(O.id==K.children[b].id){K.children.splice(b,1);break}if(d>0){var Q=o[Z[d-1]];O.parent=Q,O.layout=FamilyTree.mixed,Q.children.push(O)}else K.children.push(O)}}else if(G.layout==FamilyTree.tree||G.layout==FamilyTree.treeRightOffset||G.layout==FamilyTree.treeLeftOffset){P=new FamilyTree.node(K.id+"_split_0",K.id,[],"split");FamilyTree.manager._initDinamicNode(P,K.lcn),o[P.id]=P,P.layout=FamilyTree.tree;var ee=[];for(d=G.childrenIds.length-1;d>=0;d--){for(O=o[G.childrenIds[d]],b=0;b<K.children.length;b++)K.children[b].id==O.id&&K.children.splice(b,1);if(O.parent=null,O.layout=FamilyTree.tree,G.layout==FamilyTree.treeRightOffset&&ee.splice(0,0,O.id),G.layout==FamilyTree.treeLeftOffset||G.layout==FamilyTree.treeRightOffset){var te=new FamilyTree.node(O.id+"_mirror",null,[],"mirror");FamilyTree.manager._initDinamicNode(te,O.lcn),te.layout=FamilyTree.tree,o[te.id]=te,ee.splice(0,0,te.id)}G.layout!=FamilyTree.treeRightOffset&&ee.splice(0,0,O.id)}for(D=1,b=ee.length-1;b>=0;b--)if(b%2&&b!=ee.length-1){R=new FamilyTree.node(K.id+"_split_"+D,null,[],"split");FamilyTree.manager._initDinamicNode(R,K.lcn),R.layout=FamilyTree.tree,o[R.id]=R,ee.splice(b,0,R.id),D++}else b%2&&ee.splice(b,0,P.id);for(b=0;b<ee.length;b+=3){q=null;0==b&&(q=K);X=o[ee[b]],Y=o[ee[b+1]],V=o[ee[b+2]];0!=b&&(q=o[ee[b-3]]),0==b||Y||(q=o[ee[b-2]]),X.parent=q,q.children.push(X),Y&&(0!=b&&(q=o[ee[b-2]]),Y.parent=q,q.children.push(Y)),V&&(0!=b&&(q=o[ee[b-1]]),V.parent=q,q.children.push(V))}}}}return{nodes:o,roots:l,rootList:s}},FamilyTree.manager._getOrderFieldValue=function(e,t){var i=t;return t.field&&(i=t.field),e[i]},FamilyTree.manager._getNodeWidth=function(e,t){switch(t.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:return e.w;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:return e.h}return 0},FamilyTree.manager._isVisible=function(e,t,i,r){if(null!=e.x&&null!=e.y){if(t.lazyLoading&&r!==FamilyTree.action.exporting){function a(e,t){var i=e.x,r=e.y,a=e.w,n=e.h,o=t[0]-FamilyTree.LAZY_LOADING_FACTOR,l=t[2]+FamilyTree.LAZY_LOADING_FACTOR+t[0],s=t[1]-FamilyTree.LAZY_LOADING_FACTOR,d=t[3]+FamilyTree.LAZY_LOADING_FACTOR+t[1],c=i+a>o&&l>i;return c&&(c=r+n>s&&d>r),c}if(a(e,i))return!0;for(var n=0;n<e.children.length;n++)if(a(e.children[n],i))return!0;return!1}return!0}},FamilyTree.manager.getAllFields=function(e){var t=[FamilyTree.TAGS];for(var i in e.nodeBinding)t.push(e.nodeBinding[i]);for(i=0;i<e.nodes.length;i++)for(var r in e.nodes[i])r!==FamilyTree.ID&&r!==FamilyTree.TAGS&&r!==FamilyTree.NODES&&r!==FamilyTree.PID&&r!==FamilyTree.STPID&&(e.nodeBinding[r]||t.has(r)||t.push(r));return t},FamilyTree.manager._getMostDeepChild=function(e){if(e){var t=e;return function e(i){i.sl>t.sl&&(t=i);for(var r=0;r<i.children.length;r++)e(i.children[r])}(e),t}},FamilyTree.manager._getResponse=function(e,t,i,r,a,n,o,l,s,d,c,m,p,h,u){var y=d[0],f=[],g={top:null,left:null,bottom:null,right:null,minX:null,maxX:null,minY:null,maxY:null},b=[[],[],[]],T=a-o+2*r.padding,v=n-l+2*r.padding,F=FamilyTree.getScale(s,e,t,r.scaleInitial,r.scaleMax,r.scaleMin,T,v);if(g.top=l-r.padding,g.left=o-r.padding,g.bottom=n+r.padding-t/F,g.right=a+r.padding-e/F,g.maxX=a,g.minX=o,g.maxY=n,g.minY=l,0==d.length||null==s&&!u&&r.align==FamilyTree.CENTER){var x=Math.ceil(e/F),_=Math.ceil(t/F),w=0,k=0;if(x-2*r.padding>=a-o)switch(w=(a+o)/2-x/2,r.orientation){case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:w=(o-a)/2-x/2}else switch(w=y.x-x/2+FamilyTree.manager._getNodeWidth(y,r)/2,r.orientation){case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:(w=-(x/2-(o-a)/2))<r.padding-x&&(w=r.padding-x);break;case FamilyTree.orientation.left:case FamilyTree.orientation.bottom_left:case FamilyTree.orientation.top_left:case FamilyTree.orientation.left_top:(w=-(x/2-(a-o)/2))>-r.padding&&(w=-r.padding)}if(_-2*r.padding>=n-l)switch(k=(n+l)/2-_/2,r.orientation){case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:k=(l-n)/2-_/2}else switch((k=-(_/2-(n-l)/2))>-r.padding&&(k=-r.padding),r.orientation){case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:(k=-(_/2-(l-n)/2))<r.padding-_&&(k=r.padding-_);break;case FamilyTree.orientation.left:case FamilyTree.orientation.right:k=y.y-_/2+FamilyTree.manager._getNodeWidth(y,r)/2}s=[w,k,x,_]}else if(null==s&&!u&&r.align==FamilyTree.ORIENTATION){x=Math.ceil(e/F),_=Math.ceil(t/F),w=0,k=0;switch(r.orientation){case FamilyTree.orientation.top:w=y.x-x/2+FamilyTree.manager._getNodeWidth(y,r)/2,k=-r.padding;break;case FamilyTree.orientation.bottom:w=y.x-x/2+FamilyTree.manager._getNodeWidth(y,r)/2,k=r.padding-_;break;case FamilyTree.orientation.left:w=-r.padding,k=y.y-_/2+FamilyTree.manager._getNodeWidth(y,r)/2;break;case FamilyTree.orientation.right:w=r.padding-x,k=y.y-_/2+FamilyTree.manager._getNodeWidth(y,r)/2;break;case FamilyTree.orientation.top_left:w=-r.padding,k=-r.padding;break;case FamilyTree.orientation.right_top:w=r.padding-x,k=-r.padding;break;case FamilyTree.orientation.left_top:w=-r.padding,k=-r.padding;break;case FamilyTree.orientation.bottom_left:w=-r.padding,k=r.padding-_}s=[w,k,x,_],r.sticky&&(s[0]<g.left&&s[0]<g.right&&(s[0]=g.left>g.right?g.right:g.left),s[0]>g.right&&s[0]>g.left&&(s[0]=g.left>g.right?g.left:g.right),s[1]<g.top&&s[1]<g.bottom&&(s[1]=g.top>g.bottom?g.bottom:g.top),s[1]>g.bottom&&s[1]>g.top&&(s[1]=g.top>g.bottom?g.top:g.bottom))}if(c==FamilyTree.action.centerNode||c==FamilyTree.action.maximize){var S=p[m.id];1==m.options.horizontal&&(s[0]=S.x+S.w/2-s[2]/2),1==m.options.vertical&&(s[1]=S.y+S.h/2-s[3]/2),r.sticky&&(s[0]<g.left&&s[0]<g.right&&(s[0]=g.left>g.right?g.right:g.left),s[0]>g.right&&s[0]>g.left&&(s[0]=g.left>g.right?g.left:g.right),s[1]<g.top&&s[1]<g.bottom&&(s[1]=g.top>g.bottom?g.bottom:g.top),s[1]>g.bottom&&s[1]>g.top&&(s[1]=g.top>g.bottom?g.top:g.bottom))}if(c==FamilyTree.action.insert||c==FamilyTree.action.expand||c==FamilyTree.action.collapse||c==FamilyTree.action.update||c==FamilyTree.action.centerNode||c==FamilyTree.action.maximize){var I=null;if(c==FamilyTree.action.insert&&m&&null!=m.insertedNodeId&&null!=m.insertedNodeId)I=p[m.insertedNodeId];else if(c==FamilyTree.action.update&&m&&null!=m.visId&&null!=m.visId)I=p[m.visId];else if(c!=FamilyTree.action.expand&&c!=FamilyTree.action.collapse&&c!=FamilyTree.action.maximize||!m||null==m.id||null==m.id){if(c==FamilyTree.action.centerNode||c==FamilyTree.action.maximize){switch(r.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:m.options.vertical||(I=p[m.id]);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:m.options.horizontal||(I=p[m.id])}I&&(I=FamilyTree.manager._getMostDeepChild(I,p))}}else I=p[m.id],I=FamilyTree.manager._getMostDeepChild(I,p);if(!FamilyTree.FIXED_POSITION_ON_CLICK&&I)switch(r.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:var C=I.y+I.h-s[3]+r.padding;s[1]<C&&(s[1]=C);break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:C=I.y-r.padding;s[1]>C&&(s[1]=C);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:C=I.x-r.padding;s[0]>C&&(s[0]=C);break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:C=I.x+I.w-s[2]+r.padding;s[0]<C&&(s[0]=C)}}for(var A=0;A<d.length;A++)FamilyTree.manager._iterate2(d[A],p,r,s,c,m,f,h,i,b);return{animations:b,boundary:g,viewBox:s,visibleNodeIds:f,nodes:p,allFields:FamilyTree.manager.getAllFields(r)}},FamilyTree.manager._iterate2=function(e,t,i,r,a,n,o,l,s,d){if(FamilyTree.manager._isVisible(e,i,r,a)){o.push(e.id);var c=null;if((a==FamilyTree.action.expand||a==FamilyTree.action.collapse||a==FamilyTree.action.maximize)&&l&&l[e.id]&&"expandCollapseToLevel"==n.method){if(c={x:(u=l[e.id]).x,y:u.y},u){c={x:u.x,y:u.y};for(var m=e,p=null;null!=m;)l[m.id]&&l[m.id].collapsed&&(p=m),m=m.parent;p&&p.parent&&(c={x:p.parent.x,y:p.parent.y})}if(y=t[n.id]){for(m=e.parent;null!=m;)m=m.parent;m&&(c={x:y.x+y.w/2-e.w/2,y:y.y+y.h/2-e.h/2})}}else if((a==FamilyTree.action.expand||a==FamilyTree.action.collapse)&&l&&l[e.id]){if(c={x:(u=l[e.id]).x,y:u.y},"all"==n.ids&&u){c={x:u.x,y:u.y};for(m=e,p=null;null!=m;)l[m.id]&&l[m.id].collapsed&&(p=m),m=m.parent;p&&p.parent&&(c={x:p.parent.x,y:p.parent.y})}if(y=t[n.id]){for(m=e.parent;null!=m&&-1==n.ids.indexOf(e.id)&&-1==n.ids.indexOf(m.id);)m=m.parent;m&&(c={x:y.x+y.w/2-e.w/2,y:y.y+y.h/2-e.h/2})}}else if(a==FamilyTree.action.centerNode&&l&&l[e.id]){if(null!=(u=l[e.id]).x&&null!=u.y&&(c={x:u.x,y:u.y}),(h=t[n.id])&&h==e)(m=e.parent)&&m.id==n.id&&(c={x:h.x+h.w/2-e.w/2,y:h.y+h.h/2-e.h/2})}else if(a==FamilyTree.action.maximize&&l&&l[e.id]){var h;if(null!=(u=l[e.id]).x&&null!=u.y&&(c={x:u.x,y:u.y}),(h=t[n.id])&&h==e)(m=e.parent)&&m.id==n.id&&(c={x:h.x+h.w/2-e.w/2,y:h.y+h.h/2-e.h/2})}else if(a==FamilyTree.action.minimize&&l&&l[e.id]){c={x:(u=l[e.id]).x,y:u.y}}else if(a==FamilyTree.action.insert&&n&&n.insertedNodeId==e.id&&e.parent)c={x:e.parent.x,y:e.parent.y};else if(a!=FamilyTree.action.update&&a!=FamilyTree.action.insert||!l)a!==FamilyTree.action.exporting&&a!==FamilyTree.action.init&&-1==s.indexOf(e.id)&&(d[0].push(e.id),d[1].push({opacity:0}),d[2].push({opacity:1}));else{var u,y;if((!(u=l[e.id])||FamilyTree.isNEU(u.x)&&FamilyTree.isNEU(u.y))&&n){if(y=t[n.id]){for(m=y;m&&m.id==e.id;)m=m.parent;m&&(c={x:y.x,y:y.y})}}else u&&(c={x:u.x,y:u.y})}null!=c&&null!=c.x&&null!=c.y&&(c.x==e.x&&c.y==e.y||(d[0].push(e.id),d[1].push({transform:[1,0,0,1,c.x,c.y]}),d[2].push({transform:[1,0,0,1,e.x,e.y]})))}for(var f=0;f<e.stChildren.length;f++)FamilyTree.manager._iterate2(e.stChildren[f],t,i,r,a,n,o,l,s,d);for(f=0;f<e.children.length;f++)FamilyTree.manager._iterate2(e.children[f],t,i,r,a,n,o,l,s,d)},FamilyTree.manager._addExpandedNodeIdsIterate=function(e,t,i){for(var r=0;r<e.childrenIds.length;r++)i.push(e.childrenIds[r]),FamilyTree.manager._addExpandedNodeIdsIterate(t[e.childrenIds[r]],t,i)},FamilyTree.manager._setMinMaxXYAdjustifyIterate=function(e,t,i,r,a,n,o){e.x+=n.x,e.y+=n.y,FamilyTree._setMinMaxXY(e,i);for(var l=0;l<e.stChildren.length;l++)FamilyTree.manager._setMinMaxXYAdjustifyIterate(e.stChildren[l],e.stChildren[l],i,0,a,n,o);e.isPartner?e.sl=r-1:e.sl=r,null==a[t.id]&&(a[t.id]={}),null==a[t.id][e.sl]&&(a[t.id][e.sl]={minX:null,minY:null,maxX:null,maxY:null}),e.layout||FamilyTree._setMinMaxXY(e,a[t.id][e.sl]),r++;for(l=0;l<e.children.length;l++)FamilyTree.manager._setMinMaxXYAdjustifyIterate(e.children[l],t,i,r,a,n,o)},FamilyTree.manager._doNotChangePositionOfClickedNodeIfAny=function(e,t,i,r,a,n){if(i!=FamilyTree.action.expand&&i!=FamilyTree.action.collapse&&i!=FamilyTree.action.minimize&&i!=FamilyTree.action.maximize&&i!=FamilyTree.action.centerNode&&i!=FamilyTree.action.update&&i!=FamilyTree.action.insert)return{x:0,y:0};if(i==FamilyTree.action.update&&(!r||null==r.id)){if(!e||!e.length)return{x:0,y:0};r={id:e[0].id}}if(null==r.id)return{x:0,y:0};var o=r.id;(i==FamilyTree.action.minimize&&t[o].parent||i==FamilyTree.action.maximize&&t[o].parent)&&(o=t[o].pid);var l=t[o],s=a[o];return s?{x:(s.x?s.x:0)-l.x,y:(s.y?s.y:0)-l.y}:{x:0,y:0}},void 0===FamilyTree&&(FamilyTree={}),FamilyTree.VERSION="8.00.21",FamilyTree.orientation={},FamilyTree.orientation.top=0,FamilyTree.orientation.bottom=1,FamilyTree.orientation.right=2,FamilyTree.orientation.left=3,FamilyTree.orientation.top_left=4,FamilyTree.orientation.bottom_left=5,FamilyTree.orientation.right_top=6,FamilyTree.orientation.left_top=7,FamilyTree.CENTER=8,FamilyTree.ORIENTATION=9,FamilyTree.TEXT_THRESHOLD=400,FamilyTree.IMAGES_THRESHOLD=100,FamilyTree.LINKS_THRESHOLD=200,FamilyTree.BUTTONS_THRESHOLD=70,FamilyTree.ANIM_THRESHOLD=50,FamilyTree.attr={},FamilyTree.attr.l="data-l",FamilyTree.attr.id="data-id",FamilyTree.attr.sl="data-sl",FamilyTree.attr.lbl="data-lbl",FamilyTree.attr.val="data-val",FamilyTree.attr.tlbr="data-tlbr",FamilyTree.attr.item="data-item",FamilyTree.attr.layout="data-layout",FamilyTree.attr.node_id="data-n-id",FamilyTree.attr.link_id="data-l-id",FamilyTree.attr.field_name="data-f-name",FamilyTree.attr.c_link_to="data-c-l-to",FamilyTree.attr.c_link_from="data-c-l-from",FamilyTree.attr.s_link_to="data-s-l-to",FamilyTree.attr.s_link_from="data-s-l-from",FamilyTree.attr.control_add="data-ctrl-add",FamilyTree.attr.control_expcoll_id="data-ctrl-ec-id",FamilyTree.attr.control_up_id="data-ctrl-up-id",FamilyTree.attr.control_export_menu="data-ctrl-menu",FamilyTree.attr.control_node_menu_id="data-ctrl-n-menu-id",FamilyTree.attr.control_node_circle_menu_id="data-ctrl-n-c-menu-id",FamilyTree.attr.control_node_circle_menu_name="data-ctrl-n-c-menu-name",FamilyTree.attr.control_node_circle_menu_wrraper_id="data-ctrl-n-c-menu-wrapper-id",FamilyTree.attr.width="data-width",FamilyTree.attr.text_overflow="data-text-overflow",FamilyTree.ID="id",FamilyTree.PID="pid",FamilyTree.STPID="stpid",FamilyTree.TAGS="tags",FamilyTree.NODES="nodes",FamilyTree.ELASTIC="elastic",FamilyTree.MAX_DEPTH=200,FamilyTree.SCALE_FACTOR=1.44,FamilyTree.LAZY_LOADING_FACTOR=500,FamilyTree.action={},FamilyTree.action.expand=0,FamilyTree.action.collapse=1,FamilyTree.action.maximize=101,FamilyTree.action.minimize=102,FamilyTree.action.expandCollapse=501,FamilyTree.action.edit=1,FamilyTree.action.zoom=2,FamilyTree.action.ctrlZoom=22,FamilyTree.action.scroll=41,FamilyTree.action.xScroll=3,FamilyTree.action.yScroll=4,FamilyTree.action.none=5,FamilyTree.action.init=6,FamilyTree.action.update=7,FamilyTree.action.pan=8,FamilyTree.action.centerNode=9,FamilyTree.action.resize=10,FamilyTree.action.insert=11,FamilyTree.action.insertfirst=12,FamilyTree.action.details=13,FamilyTree.action.exporting=14,FamilyTree.none=400001,FamilyTree.scroll={},FamilyTree.scroll.visible=1,FamilyTree.scroll.smooth=12,FamilyTree.scroll.speed=120,FamilyTree.scroll.safari={smooth:12,speed:250},FamilyTree.match={},FamilyTree.match.height=100001,FamilyTree.match.width=100002,FamilyTree.match.boundary=100003,FamilyTree.COLLAPSE_PARENT_NEIGHBORS=1,FamilyTree.COLLAPSE_SUB_CHILDRENS=2,FamilyTree.COLLAPSE_PARENT_SUB_CHILDREN_EXCEPT_CLICKED=3,FamilyTree.normal=0,FamilyTree.mixed=1,FamilyTree.tree=2,FamilyTree.treeLeftOffset=3,FamilyTree.treeRightOffset=4,FamilyTree.nodeOpenTag="<g "+FamilyTree.attr.node_id+'="{id}" style="opacity: {opacity}" transform="matrix(1,0,0,1,{x},{y})" class="{class}" '+FamilyTree.attr.sl+'="{sl}" '+FamilyTree.attr.l+"={level} {lcn}>",FamilyTree.linkOpenTag="<g "+FamilyTree.attr.link_id+'="[{id}][{child-id}]" class="{class}">',FamilyTree.expcollOpenTag="<g "+FamilyTree.attr.control_expcoll_id+'="{id}" transform="matrix(1,0,0,1,{x},{y})"  style="cursor:pointer;">',FamilyTree.upOpenTag="<g "+FamilyTree.attr.control_up_id+'="{id}" transform="matrix(1,0,0,1,{x},{y})" style="cursor:pointer;">',FamilyTree.linkFieldsOpenTag='<g transform="matrix(1,0,0,1,{x},{y}) rotate({rotate})">',FamilyTree.grCloseTag="</g>",FamilyTree.IT_IS_LONELY_HERE='<g transform="translate(-100, 0)" style="cursor:pointer;"  '+FamilyTree.attr.control_add+'="control-add"><text fill="#039be5">{link}</text></g>',FamilyTree.RES={},FamilyTree.RES.IT_IS_LONELY_HERE_LINK="It's lonely here, add your first node",FamilyTree.FIRE_DRAG_NOT_CLICK_IF_MOVE=3,FamilyTree.STRING_TAGS=!1,FamilyTree.MAX_NODES_MESS="The trial has expired or 200 nodes limit was reached! <br /><a style='color: #039BE5;' target='_blank' href='https://balkan.app/FamilyTreeJS/Docs/Evaluation'>See more</a>",FamilyTree.OFFLINE_MESS="The evaluation version requires internet connection! <br /><a style='color: #039BE5;' target='_blank' href='https://balkan.app/FamilyTreeJS/Docs/Evaluation'>See more</a>",FamilyTree.SEARCH_PLACEHOLDER="Search",FamilyTree.IMPORT_MESSAGE="Choose the columns (fields) in your data file that contain the required information.",FamilyTree.FIXED_POSITION_ON_CLICK=!1,FamilyTree.ADD_NEW_FIELD="Add new field",FamilyTree.ASSISTANT="Assistant",FamilyTree.RENDER_LINKS_BEFORE_NODES=!1,FamilyTree.A5w=420,FamilyTree.A5h=595,FamilyTree.A4w=595,FamilyTree.A4h=842,FamilyTree.A3w=842,FamilyTree.A3h=1191,FamilyTree.A2w=1191,FamilyTree.A2h=1684,FamilyTree.A1w=1684,FamilyTree.A1h=2384,FamilyTree.Letterw=612,FamilyTree.Letterh=791,FamilyTree.Legalw=612,FamilyTree.Legalh=1009,FamilyTree.LINK_ROUNDED_CORNERS=5,FamilyTree.MOVE_STEP=5,FamilyTree.MOVE_INTERVAL=25,FamilyTree.MIXED_LAYOUT_ALL_NODES=!0,FamilyTree.MIXED_LAYOUT_FOR_NODES_WITH_COLLAPSED_CHILDREN=!1,FamilyTree.CLINK_CURVE=1,FamilyTree.SEARCH_RESULT_LIMIT=10,FamilyTree.icon={},FamilyTree.icon.png=function(e,t,i){return'<svg width="'+e+'" height="'+t+'" viewBox="0 0 550.801 550.801"><path fill="'+i+'" d="M146.747,276.708c0-13.998-9.711-22.352-26.887-22.352c-6.99,0-11.726,0.675-14.204,1.355v44.927 c2.932,0.676,6.539,0.896,11.52,0.896C135.449,301.546,146.747,292.28,146.747,276.708z"/><path fill="'+i+'" d="M488.426,197.019H475.2v-63.816c0-0.398-0.063-0.799-0.116-1.202c-0.021-2.534-0.827-5.023-2.562-6.995L366.325,3.694 c-0.032-0.031-0.063-0.042-0.085-0.076c-0.633-0.707-1.371-1.295-2.151-1.804c-0.231-0.155-0.464-0.285-0.706-0.419 c-0.676-0.369-1.393-0.675-2.131-0.896c-0.2-0.056-0.38-0.138-0.58-0.19C359.87,0.119,359.037,0,358.193,0H97.2 c-11.918,0-21.6,9.693-21.6,21.601v175.413H62.377c-17.049,0-30.873,13.818-30.873,30.873v160.545 c0,17.043,13.824,30.87,30.873,30.87h13.224V529.2c0,11.907,9.682,21.601,21.6,21.601h356.4c11.907,0,21.6-9.693,21.6-21.601 V419.302h13.226c17.044,0,30.871-13.827,30.871-30.87v-160.54C519.297,210.838,505.47,197.019,488.426,197.019z M97.2,21.605 h250.193v110.513c0,5.967,4.841,10.8,10.8,10.8h95.407v54.108H97.2V21.605z M234.344,335.86v45.831h-31.601V229.524h40.184 l31.611,55.759c9.025,16.031,18.064,34.983,24.825,52.154h0.675c-2.257-20.103-2.933-40.643-2.933-63.44v-44.473h31.614v152.167 h-36.117l-32.516-58.703c-9.049-16.253-18.971-35.892-26.438-53.727l-0.665,0.222C233.906,289.58,234.344,311.027,234.344,335.86z M71.556,381.691V231.56c10.613-1.804,25.516-3.159,46.506-3.159c21.215,0,36.353,4.061,46.509,12.192 c9.698,7.673,16.255,20.313,16.255,35.219c0,14.897-4.959,27.549-13.999,36.123c-11.738,11.063-29.123,16.031-49.441,16.031 c-4.522,0-8.593-0.231-11.736-0.675v54.411H71.556V381.691z M453.601,523.353H97.2V419.302h356.4V523.353z M485.652,374.688 c-10.61,3.607-30.713,8.585-50.805,8.585c-27.759,0-47.872-7.003-61.857-20.545c-13.995-13.1-21.684-32.97-21.452-55.318 c0.222-50.569,37.03-79.463,86.917-79.463c19.644,0,34.783,3.829,42.219,7.446l-7.214,27.543c-8.369-3.617-18.752-6.55-35.458-6.55 c-28.656,0-50.341,16.256-50.341,49.22c0,31.382,19.649,49.892,47.872,49.892c7.895,0,14.218-0.901,16.934-2.257v-31.835h-23.493 v-26.869h56.679V374.688z"/></svg>'},FamilyTree.icon.pdf=function(e,t,i){return'<svg width="'+e+'" height="'+t+'" viewBox="0 0 550.801 550.801"><path fill="'+i+'" d="M160.381,282.225c0-14.832-10.299-23.684-28.474-23.684c-7.414,0-12.437,0.715-15.071,1.432V307.6 c3.114,0.707,6.942,0.949,12.192,0.949C148.419,308.549,160.381,298.74,160.381,282.225z"/><path fill="'+i+'" d="M272.875,259.019c-8.145,0-13.397,0.717-16.519,1.435v105.523c3.116,0.729,8.142,0.729,12.69,0.729 c33.017,0.231,54.554-17.946,54.554-56.474C323.842,276.719,304.215,259.019,272.875,259.019z"/><path fill="'+i+'" d="M488.426,197.019H475.2v-63.816c0-0.398-0.063-0.799-0.116-1.202c-0.021-2.534-0.827-5.023-2.562-6.995L366.325,3.694 c-0.032-0.031-0.063-0.042-0.085-0.076c-0.633-0.707-1.371-1.295-2.151-1.804c-0.231-0.155-0.464-0.285-0.706-0.419 c-0.676-0.369-1.393-0.675-2.131-0.896c-0.2-0.056-0.38-0.138-0.58-0.19C359.87,0.119,359.037,0,358.193,0H97.2 c-11.918,0-21.6,9.693-21.6,21.601v175.413H62.377c-17.049,0-30.873,13.818-30.873,30.873v160.545 c0,17.043,13.824,30.87,30.873,30.87h13.224V529.2c0,11.907,9.682,21.601,21.6,21.601h356.4c11.907,0,21.6-9.693,21.6-21.601 V419.302h13.226c17.044,0,30.871-13.827,30.871-30.87v-160.54C519.297,210.838,505.47,197.019,488.426,197.019z M97.2,21.605 h250.193v110.513c0,5.967,4.841,10.8,10.8,10.8h95.407v54.108H97.2V21.605z M362.359,309.023c0,30.876-11.243,52.165-26.82,65.333 c-16.971,14.117-42.82,20.814-74.396,20.814c-18.9,0-32.297-1.197-41.401-2.389V234.365c13.399-2.149,30.878-3.346,49.304-3.346 c30.612,0,50.478,5.508,66.039,17.226C351.828,260.69,362.359,280.547,362.359,309.023z M80.7,393.499V234.365 c11.241-1.904,27.042-3.346,49.296-3.346c22.491,0,38.527,4.308,49.291,12.928c10.292,8.131,17.215,21.534,17.215,37.328 c0,15.799-5.25,29.198-14.829,38.285c-12.442,11.728-30.865,16.996-52.407,16.996c-4.778,0-9.1-0.243-12.435-0.723v57.67H80.7 V393.499z M453.601,523.353H97.2V419.302h356.4V523.353z M484.898,262.127h-61.989v36.851h57.913v29.674h-57.913v64.848h-36.593 V232.216h98.582V262.127z"/></svg>'},FamilyTree.icon.svg=function(e,t,i){return'<svg width="'+e+'" height="'+t+'" viewBox="0 0 550.801 550.801"><path fill="'+i+'" d="M488.426,197.019H475.2v-63.816c0-0.398-0.063-0.799-0.116-1.202c-0.021-2.534-0.827-5.023-2.562-6.995L366.325,3.694 c-0.032-0.031-0.063-0.042-0.085-0.076c-0.633-0.707-1.371-1.295-2.151-1.804c-0.231-0.155-0.464-0.285-0.706-0.419 c-0.676-0.369-1.393-0.675-2.131-0.896c-0.2-0.056-0.38-0.138-0.58-0.19C359.87,0.119,359.037,0,358.193,0H97.2 c-11.918,0-21.6,9.693-21.6,21.601v175.413H62.377c-17.049,0-30.873,13.818-30.873,30.873v160.545 c0,17.043,13.824,30.87,30.873,30.87h13.224V529.2c0,11.907,9.682,21.601,21.6,21.601h356.4c11.907,0,21.6-9.693,21.6-21.601 V419.302h13.226c17.044,0,30.871-13.827,30.871-30.87v-160.54C519.297,210.838,505.47,197.019,488.426,197.019z M97.2,21.605 h250.193v110.513c0,5.967,4.841,10.8,10.8,10.8h95.407v54.108H97.2V21.605z M338.871,225.672L284.545,386.96h-42.591 l-51.69-161.288h39.967l19.617,68.196c5.508,19.143,10.531,37.567,14.36,57.67h0.717c4.061-19.385,9.089-38.527,14.592-56.953 l20.585-68.918h38.77V225.672z M68.458,379.54l7.415-30.153c9.811,5.021,24.888,10.051,40.439,10.051 c16.751,0,25.607-6.935,25.607-17.465c0-10.052-7.662-15.795-27.05-22.734c-26.8-9.328-44.263-24.168-44.263-47.611 c0-27.524,22.971-48.579,61.014-48.579c18.188,0,31.591,3.823,41.159,8.131l-8.126,29.437c-6.465-3.116-17.945-7.657-33.745-7.657 c-15.791,0-23.454,7.183-23.454,15.552c0,10.296,9.089,14.842,29.917,22.731c28.468,10.536,41.871,25.365,41.871,48.094 c0,27.042-20.812,50.013-65.09,50.013C95.731,389.349,77.538,384.571,68.458,379.54z M453.601,523.353H97.2V419.302h356.4V523.353z M488.911,379.54c-11.243,3.823-32.537,9.103-53.831,9.103c-29.437,0-50.73-7.426-65.57-21.779 c-14.839-13.875-22.971-34.942-22.738-58.625c0.253-53.604,39.255-84.235,92.137-84.235c20.81,0,36.852,4.073,44.74,7.896 l-7.657,29.202c-8.859-3.829-19.849-6.95-37.567-6.95c-30.396,0-53.357,17.233-53.357,52.173c0,33.265,20.81,52.882,50.73,52.882 c8.375,0,15.072-0.96,17.94-2.395v-33.745h-24.875v-28.471h60.049V379.54L488.911,379.54z" /></svg>'},FamilyTree.icon.csv=function(e,t,i){return'<svg width="'+e+'" height="'+t+'" viewBox="0 0 548.29 548.291" ><path fill="'+i+'" d="M486.2,196.121h-13.164V132.59c0-0.399-0.064-0.795-0.116-1.2c-0.021-2.52-0.824-5-2.551-6.96L364.656,3.677 c-0.031-0.034-0.064-0.044-0.085-0.075c-0.629-0.707-1.364-1.292-2.141-1.796c-0.231-0.157-0.462-0.286-0.704-0.419 c-0.672-0.365-1.386-0.672-2.121-0.893c-0.199-0.052-0.377-0.134-0.576-0.188C358.229,0.118,357.4,0,356.562,0H96.757 C84.893,0,75.256,9.649,75.256,21.502v174.613H62.093c-16.972,0-30.733,13.756-30.733,30.73v159.81 c0,16.966,13.761,30.736,30.733,30.736h13.163V526.79c0,11.854,9.637,21.501,21.501,21.501h354.777 c11.853,0,21.502-9.647,21.502-21.501V417.392H486.2c16.966,0,30.729-13.764,30.729-30.731v-159.81 C516.93,209.872,503.166,196.121,486.2,196.121z M96.757,21.502h249.053v110.006c0,5.94,4.818,10.751,10.751,10.751h94.973v53.861 H96.757V21.502z M258.618,313.18c-26.68-9.291-44.063-24.053-44.063-47.389c0-27.404,22.861-48.368,60.733-48.368 c18.107,0,31.447,3.811,40.968,8.107l-8.09,29.3c-6.43-3.107-17.862-7.632-33.59-7.632c-15.717,0-23.339,7.149-23.339,15.485 c0,10.247,9.047,14.769,29.78,22.632c28.341,10.479,41.681,25.239,41.681,47.874c0,26.909-20.721,49.786-64.792,49.786 c-18.338,0-36.449-4.776-45.497-9.77l7.38-30.016c9.772,5.014,24.775,10.006,40.264,10.006c16.671,0,25.488-6.908,25.488-17.396 C285.536,325.789,277.909,320.078,258.618,313.18z M69.474,302.692c0-54.781,39.074-85.269,87.654-85.269 c18.822,0,33.113,3.811,39.549,7.149l-7.392,28.816c-7.38-3.084-17.632-5.939-30.491-5.939c-28.822,0-51.206,17.375-51.206,53.099 c0,32.158,19.051,52.4,51.456,52.4c10.947,0,23.097-2.378,30.241-5.238l5.483,28.346c-6.672,3.34-21.674,6.919-41.208,6.919 C98.06,382.976,69.474,348.424,69.474,302.692z M451.534,520.962H96.757v-103.57h354.777V520.962z M427.518,380.583h-42.399 l-51.45-160.536h39.787l19.526,67.894c5.479,19.046,10.479,37.386,14.299,57.397h0.709c4.048-19.298,9.045-38.352,14.526-56.693 l20.487-68.598h38.599L427.518,380.583z" /></svg>'},FamilyTree.icon.excel=function(e,t,i){return'<svg width="'+e+'" height="'+t+'" viewBox="0 0 512 512"><path fill="#ECEFF1" d="M496,432.011H272c-8.832,0-16-7.168-16-16s0-311.168,0-320s7.168-16,16-16h224 c8.832,0,16,7.168,16,16v320C512,424.843,504.832,432.011,496,432.011z" /><path fill="'+i+'" d="M336,176.011h-64c-8.832,0-16-7.168-16-16s7.168-16,16-16h64c8.832,0,16,7.168,16,16 S344.832,176.011,336,176.011z" /><path fill="'+i+'" d="M336,240.011h-64c-8.832,0-16-7.168-16-16s7.168-16,16-16h64c8.832,0,16,7.168,16,16 S344.832,240.011,336,240.011z" /><path fill="'+i+'" d="M336,304.011h-64c-8.832,0-16-7.168-16-16s7.168-16,16-16h64c8.832,0,16,7.168,16,16 S344.832,304.011,336,304.011z" /><path fill="'+i+'" d="M336,368.011h-64c-8.832,0-16-7.168-16-16s7.168-16,16-16h64c8.832,0,16,7.168,16,16 S344.832,368.011,336,368.011z" /><path fill="'+i+'" d="M432,176.011h-32c-8.832,0-16-7.168-16-16s7.168-16,16-16h32c8.832,0,16,7.168,16,16 S440.832,176.011,432,176.011z" /><path fill="'+i+'" d="M432,240.011h-32c-8.832,0-16-7.168-16-16s7.168-16,16-16h32c8.832,0,16,7.168,16,16 S440.832,240.011,432,240.011z" /><path fill="'+i+'" d="M432,304.011h-32c-8.832,0-16-7.168-16-16s7.168-16,16-16h32c8.832,0,16,7.168,16,16 S440.832,304.011,432,304.011z" /><path fill="'+i+'" d="M432,368.011h-32c-8.832,0-16-7.168-16-16s7.168-16,16-16h32c8.832,0,16,7.168,16,16 S440.832,368.011,432,368.011z" /><path fill="'+i+'"  d="M282.208,19.691c-3.648-3.04-8.544-4.352-13.152-3.392l-256,48C5.472,65.707,0,72.299,0,80.011v352 c0,7.68,5.472,14.304,13.056,15.712l256,48c0.96,0.192,1.952,0.288,2.944,0.288c3.712,0,7.328-1.28,10.208-3.68 c3.68-3.04,5.792-7.584,5.792-12.32v-448C288,27.243,285.888,22.731,282.208,19.691z" /><path fill="#FAFAFA" d="M220.032,309.483l-50.592-57.824l51.168-65.792c5.44-6.976,4.16-17.024-2.784-22.464 c-6.944-5.44-16.992-4.16-22.464,2.784l-47.392,60.928l-39.936-45.632c-5.856-6.72-15.968-7.328-22.56-1.504 c-6.656,5.824-7.328,15.936-1.504,22.56l44,50.304L83.36,310.187c-5.44,6.976-4.16,17.024,2.784,22.464 c2.944,2.272,6.432,3.36,9.856,3.36c4.768,0,9.472-2.112,12.64-6.176l40.8-52.48l46.528,53.152 c3.168,3.648,7.584,5.504,12.032,5.504c3.744,0,7.488-1.312,10.528-3.968C225.184,326.219,225.856,316.107,220.032,309.483z" /></svg>'},FamilyTree.icon.edit=function(e,t,i){return'<svg width="'+e+'" height="'+t+'" viewBox="0 0 528.899 528.899"><path fill="'+i+'" d="M328.883,89.125l107.59,107.589l-272.34,272.34L56.604,361.465L328.883,89.125z M518.113,63.177l-47.981-47.981 c-18.543-18.543-48.653-18.543-67.259,0l-45.961,45.961l107.59,107.59l53.611-53.611 C532.495,100.753,532.495,77.559,518.113,63.177z M0.3,512.69c-1.958,8.812,5.998,16.708,14.811,14.565l119.891-29.069 L27.473,390.597L0.3,512.69z" /></svg>'},FamilyTree.icon.details=function(e,t,i){return'<svg width="'+e+'" height="'+t+'" viewBox="0 0 512 512"><path fill="'+i+'" d="M447.933,103.629c-0.034-3.076-1.224-6.09-3.485-8.352L352.683,3.511c-0.004-0.004-0.007-0.005-0.011-0.008 C350.505,1.338,347.511,0,344.206,0H89.278C75.361,0,64.04,11.32,64.04,25.237v461.525c0,13.916,11.32,25.237,25.237,25.237 h333.444c13.916,0,25.237-11.32,25.237-25.237V103.753C447.96,103.709,447.937,103.672,447.933,103.629z M356.194,40.931 l50.834,50.834h-49.572c-0.695,0-1.262-0.567-1.262-1.262V40.931z M423.983,486.763c0,0.695-0.566,1.261-1.261,1.261H89.278 c-0.695,0-1.261-0.566-1.261-1.261V25.237c0-0.695,0.566-1.261,1.261-1.261h242.94v66.527c0,13.916,11.322,25.239,25.239,25.239 h66.527V486.763z"/><path fill="'+i+'" d="M362.088,164.014H149.912c-6.62,0-11.988,5.367-11.988,11.988c0,6.62,5.368,11.988,11.988,11.988h212.175 c6.62,0,11.988-5.368,11.988-11.988C374.076,169.381,368.707,164.014,362.088,164.014z"/><path fill="'+i+'" d="M362.088,236.353H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.62,5.368,11.988,11.988,11.988h212.175 c6.62,0,11.988-5.368,11.988-11.988C374.076,241.721,368.707,236.353,362.088,236.353z"/><path fill="'+i+'" d="M362.088,308.691H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.621,5.368,11.988,11.988,11.988h212.175 c6.62,0,11.988-5.367,11.988-11.988C374.076,314.06,368.707,308.691,362.088,308.691z"/><path fill="'+i+'" d="M256,381.031H149.912c-6.62,0-11.988,5.368-11.988,11.988c0,6.621,5.368,11.988,11.988,11.988H256 c6.62,0,11.988-5.367,11.988-11.988C267.988,386.398,262.62,381.031,256,381.031z"/></svg>'},FamilyTree.icon.remove=function(e,t,i){return'<svg width="'+e+'" height="'+t+'"  viewBox="0 0 900.5 900.5"><path fill="'+i+'" d="M176.415,880.5c0,11.046,8.954,20,20,20h507.67c11.046,0,20-8.954,20-20V232.487h-547.67V880.5L176.415,880.5z M562.75,342.766h75v436.029h-75V342.766z M412.75,342.766h75v436.029h-75V342.766z M262.75,342.766h75v436.029h-75V342.766z"/><path fill="'+i+'" d="M618.825,91.911V20c0-11.046-8.954-20-20-20h-297.15c-11.046,0-20,8.954-20,20v71.911v12.5v12.5H141.874 c-11.046,0-20,8.954-20,20v50.576c0,11.045,8.954,20,20,20h34.541h547.67h34.541c11.046,0,20-8.955,20-20v-50.576 c0-11.046-8.954-20-20-20H618.825v-12.5V91.911z M543.825,112.799h-187.15v-8.389v-12.5V75h187.15v16.911v12.5V112.799z"/></svg>'},FamilyTree.icon.add=function(e,t,i){return'<svg width="'+e+'" height="'+t+'"   viewBox="0 0 922 922"><path fill="'+i+'" d="M922,453V81c0-11.046-8.954-20-20-20H410c-11.045,0-20,8.954-20,20v149h318c24.812,0,45,20.187,45,45v198h149 C913.046,473.001,922,464.046,922,453z" /><path fill="'+i+'" d="M557,667.001h151c11.046,0,20-8.954,20-20v-174v-198c0-11.046-8.954-20-20-20H390H216c-11.045,0-20,8.954-20,20v149h194 h122c24.812,0,45,20.187,45,45v4V667.001z" /><path fill="'+i+'" d="M0,469v372c0,11.046,8.955,20,20,20h492c11.046,0,20-8.954,20-20V692v-12.501V667V473v-4c0-11.046-8.954-20-20-20H390H196 h-12.5H171H20C8.955,449,0,457.955,0,469z" /></svg>'},FamilyTree.icon.search=function(e,t,i){return'<svg width="'+e+'" height="'+t+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 485.213 485.213"><path fill="'+i+'" d="M471.882,407.567L360.567,296.243c-16.586,25.795-38.536,47.734-64.331,64.321l111.324,111.324 c17.772,17.768,46.587,17.768,64.321,0C489.654,454.149,489.654,425.334,471.882,407.567z" /><path fill="'+i+'" d="M363.909,181.955C363.909,81.473,282.44,0,181.956,0C81.474,0,0.001,81.473,0.001,181.955s81.473,181.951,181.955,181.951 C282.44,363.906,363.909,282.437,363.909,181.955z M181.956,318.416c-75.252,0-136.465-61.208-136.465-136.46 c0-75.252,61.213-136.465,136.465-136.465c75.25,0,136.468,61.213,136.468,136.465 C318.424,257.208,257.206,318.416,181.956,318.416z" /><path fill="'+i+'" d="M75.817,181.955h30.322c0-41.803,34.014-75.814,75.816-75.814V75.816C123.438,75.816,75.817,123.437,75.817,181.955z" /></svg>'},FamilyTree.icon.xml=function(e,t,i){return'<svg width="'+e+'" height="'+t+'" viewBox="0 0 550.801 550.801"><path fill="'+i+'"  d="M488.426,197.019H475.2v-63.816c0-0.401-0.063-0.799-0.116-1.205c-0.021-2.534-0.827-5.023-2.562-6.992L366.325,3.691 c-0.032-0.031-0.063-0.042-0.085-0.073c-0.633-0.707-1.371-1.298-2.151-1.804c-0.231-0.158-0.464-0.287-0.706-0.422 c-0.676-0.366-1.393-0.675-2.131-0.896c-0.2-0.053-0.38-0.135-0.58-0.19C359.87,0.119,359.037,0,358.193,0H97.2 c-11.918,0-21.6,9.693-21.6,21.601v175.413H62.377c-17.049,0-30.873,13.818-30.873,30.87v160.542 c0,17.044,13.824,30.876,30.873,30.876h13.224V529.2c0,11.907,9.682,21.601,21.6,21.601h356.4c11.907,0,21.6-9.693,21.6-21.601 V419.302h13.226c17.044,0,30.871-13.827,30.871-30.87V227.89C519.297,210.838,505.47,197.019,488.426,197.019z M97.2,21.605 h250.193v110.51c0,5.967,4.841,10.8,10.8,10.8h95.407v54.108H97.2V21.605z M369.531,374.53h-32.058l-2.156-55.519 c-0.644-17.434-1.298-38.518-1.298-59.611h-0.633c-4.514,18.516-10.547,39.166-16.137,56.162l-17.645,56.601h-25.618 l-15.494-56.157c-4.725-16.996-9.671-37.658-13.123-56.6h-0.43c-0.854,19.585-1.508,41.961-2.586,60.038l-2.576,55.086h-30.343 l9.26-145.035h43.677l14.207,48.421c4.517,16.774,9.041,34.847,12.258,51.843h0.654c4.081-16.77,9.038-35.923,13.774-52.064 l15.493-48.199h42.82L369.531,374.53z M69.992,374.53l41.955-73.385l-40.444-71.65h37.655l12.688,26.465 c4.316,8.828,7.533,15.928,10.99,24.092h0.422c3.438-9.242,6.23-15.694,9.893-24.092l12.274-26.465h37.434l-40.89,70.796 l43.044,74.239h-37.866l-13.134-26.257c-5.376-10.108-8.817-17.639-12.909-26.04h-0.433c-3.009,8.401-6.674,15.932-11.19,26.04 l-12.042,26.257H69.992z M453.601,523.353H97.2V419.302h356.4V523.353z M485.325,374.53h-90.608V229.495h32.933v117.497h57.682 v27.538H485.325z"/></svg>'},FamilyTree.icon.link=function(e,t,i){return'<svg width="'+e+'" height="'+t+'" viewBox="0 0 512.092 512.092"  ><path fill="'+i+'" d="M312.453,199.601c-6.066-6.102-12.792-11.511-20.053-16.128c-19.232-12.315-41.59-18.859-64.427-18.859 c-31.697-0.059-62.106,12.535-84.48,34.987L34.949,308.23c-22.336,22.379-34.89,52.7-34.91,84.318 c-0.042,65.98,53.41,119.501,119.39,119.543c31.648,0.11,62.029-12.424,84.395-34.816l89.6-89.6 c1.628-1.614,2.537-3.816,2.524-6.108c-0.027-4.713-3.87-8.511-8.583-8.484h-3.413c-18.72,0.066-37.273-3.529-54.613-10.581 c-3.195-1.315-6.867-0.573-9.301,1.877l-64.427,64.512c-20.006,20.006-52.442,20.006-72.448,0 c-20.006-20.006-20.006-52.442,0-72.448l108.971-108.885c19.99-19.965,52.373-19.965,72.363,0 c13.472,12.679,34.486,12.679,47.957,0c5.796-5.801,9.31-13.495,9.899-21.675C322.976,216.108,319.371,206.535,312.453,199.601z" /><path fill="'+i+'" d="M477.061,34.993c-46.657-46.657-122.303-46.657-168.96,0l-89.515,89.429c-2.458,2.47-3.167,6.185-1.792,9.387 c1.359,3.211,4.535,5.272,8.021,5.205h3.157c18.698-0.034,37.221,3.589,54.528,10.667c3.195,1.315,6.867,0.573,9.301-1.877 l64.256-64.171c20.006-20.006,52.442-20.006,72.448,0c20.006,20.006,20.006,52.442,0,72.448l-80.043,79.957l-0.683,0.768 l-27.989,27.819c-19.99,19.965-52.373,19.965-72.363,0c-13.472-12.679-34.486-12.679-47.957,0 c-5.833,5.845-9.35,13.606-9.899,21.845c-0.624,9.775,2.981,19.348,9.899,26.283c9.877,9.919,21.433,18.008,34.133,23.893 c1.792,0.853,3.584,1.536,5.376,2.304c1.792,0.768,3.669,1.365,5.461,2.048c1.792,0.683,3.669,1.28,5.461,1.792l5.035,1.365 c3.413,0.853,6.827,1.536,10.325,2.133c4.214,0.626,8.458,1.025,12.715,1.195h5.973h0.512l5.12-0.597 c1.877-0.085,3.84-0.512,6.059-0.512h2.901l5.888-0.853l2.731-0.512l4.949-1.024h0.939c20.961-5.265,40.101-16.118,55.381-31.403 l108.629-108.629C523.718,157.296,523.718,81.65,477.061,34.993z" /></svg>'},FamilyTree.icon.happy=function(e,t,i){return'<svg width="'+e+'" height="'+t+'" viewBox="0 0 512 512"><path fill="'+i+'" d="M256,0C114.615,0,0,114.615,0,256s114.615,256,256,256s256-114.615,256-256S397.385,0,256,0z M256,480 C132.288,480,32,379.712,32,256S132.288,32,256,32s224,100.288,224,224S379.712,480,256,480z"/><path fill="'+i+'" d="M176,176c17.673,0,32,14.327,32,32h32c0-35.346-28.654-64-64-64c-35.346,0-64,28.654-64,64h32 C144,190.327,158.327,176,176,176z"/><path fill="'+i+'" d="M336,144c-35.346,0-64,28.654-64,64h32c0-17.673,14.327-32,32-32c17.673,0,32,14.327,32,32h32 C400,172.654,371.346,144,336,144z"/><path fill="'+i+'" d="M256,368c-53.019,0-96-42.981-96-96h-32c0,70.692,57.308,128,128,128s128-57.308,128-128h-32 C352,325.019,309.019,368,256,368z"/></svg>'},FamilyTree.icon.sad=function(e,t,i){return'<svg width="'+e+'" height="'+t+'" viewBox="0 0 512 512"><path fill="'+i+'" d="M256,0C114.615,0,0,114.615,0,256s114.615,256,256,256s256-114.615,256-256S397.385,0,256,0z M256,480 C132.288,480,32,379.712,32,256S132.288,32,256,32s224,100.288,224,224S379.712,480,256,480z"/><path fill="'+i+'" d="M336,192c-17.673,0-32-14.327-32-32h-32c0,35.346,28.654,64,64,64c35.346,0,64-28.654,64-64h-32 C368,177.673,353.673,192,336,192z"/><path fill="'+i+'" d="M176,224c35.346,0,64-28.654,64-64h-32c0,17.673-14.327,32-32,32s-32-14.327-32-32h-32C112,195.346,140.654,224,176,224z "/><path fill="'+i+'" d="M256,256c-70.692,0-128,57.308-128,128h32c0-53.019,42.981-96,96-96s96,42.981,96,96h32C384,313.308,326.692,256,256,256 z"/></svg>'},FamilyTree.icon.share=function(e,t,i,r,a){return FamilyTree.isNEU(r)&&(r=0),FamilyTree.isNEU(a)&&(a=0),`<svg width="${e}" height="${t}" x="${r}" y="${a}" viewBox="0 0 512 512">\n                <path fill="${i}" d="M406,332c-29.641,0-55.761,14.581-72.167,36.755L191.99,296.124c2.355-8.027,4.01-16.346,4.01-25.124\n                    c0-11.906-2.441-23.225-6.658-33.636l148.445-89.328C354.307,167.424,378.589,180,406,180c49.629,0,90-40.371,90-90\n                    c0-49.629-40.371-90-90-90c-49.629,0-90,40.371-90,90c0,11.437,2.355,22.286,6.262,32.358l-148.887,89.59\n                    C156.869,193.136,132.937,181,106,181c-49.629,0-90,40.371-90,90c0,49.629,40.371,90,90,90c30.13,0,56.691-15.009,73.035-37.806\n                    l141.376,72.395C317.807,403.995,316,412.75,316,422c0,49.629,40.371,90,90,90c49.629,0,90-40.371,90-90\n                    C496,372.371,455.629,332,406,332z"/>\n                </svg>`},FamilyTree.icon.user=function(e,t,i,r,a){return FamilyTree.isNEU(r)&&(r=0),FamilyTree.isNEU(a)&&(a=0),`<svg width="${e}" height="${t}" x="${r}" y="${a}" viewBox="0 0 24 24">\n                <path fill="${i}" d="M12 11.796C14.7189 11.796 16.9231 9.60308 16.9231 6.89801C16.9231 4.19294 14.7189 2.00005 12 2.00005C9.28106 2.00005 7.07692 4.19294 7.07692 6.89801C7.07692 9.60308 9.28106 11.796 12 11.796Z" fill="#030D45"/>\n                <path fill="${i}" d="M14.5641 13.8369H9.4359C6.46154 13.8369 4 16.2859 4 19.245C4 19.9593 4.30769 20.5716 4.92308 20.8777C5.84615 21.3879 7.89744 22.0001 12 22.0001C16.1026 22.0001 18.1538 21.3879 19.0769 20.8777C19.5897 20.5716 20 19.9593 20 19.245C20 16.1838 17.5385 13.8369 14.5641 13.8369Z" fill="#030D45"/>\n            </svg>`};var FamilyTree=function(e,t){var i=this;if(this.element=e,this.config=FamilyTree.mergeDeep(FamilyTree._defaultConfig(),t),this._layoutConfigs={base:{orientation:this.config.orientation,levelSeparation:this.config.levelSeparation,mixedHierarchyNodesSeparation:this.config.mixedHierarchyNodesSeparation,assistantSeparation:this.config.assistantSeparation,subtreeSeparation:this.config.subtreeSeparation,siblingSeparation:this.config.siblingSeparation,layout:this.config.layout,columns:this.config.columns,collapse:this.config.collapse,partnerNodeSeparation:this.config.partnerNodeSeparation}},this.config.tags)for(var r in this.config.tags){var a=this.config.tags[r];null!=a.subTreeConfig&&(this._layoutConfigs[r]={orientation:null!=a.subTreeConfig.orientation?a.subTreeConfig.orientation:this.config.orientation,levelSeparation:null!=a.subTreeConfig.levelSeparation?a.subTreeConfig.levelSeparation:this.config.levelSeparation,mixedHierarchyNodesSeparation:null!=a.subTreeConfig.mixedHierarchyNodesSeparation?a.subTreeConfig.mixedHierarchyNodesSeparation:this.config.mixedHierarchyNodesSeparation,assistantSeparation:null!=a.subTreeConfig.assistantSeparation?a.subTreeConfig.assistantSeparation:this.config.assistantSeparation,subtreeSeparation:null!=a.subTreeConfig.subtreeSeparation?a.subTreeConfig.subtreeSeparation:this.config.subtreeSeparation,siblingSeparation:null!=a.subTreeConfig.siblingSeparation?a.subTreeConfig.siblingSeparation:this.config.siblingSeparation,layout:null!=a.subTreeConfig.layout?a.subTreeConfig.layout:this.config.layout,columns:null!=a.subTreeConfig.columns?a.subTreeConfig.columns:this.config.columns,collapse:null!=a.subTreeConfig.collapse?a.subTreeConfig.collapse:this.config.collapse,partnerNodeSeparation:null!=a.subTreeConfig.partnerNodeSeparation?a.subTreeConfig.partnerNodeSeparation:this.config.partnerNodeSeparation})}if(this._event_id=FamilyTree._guid(),!this.config.searchFields.length&&this.config.nodeBinding)for(var n in this.config.nodeBinding)-1==n.indexOf("img")&&"function"!=typeof this.config.nodeBinding[n]&&this.config.searchFields.push(this.config.nodeBinding[n]);FamilyTree._validateConfig(this.config)&&(this._vScroll={},this.config.ui||(this.ui=FamilyTree.ui),this.config.editUI?this.editUI=this.config.editUI:this.editUI=new FamilyTree.editUI,this.editUI.init(this),this.manager=new FamilyTree.manager(this.config,this._layoutConfigs),this.config.searchUI?this.searchUI=this.config.searchUI:this.searchUI=new FamilyTree.searchUI,this.config.nodeMenuUI?this.nodeMenuUI=this.config.nodeMenuUI:this.nodeMenuUI=new FamilyTree.menuUI,this.nodeMenuUI.init(this,this.config.nodeMenu),this.config.nodeCircleMenuUI?this.nodeCircleMenuUI=this.config.nodeCircleMenuUI:this.nodeCircleMenuUI=new FamilyTree.circleMenuUI,this.nodeCircleMenuUI.init(this,this.config.nodeCircleMenu),this.config.nodeContextMenuUI?this.nodeContextMenuUI=this.config.nodeContextMenuUI:this.nodeContextMenuUI=new FamilyTree.menuUI,this.nodeContextMenuUI.init(this,this.config.nodeContextMenu),this.config.toolbarUI?this.toolbarUI=this.config.toolbarUI:this.toolbarUI=new FamilyTree.toolbarUI,this.config.notifierUI?this.notifierUI=this.config.notifierUI:this.notifierUI=new FamilyTree.notifierUI,this.notifierUI.init(this),this.config.menuUI?this.menuUI=this.config.menuUI:this.menuUI=new FamilyTree.menuUI,this.menuUI.init(this,this.config.menu),this.config.xScrollUI||(this.xScrollUI=new FamilyTree.xScrollUI(this.element,this.config,(function(){return{boundary:i.response.boundary,scale:i.getScale(),viewBox:i.getViewBox(),padding:i.config.padding}}),(function(e){i.setViewBox(e)}),(function(){i._draw(!0,FamilyTree.action.xScroll)}))),this.config.yScrollUI||(this.yScrollUI=new FamilyTree.yScrollUI(this.element,this.config,(function(){return{boundary:i.response.boundary,scale:i.getScale(),viewBox:i.getViewBox(),padding:i.config.padding}}),(function(e){i.setViewBox(e)}),(function(){i._draw(!0,FamilyTree.action.xScroll)}))),this.element.classList.add(this.config.mode),this._gragStartedId=null,this._timeout=null,this._touch=null,this._initialized=!1,this._moveInterval=null,this._movePosition=null,this.response=null,this.nodes=null,this._setInitialSizeIfNotSet(),this.config.nodes.length>0&&this._draw(!1,FamilyTree.action.init))};FamilyTree._defaultConfig=function(){return{mode:"light",lazyLoading:!0,enableDragDrop:!1,enableSearch:!0,enableTouch:!1,enableKeyNavigation:!1,miniMap:!1,nodeMenu:null,nodeCircleMenu:null,nodeContextMenu:null,menu:null,toolbar:!1,sticky:!0,nodeMouseClick:FamilyTree.action.details,nodeMouseDbClick:FamilyTree.none,mouseScrool:FamilyTree.action.zoom,showXScroll:FamilyTree.none,showYScroll:FamilyTree.none,template:"ana",tags:{},min:!1,nodeBinding:{},linkBinding:{},searchFields:[],searchDisplayField:null,searchFieldsWeight:null,nodes:[],clinks:[],slinks:[],levelSeparation:60,siblingSeparation:20,subtreeSeparation:40,mixedHierarchyNodesSeparation:15,assistantSeparation:100,minPartnerSeparation:50,partnerChildrenSplitSeparation:20,partnerNodeSeparation:15,columns:10,padding:30,orientation:FamilyTree.orientation.top,layout:FamilyTree.normal,scaleInitial:1,scaleMin:.1,scaleMax:5,orderBy:null,editUI:null,searchUI:null,xScrollUI:null,yScrollUI:null,nodeMenuUI:null,nodeCircleMenuUI:null,nodeContextMenuUI:null,toolbarUI:null,notifierUI:null,menuUI:null,exportUrl:"https://balkan.app/export",collapse:{},expand:{},align:FamilyTree.CENTER,UI:null,anim:{func:FamilyTree.anim.outPow,duration:200},zoom:{speed:120,smooth:12},roots:null,state:null,editForm:{readOnly:!1,titleBinding:"name",photoBinding:"img",addMore:"Add more fileds",addMoreBtn:"Add",addMoreFieldName:"Field name",generateElementsFromFields:!0,buttons:{edit:{icon:FamilyTree.icon.edit(24,24,"#fff"),text:"Edit",hideIfEditMode:!0,hideIfDetailsMode:!1},share:{icon:FamilyTree.icon.share(24,24,"#fff"),text:"Share"},pdf:{icon:FamilyTree.icon.pdf(24,24,"#fff"),text:"Save as PDF"},remove:{icon:FamilyTree.icon.remove(24,24,"#fff"),text:"Remove",hideIfDetailsMode:!0}},elements:[]}}},FamilyTree.prototype.load=function(e){return this.config.nodes=e,this._draw(!1,FamilyTree.action.init),this},FamilyTree.prototype.loadXML=function(e){var t=FamilyTree._xml2json(e);this.load(t)},FamilyTree.prototype.getXML=function(){return FamilyTree._json2xml(this.config.nodes)},FamilyTree.prototype.on=function(e,t){return FamilyTree.events.on(e,t,this._event_id),this},FamilyTree.prototype.draw=function(e,t,i){null==e&&(e=FamilyTree.action.update),this._draw(!1,e,t,i)},FamilyTree.prototype._draw=function(e,t,i,r){var a=this;this._hideBeforeAnimationCompleted=!1;var n=t==FamilyTree.action.init?null:this.getViewBox();this.manager.read(e,this.width(),this.height(),n,t,i,(function(e){t!=FamilyTree.action.exporting&&(a.nodes=e.nodes,a.visibleNodeIds=e.visibleNodeIds,a.roots=e.roots),a.editUI.fields=e.allFields;var n={defs:""};FamilyTree.events.publish("renderdefs",[a,n]);var o=a.ui.defs(n.defs),l=a.getScale(e.viewBox);o+=a.ui.pointer(a.config,t,l);var s=a.getViewBox(),d=e.viewBox;n={content:o,res:e};FamilyTree.events.publish("prerender",[a,n]),o=n.content;for(var c=0;c<e.visibleNodeIds.length;c++){var m=e.nodes[e.visibleNodeIds[c]],p=a._get(m.id);FamilyTree.RENDER_LINKS_BEFORE_NODES&&(o+=a.ui.link(m,a,l,e.bordersByRootIdAndLevel,e.nodes,t)),o+=a.ui.node(m,p,e.animations,a.config,void 0,void 0,void 0,t,l,a)}for(c=0;c<e.visibleNodeIds.length;c++){m=e.nodes[e.visibleNodeIds[c]];FamilyTree.RENDER_LINKS_BEFORE_NODES||(o+=a.ui.link(m,a,l,e.bordersByRootIdAndLevel,e.nodes,t)),o+=a.ui.expandCollapseBtn(a,m,a._layoutConfigs,t,l)}n={content:o,res:e};if(FamilyTree.events.publish("render",[a,n]),o=n.content,e=n.res,o+=a.ui.lonely(a.config),t!==FamilyTree.action.exporting){t!==FamilyTree.action.centerNode&&t!==FamilyTree.action.insert&&t!==FamilyTree.action.expand&&t!==FamilyTree.action.collapse&&t!==FamilyTree.action.update||(d=s),t===FamilyTree.action.init&&null!=s&&(d=s),a.response=e;v=a.ui.svg(a.width(),a.height(),d,a.config,o);if(a._initialized){var h=a.getSvg(),u=h.parentNode;u.removeChild(h),u.insertAdjacentHTML("afterbegin",v),a._attachEventHandlers(),a.xScrollUI.addListener(a.getSvg()),a.yScrollUI.addListener(a.getSvg()),a.xScrollUI.setPosition(),a.yScrollUI.setPosition()}else a.element.innerHTML=a.ui.css()+a.ui.menuButton(a.config)+v,a._attachInitEventHandlers(),a._attachEventHandlers(),a.xScrollUI.create(a.width(),a.config.padding),a.xScrollUI.setPosition(),a.xScrollUI.addListener(a.getSvg()),a.yScrollUI.create(a.height(),a.config.padding),a.yScrollUI.setPosition(),a.yScrollUI.addListener(a.getSvg()),a.config.enableSearch&&a.searchUI.init(a),a.toolbarUI.init(a,a.config.toolbar);var y=!1;a.notifierUI.show(e.notif);var f=a.response.animations;if(f[0].length>0){a._hideBeforeAnimation(f[0].length);for(c=0;c<f[0].length;c++)f[0][c]=a.getNodeElement(f[0][c]);FamilyTree.anim(f[0],f[1],f[2],a.config.anim.duration,a.config.anim.func,(function(){y||(r&&r(),FamilyTree.events.publish("redraw",[a]),a._showAfterAnimation(),y=!0)}))}t===FamilyTree.action.centerNode?FamilyTree.anim(a.getSvg(),{viewbox:s},{viewbox:a.response.viewBox},a.config.anim.duration,a.config.anim.func,(function(){a.ripple(i.options.rippleId),y||(r&&r(),FamilyTree.events.publish("redraw",[a]),a._showAfterAnimation(),y=!0)}),(function(){a.xScrollUI.setPosition(),a.yScrollUI.setPosition()})):!s||!a.response||s[0]==a.response.viewBox[0]&&s[1]==a.response.viewBox[1]&&s[2]==a.response.viewBox[2]&&s[3]==a.response.viewBox[3]||t!==FamilyTree.action.insert&&t!==FamilyTree.action.expand&&t!==FamilyTree.action.collapse&&t!==FamilyTree.action.update&&t!==FamilyTree.action.init?0==f[0].length&&(y||(r&&r(),FamilyTree.events.publish("redraw",[a]),y=!0)):FamilyTree.anim(a.getSvg(),{viewbox:s},{viewbox:a.response.viewBox},500,FamilyTree.anim.inOutPow,(function(){a.xScrollUI.setPosition(),a.yScrollUI.setPosition(),y||(r&&r(),FamilyTree.events.publish("redraw",[a]),y=!0)})),a._initialized||(a._initialized=!0,FamilyTree.events.publish("init",[a]))}else{var g=e.boundary,b=g.maxX-g.minX,T=g.maxY-g.minY,v=a.ui.svg(b,T,[g.minX,g.minY,b,T],a.config,o,l);r(v)}}),(function(e){FamilyTree.events.publish("ready",[a,e])}))},FamilyTree.prototype._setInitialSizeIfNotSet=function(){this.element.style.overflow="hidden",this.element.style.position="relative",0==this.element.offsetHeight&&(this.element.style.height="100%",0==this.element.offsetHeight&&(this.element.style.height="700px")),0==this.element.offsetWidth&&(this.element.style.width="100%",0==this.element.offsetWidth&&(this.element.style.width="700px"))},FamilyTree.prototype.getViewBox=function(){var e=this.getSvg();return FamilyTree._getViewBox(e)},FamilyTree.prototype.setViewBox=function(e){this.getSvg().setAttribute("viewBox",e.toString())},FamilyTree.prototype.width=function(){return this.element.offsetWidth},FamilyTree.prototype.height=function(){return this.element.offsetHeight},FamilyTree.prototype.getScale=function(e){return e||(e=this.getViewBox()),FamilyTree.getScale(e,this.width(),this.height(),this.config.scaleInitial,this.config.scaleMax,this.config.scaleMin)},FamilyTree.prototype.ripple=function(e,t,i){var r=this.getNode(e);if(null!=r){var a=this.getNodeElement(e);if(null!=a){var n=this.getScale(),o=r.w/2,l=r.h/2;if(void 0!==t&&void 0!==i){var s=a.getBoundingClientRect();o=t/n-s.left/n,l=i/n-s.top/n}var d=r.w,c=r.h,m=d-o>o?d-o:o,p=c-l>l?c-l:l,h=(m=m)>(p=p)?m:p,u=document.createElementNS("http://www.w3.org/2000/svg","g"),y=document.createElementNS("http://www.w3.org/2000/svg","clipPath"),f=document.createElementNS("http://www.w3.org/2000/svg","rect"),g=document.createElementNS("http://www.w3.org/2000/svg","circle"),b=FamilyTree.randomId();y.setAttribute("id",b);var T={ripple:FamilyTree.t(r.templateName,r.min,this.getScale()).ripple,node:r};FamilyTree.events.publish("ripple",[this,T]),f.setAttribute("x",T.ripple.rect?T.ripple.rect.x:0),f.setAttribute("y",T.ripple.rect?T.ripple.rect.y:0),f.setAttribute("width",T.ripple.rect?T.ripple.rect.width:r.w),f.setAttribute("height",T.ripple.rect?T.ripple.rect.height:r.h),f.setAttribute("rx",T.ripple.radius),f.setAttribute("ry",T.ripple.radius),g.setAttribute("clip-path","url(#"+b+")"),g.setAttribute("cx",o),g.setAttribute("cy",l),g.setAttribute("r",0),g.setAttribute("fill",T.ripple.color),g.setAttribute("class","ripple"),y.appendChild(f),u.appendChild(y),u.appendChild(g),a.appendChild(u),FamilyTree.anim(g,{r:0,opacity:1},{r:h,opacity:0},500,FamilyTree.anim.outPow,(function(){a.removeChild(u)}))}}},FamilyTree.prototype.center=function(e,t,i){var r,a,n=e,o=!0,l=!0;t&&null!=t.parentState&&(r=t.parentState),t&&null!=t.childrenState&&(a=t.childrenState),t&&null!=t.rippleId&&(n=t.rippleId),t&&null!=t.vertical&&(o=t.vertical),t&&null!=t.horizontal&&(l=t.horizontal);var s={parentState:r,childrenState:a,rippleId:n,vertical:o,horizontal:l};this._draw(!1,FamilyTree.action.centerNode,{id:e,options:s},i)},FamilyTree.prototype.fit=function(e){this.config.scaleInitial=FamilyTree.match.boundary,this._draw(!0,FamilyTree.action.init,{method:"fit"},e)},FamilyTree.prototype.toggleFullScreen=function(){var e=document.querySelector("["+FamilyTree.attr.tlbr+"r='fullScreen']");document.fullscreenElement==this.element||document.webkitFullscreenElement==this.element||document.mozFullScreenElement==this.element||document.msFullscreenElement==this.element?(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),e&&(e.innerHTML=FamilyTree.toolbarUI.openFullScreenIcon)):(this.element.requestFullscreen?this.element.requestFullscreen():this.element.mozRequestFullScreen?this.element.mozRequestFullScreen():this.element.webkitRequestFullscreen?this.element.webkitRequestFullscreen():this.element.msRequestFullscreen&&this.element.msRequestFullscreen(),e&&(e.innerHTML=FamilyTree.toolbarUI.closeFullScreenIcon))},FamilyTree.prototype.getNode=function(e){return this.nodes[e]},FamilyTree.prototype.setLayout=function(e,t){t||(t="base"),this._layoutConfigs[t].layout=e,this._draw(!1,FamilyTree.action.update)},FamilyTree.prototype.setOrientation=function(e,t){t||(t="base"),this._layoutConfigs[t].orientation=e,this._draw(!1,FamilyTree.action.update)},FamilyTree.prototype.find=function(e){return this.search(e)},FamilyTree.prototype.search=function(e,t,i){return FamilyTree.isNEU(t)&&(t=this.config.searchFields),FamilyTree.isNEU(i)&&(i=t),FamilyTree._search.search(this.config.nodes,e,t,i,this.config.searchDisplayField,this.config.searchFieldsWeight)},FamilyTree.prototype._hideBeforeAnimation=function(e){if(1!=this._hideBeforeAnimationCompleted&&!(e&&e<FamilyTree.ANIM_THRESHOLD)){var t=this.element.getElementsByTagName("text");if(t.length>FamilyTree.TEXT_THRESHOLD)for(var i=0;i<t.length;i++)t[i].style.display="none";var r=this.element.getElementsByTagName("image");if(r.length>FamilyTree.IMAGES_THRESHOLD)for(i=0;i<r.length;i++)r[i].style.display="none";var a=this.element.querySelectorAll("["+FamilyTree.attr.link_id+"]");if(a.length>FamilyTree.LINKS_THRESHOLD)for(i=0;i<a.length;i++)a[i].style.display="none";var n=this.element.querySelectorAll("["+FamilyTree.attr.control_expcoll_id+"]");if(n.length>FamilyTree.BUTTONS_THRESHOLD)for(i=0;i<n.length;i++)n[i].style.display="none";var o=this.element.querySelectorAll("["+FamilyTree.attr.control_up_id+"]");if(o.length>FamilyTree.BUTTONS_THRESHOLD)for(i=0;i<o.length;i++)o[i].style.display="none";this._hideBeforeAnimationCompleted=!0}},FamilyTree.prototype._showAfterAnimation=function(){for(var e=this.element.getElementsByTagName("text"),t=0;t<e.length;t++)e[t].style.display="";var i=this.element.getElementsByTagName("image");for(t=0;t<i.length;t++)i[t].style.display="";var r=this.element.querySelectorAll("["+FamilyTree.attr.link_id+"]");for(t=0;t<r.length;t++)r[t].style.display="";var a=this.element.querySelectorAll("["+FamilyTree.attr.control_expcoll_id+"]");for(t=0;t<a.length;t++)a[t].style.display="";var n=this.element.querySelectorAll("["+FamilyTree.attr.control_up_id+"]");for(t=0;t<n.length;t++)n[t].style.display="";this._hideBeforeAnimationCompleted=!1},FamilyTree.prototype.isChild=function(e,t){for(var i=this.getNode(t);i;){if(i.id==e)return!0;i=i.parent?i.parent:i.stParent}return!1},FamilyTree.prototype.getCollapsedIds=function(e){for(var t=[],i=0;i<e.childrenIds.length;i++){var r=this.getNode(e.childrenIds[i]);1==r.collapsed&&t.push(r.id)}return t},FamilyTree.prototype.stateToUrl=function(){if(this.manager.state){var e={};return e.exp=this.manager.state.exp.join("*"),e.min=this.manager.state.min.join("*"),e.adjustify=this.manager.state.adjustify.x+"*"+this.manager.state.adjustify.y,e.scale=this.manager.state.scale,e.y=this.manager.state.x,e.x=this.manager.state.y,new URLSearchParams(e).toString()}return""},FamilyTree.prototype.generateId=function(){for(;;){var e="_"+("0000"+(Math.random()*Math.pow(36,4)|0).toString(36)).slice(-4);if(!this.nodes.hasOwnProperty(e))return e}},FamilyTree.prototype._nodeHasHiddenParent=function(e){return!e.parent&&!FamilyTree.isNEU(e.pid)&&this.getNode(e.pid)},FamilyTree.prototype.destroy=function(){this._removeEvent(window,"resize"),FamilyTree.events.removeForEventId(this._event_id),this.element.innerHTML=null},FamilyTree._search={},FamilyTree._search.search=function(e,t,i,r,a,n){var o=[],l=t.toLowerCase().split(" ");l=l.filter((function(e,t,i){return i.indexOf(e)===t}));for(var s={},d=0;d<e.length;d++)for(var c=e[d],m=0;m<i.length;m++){var p=i[m];if(!FamilyTree.isNEU(c[p])){var h=c[p];if(null!=(t=FamilyTree._search.searchAndComputeScore(l,h,p,n))){var u=c.id;if(s[u]){if(s[u]&&s[u]<t.__score){s[u]=t.__score;for(var y=o.length-1;y>=0;y--)o[y].id==u&&o.splice(y,1);FamilyTree._search.addNodeToResult(o,r,c,t,p,a)}}else s[u]=t.__score,FamilyTree._search.addNodeToResult(o,r,c,t,p,a)}}}return o.sort((function(e,t){return e.__score<t.__score?1:e.__score>t.__score?-1:0})),o},FamilyTree._search.addNodeToResult=function(e,t,i,r,a,n){var o={};o.id=i.id,FamilyTree.isNEU(i[n])||(o[n]=i[n]);for(var l=0;l<t.length;l++){var s=t[l];FamilyTree.isNEU(i[s])||FamilyTree.isNEU(o[s])&&(o[s]=i[s])}null!=r&&(FamilyTree.isNEU(o.__score)&&(o.__score=r.__score),FamilyTree.isNEU(o.__searchField)&&(o.__searchField=a),FamilyTree.isNEU(o.__searchMarks)&&(o.__searchMarks=r.__searchMarks)),e.push(o)},FamilyTree._search.searchAndComputeScore=function(e,t,i,r){if(FamilyTree.isNEU(t))return null;if(FamilyTree.isNEU(e))return null;if(!e.length)return null;"string"!=typeof t&&(t=t.toString());var a=t.toLowerCase(),n=FamilyTree._search.searchIndexesOf(a,e);if(!n.length)return null;var o=a.length/100,l=0,s=0,d=l>0?100:0;if(n.length){s=n[0].start;for(var c=0;c<n.length;c++)if(l+=n[c].length,n[c].start<s&&(s=n[c].start),c>=1&&n[c-1].start>n[c].start){d=0;break}}var m=0;0!=l&&(m=l/o);var p=l>0?100:0;0!=s&&(p=100-s/o);var h=0;r&&r[i]&&(h=r[i]),m>0&&(m=m/100*20),p>0&&(p=p/100*20),d>0&&(d=d/100*20),h>0&&(h=h/100*40);var u=parseInt(m+p+d+h);u>100&&(u=100),n.sort((function(e,t){return e.start<t.start?-1:e.start>t.start?1:0}));var y=t;for(c=n.length-1;c>=0;c--)y=(y=y.insert(n[c].start+n[c].length,"</mark>")).insert(n[c].start,"<mark>");return{__searchMarks:y,__score:u}},FamilyTree._search.searchIndexesOf=function(e,t){var i=[];if(!FamilyTree.isNEU(e))for(var r=0;r<t.length;r++){var a=t[r];if(!FamilyTree.isNEU(a))for(var n=0;(n=e.indexOf(a,n))>-1;)i.push({length:a.length,start:n}),n+=a.length}return i.sort((function(e,t){return e.length<t.length?1:e.length>t.length||e.start<t.start?-1:e.start>t.start?1:0})),i=i.filter((function(e){for(var t=!1,r=0;r<i.length;r++){var a=i[r].start,n=i[r].start+i[r].length-1,o=e.start,l=e.start+e.length-1;if(a==o&&n==l){t=!1;break}if(a>=o&&n<=l){t=!0;break}if(a<=o&&n>=l){t=!0;break}}return!t}))},void 0===FamilyTree&&(FamilyTree={}),FamilyTree.events.on("init",(function(e,t){e.config.enableKeyNavigation&&(e._addEvent(window,"keydown",e._windowKeyDownHandler),FamilyTree.isNEU(e._keyNavigationActiveNodeId)&&e.roots&&e.roots.length&&(e._keyNavigationActiveNodeId=e.roots[0].id,e.center(e._keyNavigationActiveNodeId)))})),FamilyTree.prototype._windowKeyDownHandler=function(e,t){for(var i=t.target,r=null;i&&i!=this.element;){if(i.hasAttribute&&i.hasAttribute(FamilyTree.attr.node_id)){r=i.getAttribute(FamilyTree.attr.node_id);break}i=i.parentNode}if(i){var a=r?this.getNode(r):null,n={node:a,data:r?this.get(r):null,event:t};if(!1!==FamilyTree.events.publish("key-down",[this,n])&&a)if("KeyF"==t.code)this.searchUI.find("");else if("ArrowRight"==t.code||a.isAssistant&&"ArrowDown"==t.code||a.isPartner&&"ArrowDown"==t.code){if(s=this.getNode(a.pid)){var o=s.childrenIds.indexOf(a.id);if(++o<s.childrenIds.length){var l=s.childrenIds[o];this._keyNavigationActiveNodeId=l,this.center(l)}}}else if("ArrowLeft"==t.code){if(s=this.getNode(a.pid)){o=s.childrenIds.indexOf(a.id);if(--o>=0){l=s.childrenIds[o];this._keyNavigationActiveNodeId=l,this.center(l)}}}else if("ArrowUp"==t.code){var s;if(s=this.getNode(a.pid)){l=s.id;if(a.isAssistant||s.hasAssistants||a.isPartner||s.hasPartners){o=s.childrenIds.indexOf(a.id);--o>=0&&(l=s.childrenIds[o])}this._keyNavigationActiveNodeId=l,this.center(l)}}else if("ArrowDown"==t.code)a.childrenIds.length&&(this._keyNavigationActiveNodeId=a.childrenIds[0],this.center(a.childrenIds[0]));else if("Space"==t.code){var d=i.getAttribute(FamilyTree.attr.node_id);return void this.toggleExpandCollapse(d,t)}}},FamilyTree.events.on("redraw",(function(e,t){e.config.enableKeyNavigation&&FamilyTree._keyNavigation(e)})),FamilyTree.events.on("click",(function(e,t){e.config&&e.config.enableKeyNavigation&&(e._keyNavigationActiveNodeId=t.node.id,e.center(t.node.id))})),FamilyTree._keyNavigation=function(e){var t=e.element.querySelector(":focus");if(t&&t.parentElement&&t.parentElement.hasAttribute(FamilyTree.attr.node_id)){var i=t.parentElement;(a=(r=t).querySelector("title"))&&a.parentNode.removeChild(a),r.removeAttribute("tabindex")}if(!FamilyTree.isNEU(e._keyNavigationActiveNodeId)&&((i=e.getNodeElement(e._keyNavigationActiveNodeId))&&i.children.length)){var r;(r=i.children[0]).setAttribute("tabindex",2);var a,n={text:"",id:e._keyNavigationActiveNodeId};if(FamilyTree.events.publish("screen-reader-text",[e,n]),!FamilyTree.isNEU(n.text))(a=document.createElementNS("http://www.w3.org/2000/svg","title")).innerHTML=n.text,r.appendChild(a);e.searchUI.hide(),r.focus()}},FamilyTree.elements={},FamilyTree.elements.textbox=function(e,t,i,r){var a=FamilyTree.elements._vidrf(e,t,r);if(a.doNotRender)return{html:""};var n="";return t.btn&&(n=`<a href="#" ba-input-btn="" class="ba-link ba-link-ba-button">${t.btn}</a>`),{html:`<div class="ba-form-field" style="min-width: ${i};">\n                    <div class="ba-input" data-ba-input="" ${a.disabledAttribute} ${a.vlidators}>\n                        <label for="${a.id}">${a.label}</label>\n                        <input ${a.readOnlyAttribute} data-binding="${a.binding}" maxlength="256" id="${a.id}" name="${a.id}" type="text" value="${a.value}" autocomplete="off">\n                        ${n}\n                    </div>\n                </div>`,id:a.id,value:a.value}},FamilyTree.elements.checkbox=function(e,t,i,r){var a=FamilyTree.elements._vidrf(e,t,r);if(a.doNotRender)return{html:""};var n=a.value?"checked":"",o=r?'onclick="return false;"':"";return{html:`<div class="ba-form-field"  style="min-width: ${i};" >\n                        <label class="ba-checkbox" data-ba-input="" ${a.disabledAttribute}>\n                            <input ${n} ${o} data-binding="${a.binding}" type="checkbox"><span class="ba-checkbox-checkmark" type="checkbox"></span>${a.label}\n                        </label>\n                    </div>`,id:a.id,value:n}},FamilyTree.elements.select=function(e,t,i,r){if(r)return FamilyTree.elements.textbox(e,t,i,r);var a=FamilyTree.elements._vidrf(e,t,r);return a.doNotRender?{html:""}:{html:`<div class="ba-form-field" style="min-width: ${i};">\n                    <div class="ba-input" data-ba-input="" ${a.disabledAttribute} ${a.vlidators}>\n                        <label for="${a.id}">${a.label}</label>\n                        <select data-binding="${a.binding}" ${a.readOnlyAttribute} id="${a.id}" name="${a.id}">\n                            ${function(){for(var e="",t=0;t<a.options.length;t++){var i=a.options[t];e+=`<option ${i.value==a.value?"selected":""} value="${i.value}">${i.text}</option>`}return e}()}                           \n                        </select>\n                    </div>\n                </div>`,id:a.id,value:a.value}},FamilyTree.elements.date=function(e,t,i,r){var a=FamilyTree.elements._vidrf(e,t,r);return a.doNotRender?{html:""}:{html:`<div class="ba-form-field" style="min-width: ${i};">\n                    <div class="ba-input" data-ba-input="" ${a.disabledAttribute} ${a.vlidators}>\n                        <label for="${a.id}" class="hasval">${a.label}</label>\n                        <input data-binding="${a.binding}" ${a.readOnlyAttribute} maxlength="256" id="${a.id}" name="${a.id}" type="date" value="${a.value}" autocomplete="off">\n                    </div>\n                </div>`,id:a.id,value:a.value}},FamilyTree.elements._vidrf=function(e,t,i){var r={};if(t.binding||(t.binding=""),t.label||(t.label=""),"select"!=t.type||Array.isArray(t.options)?r.options=t.options:r.options=[],r.value=e&&!FamilyTree.isNEU(e[t.binding])?e[t.binding]:"",i&&r.options)for(var a=0;a<r.options.length;a++)if(r.options[a].value==r.value){r.value=r.options[a].text;break}if(r.id=FamilyTree.elements.generateId(),r.disabledAttribute=i?"data-ba-input-disabled":"",r.readOnlyAttribute=i?"readonly":"",r.id=r.id,i&&FamilyTree.isNEU(r.value)&&(r.doNotRender=!0),i&&"photo"==t.binding&&(r.id=null,r.doNotRender=!0),r.binding=t.binding,r.label=t.label,r.vlidators="",t.vlidators)for(var n in t.vlidators)r.vlidators+=`data-v-${n}="${t.vlidators[n]}" `;return r},FamilyTree.elements.ids=[],FamilyTree.elements.generateId=function(){for(;;){var e="_"+("0000"+(Math.random()*Math.pow(36,4)|0).toString(36)).slice(-4);if(!FamilyTree.elements.ids.has(e))return FamilyTree.elements.ids.push(e),e}},FamilyTree.input={},FamilyTree.input._timeout=null,FamilyTree.input.initWithTimeout=function(){FamilyTree.input._timeout&&(clearTimeout(FamilyTree.input._timeout),FamilyTree.input._timeout=null),FamilyTree.input._timeout=setTimeout(FamilyTree.input.init,200)},FamilyTree.input.init=function(e){var t;t=e?e.querySelectorAll("[data-ba-input]"):document.querySelectorAll("[data-ba-input]");for(var i=0;i<t.length;i++){var r=t[i],a=null;r.type&&"hidden"==r.type.toLowerCase()&&(a=r),a||(a=r.querySelector("input")),a||(a=r.querySelector("select"));var n=r.querySelector("label");n&&(a.value||"select-one"==a.type&&a.selectedOptions&&a.selectedOptions.length&&""==a.selectedOptions[0].value&&a.selectedOptions[0].innerHTML)&&n.classList.add("hasval"),"checkbox"!=a.type.toLowerCase()&&a.addEventListener("focus",(function(){this.classList.remove("validation-error");var e=this.parentNode.querySelector("label");e.classList.add("focused");var t=e.querySelector(".validation-error-message");t&&t.parentNode.removeChild(t)})),"checkbox"!=a.type.toLowerCase()&&a.addEventListener("blur",(function(){var e=this.parentNode.querySelector("label");e.classList.remove("focused"),this.value||"date"==this.type?e.classList.add("hasval"):e.classList.remove("hasval")}))}},FamilyTree.input.validate=function(e){var t=null;e.type&&"hidden"==e.type.toLowerCase()&&(t=e),t||(t=e.querySelector("input")),t||(t=e.querySelector("select"));var i=e.querySelector("label");if(t.classList.remove("validation-error"),i){var r=i.querySelector(".validation-error-message");r&&r.parentNode.removeChild(r)}t.value&&(t.value=t.value.trim());var a=e.getAttribute("data-v-required"),n=e.getAttribute("data-v-password"),o=e.getAttribute("data-v-email"),l=e.getAttribute("data-v-emails");return a&&""==t.value?(i.innerHTML+='<span class="validation-error-message">&nbsp;'+a+"</span>",t.classList.add("validation-error"),!1):n&&!FamilyTree.input.validatePassword(t.value)?(i.innerHTML+='<span class="validation-error-message">&nbsp;'+n+"</span>",t.classList.add("validation-error"),!1):o&&!FamilyTree.input.isValidEmail(t.value)?(i.innerHTML+='<span class="validation-error-message">&nbsp;'+o+"</span>",t.classList.add("validation-error"),!1):!(l&&!FamilyTree.input.isValidEmails(t.value))||(i.innerHTML+='<span class="validation-error-message">&nbsp;'+l+"</span>",t.classList.add("validation-error"),!1)},FamilyTree.input.validateAndGetData=function(e){for(var t=e.querySelectorAll("[data-ba-input]"),i=!0,r=0;r<t.length;r++){var a=t[r];FamilyTree.input.validate(a)||(i=!1)}if(!i)return!1;var n=e.querySelectorAll("[data-binding]"),o={};for(r=0;r<n.length;r++){var l=n[r],s=l.getAttribute("data-binding");"checkbox"==l.type.toLowerCase()?o[s]=l.checked:o[s]=l.value}return o},FamilyTree.input.validatePassword=function(e){return e&&(e=e.trim()),!(e.length<5)&&(!(e.length>18)&&-1==e.indexOf(" "))},FamilyTree.input.isValidEmails=function(e){if(e)for(var t=e.split(","),i=0;i<t.length;i++){var r=t[i].trim();if(!FamilyTree.input.isValidEmail(r))return!1}return!0},FamilyTree.input.isValidEmail=function(e){e&&(e=e.trim());return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},FamilyTree.ui.css=function(){return'<style data-ba-styles>.ba-button{background-color:#039be5;cursor:pointer;width:calc(100%);height:50px;color:#fff;padding-top:5px;padding-left:7px;padding-right:7px;text-align:center;text-transform:uppercase;border:1px solid #3fc0ff;display:inline-block;border-radius:5px}.ba-button.orange{background-color:#f57c00;border:1px solid #ffa03e}.ba-button.yellow{background-color:#ffca28;border:1px solid #ffdf7c}.ba-button.lower{text-transform:unset}.ba-button.transparent{background-color:transparent}.ba-button:hover{background-color:#35afea}.ba-button.orange:hover{background-color:#f79632}.ba-button.yellow:hover{background-color:#ffd452}.ba-button:active{transform:matrix(.98,0,0,.98,0,0)}.ba-button-icon{text-align:initial;cursor:pointer;margin-bottom:15px;color:#039be5}.dark .ba-button-icon:hover{background-color:#2d2d2d}.light .ba-button-icon:hover{background-color:#ececec}.ba-button-icon>img{height:24px;width:24px;vertical-align:middle;padding:7px}.ba-button:focus{outline:0}.ba-button-icon>img{filter:invert(46%) sepia(66%) saturate(2530%) hue-rotate(171deg) brightness(95%) contrast(98%)}.light .ba-button.transparent{color:#039be5}.light .ba-button.transparent:hover{color:#fff}.ba-button-loading{background-color:transparent;cursor:pointer;width:calc(100% - 2px);height:50px;color:#fff;text-align:center;text-transform:uppercase;border:1px solid #027cb7;display:inline-block;display:flex;justify-content:center;align-items:center;display:none}.ba-button-loading .ba-loading-dots div{margin:0 10px}.ba-link-ba-button{position:absolute;right:10px;top:-1px}[data-ba-input-disabled] .ba-link-ba-button{display:none}[dir=rtl] .ba-link-ba-button{left:10px;right:unset}.ba-img-button{width:48px;height:48px;cursor:pointer;border-radius:50%;background-color:#039be5;background-repeat:no-repeat;background-size:24px 24px;background-position:center center;margin:3px;display:inline-block}.ba-img-button:hover{background-color:#f57c00}.ba-checkbox{display:block;position:relative;padding-left:35px;margin-bottom:12px;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap}.ba-checkbox input{position:absolute;opacity:0;cursor:pointer;height:0;width:0}.ba-checkbox-checkmark{position:absolute;top:0;left:0;height:25px;width:25px;border-radius:5px}.dark [data-ba-input-disabled] .ba-checkbox-checkmark,.dark [data-ba-input-disabled].ba-checkbox input:checked~.ba-checkbox-checkmark,.light [data-ba-input-disabled] .ba-checkbox-checkmark,.light [data-ba-input-disabled].ba-checkbox input:checked~.ba-checkbox-checkmark{background-color:#aeaeae!important}[data-ba-input-disabled].ba-checkbox{cursor:default}[dir=rtl] .ba-checkbox-checkmark{right:0}[dir=rtl] .ba-checkbox{padding-left:unset;padding-right:35px}.dark .ba-checkbox-checkmark{background-color:#333;border:1px solid #5b5b5b}.light .ba-checkbox-checkmark{background-color:#fff;border:1px solid #c7c7c7}.dark .ba-checkbox:hover input~.ba-checkbox-checkmark{background-color:#3c3c3c}.light .ba-checkbox:hover input~.ba-checkbox-checkmark{background-color:#f8f9f9}.dark .ba-checkbox input:checked~.ba-checkbox-checkmark{background-color:#039be5}.light .ba-checkbox input:checked~.ba-checkbox-checkmark{background-color:#039be5}.ba-checkbox-checkmark:after{content:"";position:absolute;display:none}.ba-checkbox input:checked~.ba-checkbox-checkmark:after{display:block}.ba-checkbox .ba-checkbox-checkmark:after{left:9px;top:5px;width:5px;height:10px;border:solid #fff;border-width:0 3px 3px 0;-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg)}.ba-form-perspective{transform-style:preserve-3d;perspective:500px;position:absolute;top:32px;z-index:1900}.ba-form{box-shadow:rgba(0,0,0,.2) 0 6px 6px 0,rgba(0,0,0,.19) 0 13px 20px 0;padding:14px;transform-origin:top center;user-select:none;display:none;position:relative;max-height:calc(100vh - 100px);overflow-y:auto;border-bottom-left-radius:5px;border-bottom-right-radius:5px}.ba-form-bottom{border-bottom-left-radius:unset;border-bottom-right-radius:unset;border-top-left-radius:5px;border-top-right-radius:5px}.ba-form .separator{margin:0 10px}@media screen and (max-width:1000px){.ba-form-perspective{min-width:100%;max-height:calc(100% - 32px);left:unset!important;right:unset!important;transform:none!important}.ba-form .set{max-height:calc(100vh - 74px)}.ba-form-fieldset{max-width:unset!important}}.light .ba-form .separator{border-bottom:1px solid #c7c7c7}.dark .ba-form .separator{border-bottom:1px solid #5b5b5b}.light .ba-form{background-color:#fff}.dark .ba-form{background-color:#252526}.item{padding:6px 12px 6px 12px;display:flex;flex-direction:row}.light .ba-form .item.selected,.light .ba-form .item:hover{background-color:#0074e8;color:#fff}.dark .ba-form .item.selected,.dark .ba-form .item:hover{background-color:#094771;color:#fff}.item.selected img,.item:hover img{filter:invert(100%)}.item.selected img{visibility:visible!important}.ba-form-fieldset{display:flex;flex-wrap:wrap;margin:0!important}.ba-form-field{flex:1 0 21%;margin:3px;min-width:200px}.ba-form-field-100{flex:1 0 96%;margin:3px;min-width:200px}.ba-input{position:relative}.ba-input>input,.ba-input>select{height:50px;padding:18px 10px 2px 9px;width:100%;box-sizing:border-box;border-style:solid;border-width:1px}.ba-input select{height:50px;padding:20px 5px 4px 5px}[data-ba-input-disabled].ba-input>input,[data-ba-input-disabled].ba-input>select{border-color:transparent!important}.light [data-ba-input-disabled]>input,.light [data-ba-input-disabled]>select{background-color:#fff!important}.dark [data-ba-input-disabled]>input,.dark [data-ba-input-disabled]>select{background-color:#252526!important}[data-ba-input-disabled]>select{appearance:none;padding-left:8px}.ba-input>label{display:inline-block;position:absolute;padding-left:10px;padding-right:10px;color:#acacac;cursor:text;-webkit-transition:all .1s ease-out;-moz-transition:all .1s ease-out;-ms-transition:all .1s ease-out;-o-transition:all .1s ease-out;transition:all .1 ease-out;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:initial;text-align:initial;white-space:nowrap}.ba-input>label{top:12px;overflow:hidden;text-overflow:ellipsis;max-width:calc(100% - 14px)}.ba-input>label.focused,.ba-input>label.hasval{top:-1px}.ba-input>input,.ba-input>select{outline:0;border-radius:5px}.dark .ba-input>label.focused,.light .ba-input>label.focused{color:#039be5}.dark .ba-input>input,.dark .ba-input>select{color:#ccc;background-color:#333;border-color:#5b5b5b}.light .ba-input>input,.light .ba-input>select{color:#757575;background-color:#fff;border-color:#c7c7c7}.light .ba-input>input:focus,.light .ba-input>select:focus{border-color:#039be5;background-color:#f8f9f9}.dark .ba-input>input:focus,.dark .ba-input>select:focus{border-color:#039be5;background-color:#3c3c3c}.dark .ba-input>input.validation-error,.dark .ba-input>select.validation-error,.light .ba-input>input.validation-error,.light .ba-input>select.validation-error{border-color:#ca2a2a}.dark .validation-error-message,.light .validation-error-message{color:#ca2a2a}.ba-link{color:#039be5;cursor:pointer;text-decoration:underline}.ba-link:hover{color:#f57c00}::-webkit-scrollbar{width:15px}.dark ::-webkit-scrollbar-track{background:#1e1e1e;border-left:1px solid #333}.dark ::-webkit-scrollbar-thumb{background:#424242}.dark ::-webkit-scrollbar-thumb:hover{background:#4f4f4f}.dark ::-webkit-scrollbar-thumb:active{background:#5e5e5e}.light ::-webkit-scrollbar-track{background:#fff;border-left:1px solid #ddd}.light ::-webkit-scrollbar-thumb{background:#c1c1c1}.light ::-webkit-scrollbar-thumb:hover{background:#929292}.light ::-webkit-scrollbar-thumb:active{background:#666}.edit-form{position:fixed;top:0;right:0;height:100%;width:100%;box-shadow:rgba(0,0,0,.2) 0 6px 6px 0,rgba(0,0,0,.19) 0 13px 20px 0;display:flex;flex-direction:column;height:100%;width:400px;z-index:1000}@media screen and (max-width:1000px){.edit-form{width:100%}}.dark .edit-form{background-color:#252526}.light .edit-form{background-color:#fff}.edit-form-header{height:200px;text-align:center;border-radius:10px}.export-service .edit-form-header{border-radius:unset}.edit-form-title{color:#fff;margin:0;padding:14px 17px 7px 17px}.edit-form-avatar{border-radius:50%;width:150px;height:150px;position:absolute;top:75px;border:5px solid #fff;left:50%;transform:translateX(-50%);background-color:#cacaca;box-shadow:rgba(0,0,0,.2) 0 6px 6px 0,rgba(0,0,0,.19) 0 13px 20px 0}.edit-form-close{position:absolute;right:14px;top:14px;width:34px;height:34px;cursor:pointer}.edit-form-fields{flex-grow:1;overflow-y:auto;overflow-x:hidden}.edit-form-fields-inner{margin:0 7px 20px 7px}.chart-menu{opacity:0;display:inline-block;z-index:1000;position:absolute;text-align:left;user-select:none;min-width:270px;box-shadow:rgba(0,0,0,.2) 0 4px 8px 0,rgba(0,0,0,.19) 0 6px 20px 0;font:13px/28px Helvetica,"Segoe UI",Arial,sans-serif;border-radius:10px}.chart-menu>div:hover img{filter:invert(100%)}.chart-menu [data-item]{text-align:start;padding:7px 10px}.dark .chart-menu [data-item]{background-color:#252526;color:#acacac;border-bottom:1px solid #333}.dark .chart-menu [data-item]:hover{background-color:#094771!important;color:#fff!important}.dark .chart-menu [data-item]:hover svg{filter:brightness(0) invert(1)}.light .chart-menu [data-item]{background-color:#fff;color:#333;border-bottom:1px solid #c7c7c7}.light .chart-menu [data-item]:hover{background-color:#0074e8!important;color:#fff!important}.light .chart-menu [data-item]:hover svg{filter:brightness(0) invert(1)}.chart-menu [data-item] svg{vertical-align:middle}.chart-menu [data-item]:first-child{border-top-left-radius:7px;border-top-right-radius:7px}.chart-menu [data-item]:last-child{border-bottom-width:0;border-bottom-style:none;border-bottom-left-radius:7px;border-bottom-right-radius:7px}.search{position:absolute}@media screen and (max-width:1000px){.search{width:calc(100% - 30px)}}.search .ba-input{margin-bottom:0}.search-input{color:#7a7a7a;width:100%;border:none;outline:0;padding-top:10px;padding-right:47px}.search label{padding-right:47px}.search-image-td{width:43px}.search-text-td{padding-inline-end:7px;line-height:15px;text-align:start}.search table{box-shadow:rgba(0,0,0,.2) 0 4px 8px 0,rgba(0,0,0,.19) 0 6px 20px 0;margin:0 3.5px 0 3.5px;width:calc(100% - 7px);border-radius:7px}.search table tr:first-child td:first-child{border-top-left-radius:7px}.search table tr:first-child td:last-child{border-top-right-radius:7px}[dir=rtl] .search table tr:first-child td:first-child{border-top-left-radius:unset;border-top-right-radius:7px}[dir=rtl] .search table tr:first-child td:last-child{border-top-right-radius:unset;border-top-left-radius:7px}.search table tr:last-child td:first-child{border-bottom-left-radius:7px}.search table tr:last-child td:last-child{border-bottom-right-radius:7px}[dir=rtl] .search table tr:last-child td:first-child{border-bottom-left-radius:unset;border-bottom-right-radius:7px}[dir=rtl] .search table tr:last-child td:last-child{border-bottom-right-radius:unset;border-bottom-left-radius:7px}.dark .search table{background-color:#252526;color:#acacac}.search [data-search-item-id]{cursor:pointer}.search-photo{margin:7px 7px 0 7px;width:32px;height:32px;background-size:cover;background-position:top center;border-radius:50%;display:inline-block;border:1px solid #8c8c8c}.dark .search [data-search-item-id] td{border-top:1px solid #333}.dark .search [data-search-item-id]:hover,.dark .search [data-selected=yes]{background-color:#094771;color:#fff}.light .search table{background-color:#fff;color:#333}.light .search [data-search-item-id] td{border-top:1px solid #c7c7c7}.light .search [data-search-item-id]:hover,.light .search [data-selected=yes]{background-color:#0074e8;color:#fff}.search [data-search-item-id]:first-child td{border-top:unset}.bg-ripple-container{position:absolute;top:0;right:0;bottom:0;left:0}.drag-over rect{opacity:.5}.bg-ripple-container span{transform:scale(0);border-radius:100%;position:absolute;opacity:.75;background-color:#fff;animation:bg-ripple 1s}@-moz-keyframes bg-ripple{to{opacity:0;transform:scale(2)}}@-webkit-keyframes bg-ripple{to{opacity:0;transform:scale(2)}}@-o-keyframes bg-ripple{to{opacity:0;transform:scale(2)}}@keyframes bg-ripple{to{opacity:0;transform:scale(2)}}.bg-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;-webkit-transition:.4s;transition:.4s}.bg-slider:before{position:absolute;content:"";height:16px;width:16px;left:4px;bottom:4px;background-color:#fff;-webkit-transition:.4s;transition:.4s}.bg-slider.round{border-radius:24px}.bg-slider.round:before{border-radius:50%}svg text:hover{cursor:default}svg.cursor-grab,svg.cursor-grab text:hover{cursor:grab}svg.cursor-nodrop,svg.cursor-nodrop text:hover{cursor:no-drop}svg.cursor-copy,svg.cursor-copy text:hover{cursor:copy}svg.cursor-move,svg.cursor-move text:hover{cursor:move}#close-btn:focus,#close-btn:hover{color:#000;text-decoration:none;cursor:pointer}#id-select:focus,#pid-select:focus{outline:.5px solid #aeaeae}#sampleDialog #title:hover{cursor:default;background:gray}.light{background-color:#fff;font:13px/28px Helvetica,"Segoe UI",Arial,sans-serif}.dark{background-color:#1e1e1e;font:13px/28px Helvetica,"Segoe UI",Arial,sans-serif}.light .ba-fill{fill:#fff}.dark .ba-fill{fill:#1e1e1e}.dark input,.dark select,.light input,.light select{font:16px Helvetica,"Segoe UI",Arial,sans-serif}.dark h1,.light h1{font-size:30px;line-height:1}.edit-form{position:absolute;border-radius:10px}.export-service .edit-form{border-radius:unset}.dark .edit-form{color:#acacac}.light .edit-form{color:#333}.edit-form .ba-img-button:hover{background-color:#f57c00!important}.dark ::-webkit-calendar-picker-indicator{filter:invert(70%)}.light ::-webkit-calendar-picker-indicator{filter:invert(50%)}.edit-form-instruments{margin:42px 10px 0 10px;text-align:center;min-height:70px}.ba-img-button svg{position:relative;top:12px}.light .bg-toolbar-container svg circle,.light .bg-toolbar-container svg line,.light .bg-toolbar-container svg path{stroke:#8c8c8c!important;fill:#8c8c8c!important}.dark .bg-toolbar-container svg circle,.dark .bg-toolbar-container svg line,.dark .bg-toolbar-container svg path{stroke:#8c8c8c!important;fill:#8c8c8c!important}.dark .bg-toolbar-container svg rect{fill:#252526!important}.dark .bg-toolbar-container [data-tlbr=minus] svg{border-left:1px solid #5b5b5b!important;border-right:1px solid #5b5b5b!important;border-bottom:1px solid #5b5b5b!important}.dark .bg-toolbar-container [data-tlbr=plus] svg{border-left:1px solid #5b5b5b!important;border-right:1px solid #5b5b5b!important;border-top:1px solid #5b5b5b!important}.dark .bg-toolbar-container [data-tlbr]>svg{border:1px solid #5b5b5b!important;background-color:#252526!important}</style>'},FamilyTree.events.on("redraw",(function(e,t){if(e.config.state){var i=[],r=[];!function e(t){if(Array.isArray(t))for(var a=0;a<t.length;a++)e(t[a]);else{("string"!=typeof t.id||"string"==typeof t.id&&-1==t.id.indexOf("split")&&-1==t.id.indexOf("mirror"))&&(i.push(t.id),1==t.min&&r.push(t.id));for(a=0;a<t.stChildren.length;a++)e(t.stChildren[a]);for(a=0;a<t.children.length;a++)e(t.children[a])}}(e.roots),FamilyTree.state._put(e.width(),e.height(),e.response.viewBox,i,r,e.response.adjustify,e.config.state)}})),FamilyTree.state={},FamilyTree.state._buildStateNames=function(e){return{paramScale:e+"-scale",paramX:e+"-x",paramY:e+"-y",paramExp:e+"-exp",paramMin:e+"-min",paramAdjustify:e+"-adjustify"}},FamilyTree.state._put=function(e,t,i,r,a,n,o){if(o){var l=FamilyTree.state._buildStateNames(o.name),s={scale:Math.min(e/i[2],t/i[3]),x:i[0],y:i[1],exp:r,min:a,adjustify:n};if(o.writeToUrlParams){var d=new URLSearchParams(window.location.search);d.has(l.paramScale)?d.set(l.paramScale,s.scale):d.append(l.paramScale,s.scale),d.has(l.paramX)?d.set(l.paramX,s.x):d.append(l.paramX,s.x),d.has(l.paramY)?d.set(l.paramY,s.y):d.append(l.paramY,s.y),d.has(l.paramExp)?d.set(l.paramExp,s.exp.join("*")):d.append(l.paramExp,s.exp.join("*")),d.has(l.paramMin)?d.set(l.paramMin,s.min.join("*")):d.append(l.paramMin,s.min.join("*")),d.has(l.paramAdjustify)?d.set(l.paramAdjustify,s.adjustify.x+"*"+s.adjustify.y):d.append(l.paramAdjustify,s.adjustify.x+"*"+s.adjustify.y),window.history.replaceState(null,null,"?"+d)}o.writeToIndexedDB&&(s.id=o.name,FamilyTree.idb.put(s,(function(e){0==e&&console.error("Cannot write row - "+o.name)}))),o.writeToLocalStorage&&FamilyTree.localStorage.setItem(o.name,JSON.stringify(s))}},FamilyTree.state._get=function(e,t,i,r){if(e){var a=FamilyTree.state._buildStateNames(e.name);if(e.readFromUrlParams){var n=new URLSearchParams(window.location.search);if(n.has(a.paramScale)&&n.has(a.paramX)&&n.has(a.paramY)&&n.has(a.paramExp)&&n.has(a.paramMin)&&n.has(a.paramAdjustify)){var o={},l=parseFloat(n.get(a.paramScale)),s=parseFloat(n.get(a.paramX)),d=parseFloat(n.get(a.paramY));(m=[])[0]=s,m[1]=d,m[2]=t/l,m[3]=i/l,o.vb=m,o.scale=l,o.x=s,o.y=d,o.exp=n.get(a.paramExp).split("*"),o.min=n.get(a.paramMin).split("*");var c=n.get(a.paramAdjustify).split("*");return o.adjustify={x:parseFloat(c[0]),y:parseFloat(c[1])},void r(o)}if(!e.readFromIndexedDB&&!e.readFromLocalStorage)return void r(null)}if(e.readFromLocalStorage){var m;if(null!=(o=FamilyTree.localStorage.getItem(e.name)))return o=JSON.parse(o),(m=[])[0]=o.x,m[1]=o.y,m[2]=t/o.scale,m[3]=i/o.scale,o.vb=m,void r(o);if(!e.readFromIndexedDB)return void r(null)}e.readFromIndexedDB&&FamilyTree.idb.read(e.name,(function(a,n){if(0==a)console.error("Cannot read from - "+e.name),r(null);else if(null==a)r(null);else{var o=[];o[0]=n.x,o[1]=n.y,o[2]=t/n.scale,o[3]=i/n.scale,n.vb=o,r(n)}}))}else r(null)},FamilyTree.state.clear=function(e){if(!e)return!1;var t=FamilyTree.state._buildStateNames(e),i=new URLSearchParams(window.location.search);i.has(t.paramScale)&&i.delete(t.paramScale),i.has(t.paramX)&&i.delete(t.paramX),i.has(t.paramY)&&i.delete(t.paramY),i.has(t.paramExp)&&i.delete(t.paramExp),i.has(t.paramMin)&&i.delete(t.paramMin),i.has(t.paramAdjustify)&&i.delete(t.paramAdjustify),window.history.replaceState(null,null,"?"+i),FamilyTree.idb.delete(e,(function(t){0==t&&console.error("Cannot delete row - "+e)}))},FamilyTree.events.on("redraw",(function(e,t){if(e.config.miniMap){var i=FamilyTree.miniMap._getCanvas(e),r=i.getContext("2d");i.width=i.width,i.height=i.height;var a=e.response.boundary.maxX-e.response.boundary.minX,n=e.response.boundary.maxY-e.response.boundary.minY,o=Math.min(i.width/a,i.height/n),l=(i.width-a*o)/2,s=(i.height-n*o)/2;r.clearRect(0,0,i.width,i.height),r.translate(-e.response.boundary.minX*o+l,-e.response.boundary.minY*o+s),r.scale(o,o);var d=0,c=[];!function e(t,i){if(Array.isArray(i))for(var a=0;a<i.length;a++)e(t,i[a]);else{r.fillStyle=FamilyTree.miniMap.colors[3],r.beginPath(),r.lineWidth="0.5",r.fillRect(i.x,i.y,i.w,i.h),r.strokeRect(i.x,i.y,i.w,i.h);for(a=0;a<i.stChildrenIds.length;a++)d++,c.includes(i.id)||(1==d?r.fillStyle=FamilyTree.miniMap.colors[0]:2==d?r.fillStyle=FamilyTree.miniMap.colors[1]:3==d&&(r.fillStyle=FamilyTree.miniMap.colors[2]),r.beginPath(),r.fillRect(i.x,i.y,i.w,i.h),r.strokeRect(i.x,i.y,i.w,i.h),c.push(i.id)),e(t,t.getNode(i.stChildrenIds[a])),d--;for(a=0;a<i.childrenIds.length;a++)e(t,t.getNode(i.childrenIds[a]))}}(e,e.roots);var m=e.getViewBox()[0],p=e.getViewBox()[1],h=e.getViewBox()[2],u=e.getViewBox()[3];r.lineWidth=.5/o,r.strokeStyle="#f57c00",r.strokeRect(m,p,h,u),r.globalAlpha=.4,r.fillStyle=FamilyTree.miniMap.selectorBackgroundColor,r.fillRect(m,p,h,u)}})),FamilyTree.miniMap={},FamilyTree.miniMap._getCanvas=function(e){if(!(t=e.element.querySelector("["+FamilyTree.attr.id+'="mini-map"]'))){var t;(t=document.createElement("canvas")).width=250,t.height=140,t.setAttribute(FamilyTree.attr.id,"mini-map"),t.style.display="inline-block",t.style.backgroundColor=FamilyTree.miniMap.backgroundColor;var i=document.createElement("div");i.classList.add("mini-map"),i.style.position="absolute",i.style.bottom="10px",i.style.left="10px",i.style.border="1px solid #aeaeae",i.style.padding="5px",i.style.margin=e.config.padding+"px",i.style.backgroundColor=FamilyTree.miniMap.backgroundColor,i.appendChild(t),e.element.appendChild(i)}return t},FamilyTree.miniMap.colors=["#E0E0E0","#BDBDBD","#9E9E9E","#757575"],FamilyTree.miniMap.selectorBackgroundColor="white",FamilyTree.miniMap.backgroundColor="white",void 0===FamilyTree&&(FamilyTree={}),FamilyTree.events.on("renderdefs",(function(e,t){for(var i=0;i<e.config.slinks.length;i++){var r=e.config.slinks[i].template;r||(r="orange");var a=FamilyTree.slinkTemplates[r];t.defs+=a.defs}})),FamilyTree.events.on("render",(function(e,t){e._slinks(e,t)})),FamilyTree.prototype._slinks=function(e,t){var i="",r=this.getScale(),a=t.res.boundary;function n(t,n,o){var s=[],d=null,c="left",m=t.lcn?t.lcn:"base",p=e._layoutConfigs[m];switch(p.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:n.x>t.x&&(c="right");break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:c="top",n.y>t.y&&(c="bottom")}var h=FamilyTree.t(t.templateName,t.min,r),u=p.levelSeparation;(t.parent&&t.parent.layout==FamilyTree.mixed||t.parent&&t.parent.layout==FamilyTree.tree)&&(u=p.mixedHierarchyNodesSeparation);var y={p:t.x+t.w/2+h.expandCollapseSize,q:t.y,r:t.x+t.w/2+h.expandCollapseSize,s:a.minY+u};if(t.level==n.level)switch(d=n,p.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:s.push([y.p,y.q]),s.push([y.p,y.q-u/3]),h=FamilyTree.t(d.templateName,d.min,r),s.push([d.x+d.w/2+h.expandCollapseSize,s[s.length-1][1]]),s.push([s[s.length-1][0],d.y]);break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:y.q=t.y+t.h,y.s=a.maxY-u,s.push([y.p,y.q]),s.push([y.r,t.y+t.h+u/3]),h=FamilyTree.t(d.templateName,d.min,r),s.push([d.x+d.w/2+h.expandCollapseSize,s[s.length-1][1]]),s.push([s[s.length-1][0],d.y+d.h]);break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:y.p=t.x,y.q=t.y+t.h/2+h.expandCollapseSize,y.r=a.minX-u,y.s=t.y+t.h/2+h.expandCollapseSize,s.push([y.p,y.q]),s.push([t.x-u/3,y.q]),h=FamilyTree.t(d.templateName,d.min,r),s.push([s[s.length-1][0],d.y+d.h/2+h.expandCollapseSize]),s.push([d.x,s[s.length-1][1]]);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:y.p=t.x+t.w,y.q=t.y+t.h/2+h.expandCollapseSize,y.r=a.maxX+u,y.s=t.y+t.h/2+h.expandCollapseSize,s.push([y.p,y.q]),s.push([t.x+t.w+u/3,y.q]),h=FamilyTree.t(d.templateName,d.min,r),s.push([s[s.length-1][0],d.y+d.h/2+h.expandCollapseSize]),s.push([d.x+d.w,s[s.length-1][1]])}else{switch(p.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:s.push([y.p,y.q]),s.push([y.r,t.y-u/3]);break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:y.q=t.y+t.h,y.s=a.maxY-u,s.push([y.p,y.q]),s.push([y.r,t.y+t.h+u/3]);break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:y.p=t.x,y.q=t.y+t.h/2+h.expandCollapseSize,y.r=a.minX-u,y.s=t.y+t.h/2+h.expandCollapseSize,s.push([y.p,y.q]),s.push([t.x-u/3,y.q]);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:y.p=t.x+t.w,y.q=t.y+t.h/2+h.expandCollapseSize,y.r=a.maxX+u,y.s=t.y+t.h/2+h.expandCollapseSize,s.push([y.p,y.q]),s.push([t.x+t.w+u/3,y.q])}for(var f=t;null==d;){var g=!1,b=f.parent,T=b.leftNeighbor,v=b.rightNeighbor;if(b.id==n.id?d=b:FamilyTree._intersects(b,y,e.config)&&(y=FamilyTree._addPoint(b,s,e.config,y,c),g=!0),b.id!=n.id){for(;T;){if(T.id==n.id){d=T;break}FamilyTree._intersects(T,y,e.config)&&(y=FamilyTree._addPoint(T,s,e.config,y,c),g=!0),T=T.leftNeighbor}for(;v;){if(v.id==n.id){d=v;break}FamilyTree._intersects(v,y,e.config)&&(y=FamilyTree._addPoint(v,s,e.config,y,c),g=!0),v=v.rightNeighbor}}if(!g){var F=s[s.length-1][0],x=0;if(b.parent)switch(u=p.levelSeparation,b.parent.layout!=FamilyTree.mixed&&b.parent.layout!=FamilyTree.tree||(u=p.mixedHierarchyNodesSeparation),p.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:x=b.parent.y+b.parent.h+u*(2/3);break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:x=b.parent.y-u*(2/3);break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:F=b.parent.x+b.parent.w+u*(2/3),x=s[s.length-1][1];break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:F=b.parent.x-u*(2/3),x=s[s.length-1][1]}s.push([F,x])}f=b}switch(h=FamilyTree.t(d.templateName,d.min,r),s.splice(s.length-1,1),p.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:s.push([d.x+d.w/2+h.expandCollapseSize,s[s.length-1][1]]),s.push([s[s.length-1][0],d.y+d.h]);break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:s.push([d.x+d.w/2+h.expandCollapseSize,s[s.length-1][1]]),s.push([s[s.length-1][0],d.y]);break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:s.push([s[s.length-1][0],d.y+d.h/2+h.expandCollapseSize]),s.push([d.x+d.w,s[s.length-1][1]]);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:s.push([s[s.length-1][0],d.y+d.h/2+h.expandCollapseSize]),s.push([d.x,s[s.length-1][1]])}}var _=l.template;_||(_="orange");var w,k,S=null;switch((h=FamilyTree.slinkTemplates[_]).labelPosition){case"start":S={x:s[1][0],y:s[1][1]};break;case"middle":var I=Math.ceil(s.length/2);w=s[I],k=s[I-1],S={x:(w[0]+k[0])/2,y:(w[1]+k[1])/2};break;case"end":S={x:s[s.length-2][0],y:s[s.length-2][1]}}o&&(s=s.reverse()),s[0]="M"+s[0].join(",");for(var C=1;C<s.length;C++)s[C]="L"+s[C].join(",");var A=s.join(" ");if(l.label){var N=h.label.replace("{x}",S.x).replace("{y}",S.y).replace("{val}",l.label),L=FamilyTree._getLabelSize(N),M=-L.height/2;switch(p.orientation){case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:M=L.height}i+=h.label.replace("{x}",S.x).replace("{y}",S.y+M).replace("{val}",l.label)}i+=("<g "+FamilyTree.attr.s_link_from+'="{from}" '+FamilyTree.attr.s_link_to+'="{to}">').replace("{from}",t.id).replace("{to}",n.id)+h.link.replaceAll("{d}",A)+'<path stroke="transparent" stroke-width="15" fill="none" d="'+A+'" />',i+=FamilyTree.grCloseTag}for(var o=0;o<this.config.slinks.length;o++){var l=this.config.slinks[o],s=e.getNode(l.from),d=e.getNode(l.to);s&&d&&-1!=t.res.visibleNodeIds.indexOf(d.id)&&-1!=t.res.visibleNodeIds.indexOf(s.id)&&(s.level>=d.level?n(s,d,!1):n(d,s,!0))}t.content+=i},FamilyTree.prototype.addSlink=function(e,t,i,r){return this.removeClink(e,t),this.config.slinks.push({from:e,to:t,label:i,template:r}),this},FamilyTree.prototype.removeSlink=function(e,t){for(var i=this.config.slinks.length-1;i>=0;i--){var r=this.config.slinks[i];r.from==e&&r.to==t&&this.config.slinks.splice(i,1)}return this},FamilyTree.slinkTemplates={},FamilyTree.slinkTemplates.orange={defs:'<marker id="arrowSlinkOrange" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path fill="#F57C00" d="M 0 0 L 10 5 L 0 10 z" /></marker><marker id="dotSlinkOrange" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="5" markerHeight="5"> <circle cx="5" cy="5" r="5" fill="#F57C00" /></marker>',link:'<path stroke-dasharray="4, 2" marker-start="url(#dotSlinkOrange)" marker-end="url(#arrowSlinkOrange)" stroke-linejoin="round" stroke="#F57C00" stroke-width="2" fill="none" d="{d}" />',label:'<text dominant-baseline="middle" fill="#F57C00" alignment-baseline="middle" text-anchor="middle" x="{x}" y="{y}">{val}</text>',labelPosition:"middle"},FamilyTree.slinkTemplates.blue={defs:'<marker id="arrowSlinkBlue" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path fill="#039BE5" d="M 0 0 L 10 5 L 0 10 z" /></marker><marker id="dotSlinkBlue" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="5" markerHeight="5"> <circle cx="5" cy="5" r="5" fill="#039BE5" /></marker>',link:'<path stroke-dasharray="4, 2" marker-start="url(#dotSlinkBlue)" marker-end="url(#arrowSlinkBlue)" stroke-linejoin="round" stroke="#039BE5" stroke-width="2" fill="none" d="{d}" />',label:'<text fill="#039BE5" text-anchor="middle" x="{x}" y="{y}">{val}</text>',labelPosition:"middle"},FamilyTree.slinkTemplates.yellow={defs:'<marker id="arrowSlinkYellow" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path fill="#FFCA28" d="M 0 0 L 10 5 L 0 10 z" /></marker><marker id="dotSlinkYellow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="5" markerHeight="5"> <circle cx="5" cy="5" r="5" fill="#FFCA28" /></marker>',link:'<path stroke-dasharray="4, 2" marker-start="url(#dotSlinkYellow)" marker-end="url(#arrowSlinkYellow)" stroke-linejoin="round" stroke="#FFCA28" stroke-width="2" fill="none" d="{d}" />',label:'<text  fill="#FFCA28" text-anchor="middle" x="{x}" y="{y}">{val}</text>',labelPosition:"middle"},void 0===FamilyTree&&(FamilyTree={}),FamilyTree.events.on("renderdefs",(function(e,t){for(var i=0;i<e.config.clinks.length;i++){var r=e.config.clinks[i].template;r||(r="orange");var a=FamilyTree.clinkTemplates[r];t.defs+=a.defs}})),FamilyTree.events.on("render",(function(e,t){e._clink(e,t)})),FamilyTree.prototype._clink=function(e,t){for(var i,r,a,n,o,l="",s=0;s<this.config.clinks.length;s++){var d=this.config.clinks[s],c=e.getNode(d.from),m=e.getNode(d.to);if(c&&-1!=t.res.visibleNodeIds.indexOf(c.id)&&(m&&-1!=t.res.visibleNodeIds.indexOf(m.id))){var p=c.x,h=c.y,u=m.x,y=m.y,f={},g={},b=p+c.w/2,T=u+m.w/2,v=h+c.h/2,F=y+m.h/2,x=1;switch(this.config.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:b<=T?(x=1,f.x=b+c.w/10,g.x=T-m.w/10):(x=-1,f.x=b-c.w/10,g.x=T+m.w/10),h==y?(x=1,f.y=h,g.y=y):h>y?(f.y=h,g.y=y+m.h):(f.y=h+c.h,g.y=y);break;case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:b<=T?(x=-1,f.x=b+c.w/10,g.x=T+m.w/10):(x=1,f.x=b-c.w/10,g.x=T+m.w/10),h==y?(x=-1,f.y=h+c.h,g.y=y+m.h):h>y?(f.y=h,g.y=y+m.h):(f.y=h+c.h,g.y=y);break;case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:v<=F?(x=-1,f.y=v+c.h/5,g.y=F+m.h/5):(x=1,f.y=v-c.h/5,g.y=F+m.h/5),p==u?(x=-1,f.x=p,g.x=u):p>u?(f.x=p,g.x=u+m.w):(f.x=p+c.w,g.x=u);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:v<=F?(x=1,f.y=v+c.h/5,g.y=F+m.h/5):(x=-1,f.y=v-c.h/5,g.y=F+m.h/5),p==u?(x=1,f.x=p+c.w,g.x=u+m.w):p>u?(f.x=p,g.x=u+m.w):(f.x=p+c.w,g.x=u)}var _=C(f,g,x),w=d.template;w||(w="orange");var k=FamilyTree.clinkTemplates[w],S=(i=f,a=_,n=void 0,o=void 0,n=((r=g).x-i.x)/2+i.x,o=(r.y-i.y)/2+i.y,{x:(n-a.x)/2+a.x,y:(o-a.y)/2+a.y});d.label&&(l+=k.label.replace("{x}",S.x).replace("{y}",S.y).replace("{val}",d.label));var I="M"+f.x+","+f.y+"C"+f.x+","+f.y+" "+_.x+","+_.y+" "+g.x+","+g.y;l+=("<g "+FamilyTree.attr.c_link_from+'="{from}" '+FamilyTree.attr.c_link_to+'="{to}">').replace("{from}",c.id).replace("{to}",m.id)+k.link.replaceAll("{d}",I)+'<path stroke="transparent" stroke-width="15" fill="none" d="'+I+'" />',l+=FamilyTree.grCloseTag}function C(e,t,i){null==i&&(i=1);var r=t.x-e.x,a=t.y-e.y,n=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))/3;return n=n/(Math.sqrt(r*r+a*a)*i)*FamilyTree.CLINK_CURVE,{x:e.x+r/2-a*n,y:e.y+a/2+r*n}}}t.content+=l},FamilyTree.prototype.addClink=function(e,t,i,r){return this.removeClink(e,t),this.config.clinks.push({from:e,to:t,label:i,template:r}),this},FamilyTree.prototype.removeClink=function(e,t){for(var i=this.config.clinks.length-1;i>=0;i--){var r=this.config.clinks[i];r.from==e&&r.to==t&&this.config.clinks.splice(i,1)}return this},FamilyTree.clinkTemplates={},FamilyTree.clinkTemplates.orange={defs:'<marker id="arrowOrange" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path fill="#F57C00" d="M 0 0 L 10 5 L 0 10 z" /></marker><marker id="dotOrange" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="5" markerHeight="5"> <circle cx="5" cy="5" r="5" fill="#F57C00" /></marker>',link:'<path marker-start="url(#dotOrange)" marker-end="url(#arrowOrange)" stroke="#F57C00" stroke-width="2" fill="none" d="{d}" />',label:'<text fill="#F57C00" text-anchor="middle" x="{x}" y="{y}">{val}</text>'},FamilyTree.clinkTemplates.blue={defs:'<marker id="arrowBlue" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path fill="#039BE5" d="M 0 0 L 10 5 L 0 10 z" /></marker><marker id="dotBlue" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="5" markerHeight="5"> <circle cx="5" cy="5" r="5" fill="#039BE5" /></marker>',link:'<path marker-start="url(#dotBlue)" marker-end="url(#arrowBlue)" stroke="#039BE5" stroke-width="2" fill="none" d="{d}" />',label:'<text fill="#039BE5"  text-anchor="middle" x="{x}" y="{y}">{val}</text>'},FamilyTree.clinkTemplates.yellow={defs:'<marker id="arrowYellow" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse"><path fill="#FFCA28" d="M 0 0 L 10 5 L 0 10 z" /></marker><marker id="dotYellow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="5" markerHeight="5"> <circle cx="5" cy="5" r="5" fill="#FFCA28" /></marker>',link:'<path marker-start="url(#dotYellow)" marker-end="url(#arrowYellow)" stroke="#FFCA28" stroke-width="2" fill="none" d="{d}" />',label:'<text fill="#FFCA28"  text-anchor="middle" x="{x}" y="{y}">{val}</text>'},FamilyTree.loading={},FamilyTree.loading.show=function(e){var t=document.createElement("div");t.id="bg-loading",t.innerHTML='<style>@-webkit-keyframes dot-keyframes {0% { opacity: .4; -webkit-transform: scale(1, 1);transform: scale(1, 1);}50% {opacity: 1;-webkit-transform: scale(1.2, 1.2);transform: scale(1.2, 1.2);}100% {opacity: .4;-webkit-transform: scale(1, 1);transform: scale(1, 1);}}@keyframes dot-keyframes {0% {opacity: .4;-webkit-transform: scale(1, 1);transform: scale(1, 1);}50% {opacity: 1;-webkit-transform: scale(1.2, 1.2);transform: scale(1.2, 1.2);}100% {opacity: .4;-webkit-transform: scale(1, 1);transform: scale(1, 1);}}.bg-loading-dots div {margin: 10px;}      .bg-dot-1 {background-color: #039BE5;}.bg-dot-2 {background-color: #F57C00;}.bg-dot-3 {background-color: #FFCA28;}      .bg-loading-dots {text-align: center;width: 100%; position: absolute; top: 0;}.bg-loading-dots--dot {-webkit-animation: dot-keyframes 1.5s infinite ease-in-out;animation: dot-keyframes 1.5s infinite ease-in-out;        border-radius: 10px;display: inline-block;height: 10px;width: 10px;}.bg-loading-dots--dot:nth-child(2) {-webkit-animation-delay: .5s;animation-delay: .5s;}.bg-loading-dots--dot:nth-child(3) {-webkit-animation-delay: 1s;animation-delay: 1s;}</style><div class="bg-loading-dots"><div class="bg-loading-dots--dot bg-dot-1"></div><div class="bg-loading-dots--dot bg-dot-2"></div><div class="bg-loading-dots--dot bg-dot-3"></div></div>',e.element.appendChild(t)},FamilyTree.loading.hide=function(e){var t=e.element.querySelector("#bg-loading");t&&t.parentNode.removeChild(t)},FamilyTree.pdfPrevUI={},FamilyTree.loc||(FamilyTree.loc={}),FamilyTree.loc.ppdfCmdTitle="PDF Preview",FamilyTree.loc.ppdfSave="Save",FamilyTree.loc.ppdfCancel="Cancel",FamilyTree.loc.ppdfFormat="Format",FamilyTree.loc.ppdfFitToDrwaing="Fit",FamilyTree.loc.ppdfA4="A4",FamilyTree.loc.ppdfA3="A3",FamilyTree.loc.ppdfA2="A2",FamilyTree.loc.ppdfA1="A1",FamilyTree.loc.ppdfLetter="Letter",FamilyTree.loc.ppdfLegal="Legal",FamilyTree.loc.ppdfLayout="Layout",FamilyTree.loc.ppdfPortrait="Portrait",FamilyTree.loc.ppdfLandscape="Landscape",FamilyTree.loc.ppdfFittopagewidth="Fit to page width",FamilyTree.loc.ppdfMargin="Margin",FamilyTree.loc.ppdfHeader="Header",FamilyTree.loc.ppdfFooter="Footer",FamilyTree.loc.ppdfScale="Scale",FamilyTree.pdfPrevUI.show=function(e,t){t=e._defaultExportOptions(t,"pdf");var i=document.createElement("div");i.classList.add(e.config.mode),i.id="bg-ppdf-btns",Object.assign(i.style,{position:"absolute",top:0,left:0,"background-color":"#fff","z-index":5,margin:"0 0 0 -265px","box-shadow":"0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)",width:"265px",height:"100%","font-family":"Roboto,Helvetica",color:"#757575","text-align":"right",padding:"10px"}),e.element.appendChild(i),i.innerHTML="<h1>"+FamilyTree.loc.ppdfCmdTitle+'</h1><div><button type="button" id="bg-prev-save" style="font-size: 14px; width: 90px;">'+FamilyTree.loc.ppdfSave+'</button>&nbsp;<button type="button" id="bg-prev-cancel" style="width: 90px;font-size: 14px;">'+FamilyTree.loc.ppdfCancel+'</button></div><div style="margin-top:30px; height:10px;border-bottom:1px solid #eeeeee;"></div><div style="padding-top:30px;"><label for="bg-size">'+FamilyTree.loc.ppdfFormat+': </label><select id="bg-ppdf-size" style="color: #757575; width: 150px; font-size: 14px;" id="bg-size"><option value="fit">'+FamilyTree.loc.ppdfFitToDrwaing+'</option><option value="A4">'+FamilyTree.loc.ppdfA4+'</option><option value="A3">'+FamilyTree.loc.ppdfA3+'</option><option value="A2">'+FamilyTree.loc.ppdfA2+'</option><option value="A1">'+FamilyTree.loc.ppdfA1+'</option><option value="Letter">'+FamilyTree.loc.ppdfLetter+'</option><option value="Legal">'+FamilyTree.loc.ppdfLegal+'</option></select></div><div style="padding-top:10px;"><label for="bg-ppdf-layout">'+FamilyTree.loc.ppdfLayout+': </label><select id="bg-ppdf-layout" style="color: #757575; width: 150px;font-size: 14px;" ><option value="false">'+FamilyTree.loc.ppdfPortrait+'</option><option value="true">'+FamilyTree.loc.ppdfLandscape+'</option></select></div><div style="padding-top:10px;"><label for="bg-scale">'+FamilyTree.loc.ppdfScale+': </label><select id="bg-ppdf-scale" style="color: #757575; width: 150px;font-size: 14px;" id="bg-scale"><option value="fit">'+FamilyTree.loc.ppdfFittopagewidth+'</option><option value="10">10%</option><option value="20">20%</option><option value="30">30%</option><option value="40">40%</option><option value="50">50%</option><option value="60">60%</option><option value="70">70%</option><option value="80">80%</option><option value="90">90%</option><option value="100">100%</option><option value="110">110%</option><option value="120">120%</option><option value="130">130%</option><option value="140">140%</option><option value="150">150%</option><option value="160">160%</option><option value="170">170%</option><option value="180">180%</option><option value="190">190%</option><option value="200">200%</option></select></div><div style="margin-top:10px;margin-bottom:10px; height:10px;border-bottom:1px solid #eeeeee;"></div><div style="padding-top:10px;"><label for="bg-ppdf-header">'+FamilyTree.loc.ppdfHeader+': </label><input id="bg-ppdf-header" type="text" style="color: #757575; width: 100px;font-size: 14px;" ></div><div style="padding-top:10px;"><label for="bg-ppdf-footer">'+FamilyTree.loc.ppdfFooter+': </label><input id="bg-ppdf-footer" type="text" style="color: #757575; width: 100px;font-size: 14px;" ></div><div style="padding-top:10px;"><label for="bg-ppdf-margin">'+FamilyTree.loc.ppdfMargin+': </label><input id="bg-ppdf-margin" type="text" style="color: #757575; width: 100px;font-size: 14px;" ></div>';var r=document.createElement("div");r.id="bg-ppdf-wrapper",Object.assign(r.style,{"overflow-y":"scroll","z-index":11,position:"absolute",top:0,left:"285px","background-color":"#eee",width:e.width()-270+"px",height:"100%"}),e.element.appendChild(r),r.innerHTML='<div id="bg-ppdf-content" style="width: 100%;margin-top:10px;margin-bottom:10px;opacity:0;"></div>';var a,n,o,l=e.element.querySelector("#bg-ppdf-size"),s=e.element.querySelector("#bg-ppdf-layout"),d=e.element.querySelector("#bg-ppdf-scale"),c=e.element.querySelector("#bg-ppdf-margin"),m=e.element.querySelector("#bg-ppdf-header"),p=e.element.querySelector("#bg-ppdf-footer");l.value=t.format,s.value=t.landscape,d.value=t.scale,c.value=t.margin,m.value=t.header,p.value=t.footer,FamilyTree.anim(e.element.querySelector("#bg-ppdf-btns"),{margin:[0,0,0,-250]},{margin:[0,0,0,0]},300,FamilyTree.anim.outSin,(function(){e.exportPDF(t,FamilyTree.pdfPrevUI._handler)})),e.element.querySelector("#bg-prev-cancel").addEventListener("click",(function(){FamilyTree.pdfPrevUI.hide(e)})),e.element.querySelector("#bg-prev-save").addEventListener("click",(function(){e.exportPDF(t),FamilyTree.pdfPrevUI.hide(e)})),FamilyTree.pdfPrevUI._showHide(l,s,d),l.addEventListener("change",(function(){FamilyTree.anim(e.element.querySelector("#bg-ppdf-content"),{opacity:1},{opacity:0},300,FamilyTree.anim.inSin,(function(){e.element.querySelector("#bg-ppdf-content").innerHTML="",t.format=l.value,e.exportPDF(t,FamilyTree.pdfPrevUI._handler),FamilyTree.pdfPrevUI._showHide(l,s,d)}))})),s.addEventListener("change",(function(){FamilyTree.anim(e.element.querySelector("#bg-ppdf-content"),{opacity:1},{opacity:0},300,FamilyTree.anim.inSin,(function(){e.element.querySelector("#bg-ppdf-content").innerHTML="",t.landscape="true"==s.value,e.exportPDF(t,FamilyTree.pdfPrevUI._handler),FamilyTree.pdfPrevUI._showHide(l,s,d)}))})),d.addEventListener("change",(function(){FamilyTree.anim(e.element.querySelector("#bg-ppdf-content"),{opacity:1},{opacity:0},300,FamilyTree.anim.inSin,(function(){e.element.querySelector("#bg-ppdf-content").innerHTML="",t.scale=d.value,e.exportPDF(t,FamilyTree.pdfPrevUI._handler),FamilyTree.pdfPrevUI._showHide(l,s,d)}))})),c.addEventListener("keyup",(function(){clearTimeout(a),a=setTimeout((function(){FamilyTree.anim(e.element.querySelector("#bg-ppdf-content"),{opacity:1},{opacity:0},300,FamilyTree.anim.inSin,(function(){e.element.querySelector("#bg-ppdf-content").innerHTML="";var i=c.value.split(",");if(4==i.length){for(var r=0;r<i.length;r++)i[r]=parseInt(i[r]);t.margin=i,e.exportPDF(t,FamilyTree.pdfPrevUI._handler)}}))}),1e3)})),m.addEventListener("keyup",(function(){clearTimeout(n),n=setTimeout((function(){FamilyTree.anim(e.element.querySelector("#bg-ppdf-content"),{opacity:1},{opacity:0},300,FamilyTree.anim.inSin,(function(){e.element.querySelector("#bg-ppdf-content").innerHTML="",t.header=m.value,e.exportPDF(t,FamilyTree.pdfPrevUI._handler)}))}),1e3)})),p.addEventListener("keyup",(function(){clearTimeout(o),o=setTimeout((function(){FamilyTree.anim(e.element.querySelector("#bg-ppdf-content"),{opacity:1},{opacity:0},300,FamilyTree.anim.inSin,(function(){e.element.querySelector("#bg-ppdf-content").innerHTML="",t.footer=p.value,e.exportPDF(t,FamilyTree.pdfPrevUI._handler)}))}),1e3)}))},FamilyTree.pdfPrevUI._showHide=function(e,t,i){"A4"==e.value||"A3"==e.value||"A2"==e.value||"A1"==e.value||"Letter"==e.value||"Legal"==e.value?(t.parentNode.style.display="block",i.parentNode.style.display="block"):(t.parentNode.style.display="none",i.parentNode.style.display="none")},FamilyTree.pdfPrevUI._handler=function(e,t,i){var r=t.options,a=t.pages,n=r.margin[0],o=r.margin[2],l=document.createElement("div");l.classList.add(e.config.mode),l.innerHTML=i.outerHTML,FamilyTree._browser().msie&&(l.innerHTML=(new XMLSerializer).serializeToString(i));for(var s=l.querySelector("svg"),d=e.element.querySelector("#bg-ppdf-content"),c=0;c<a.length;c++){var m=document.createElement("iframe");Object.assign(m.style,{display:"block",margin:"10px auto",border:"1px solid #eeeeee","box-shadow":"0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)"}),d.appendChild(m),s&&s.style.backgroundColor?m.style.backgroundColor=s.style.backgroundColor:m.style.backgroundColor="#fff";var p=m.contentWindow.document;p.open(),m.style.width=a[c].size.w+"px",m.style.height=a[c].size.h+"px",m.style.margin="10 auto",a[c].backgroundColor&&(m.style.backgroundColor=a[c].backgroundColor);var h=r.header;a[c].header&&(h=a[c].header),h&&(h=h.replace("{current-page}",c+1).replace("{total-pages}",a.length));var u=r.footer;a[c].footer&&(u=a[c].footer),u&&(u=u.replace("{current-page}",c+1).replace("{total-pages}",a.length)),a[c].html?p.write(FamilyTree._exportHtml(a[c].html,t.styles,r,a[c].innerSize.w,a[c].innerSize.h,h,u,e.config.mode)):(s.setAttribute("viewBox",a[c].vb),p.write(FamilyTree._exportHtml(l.innerHTML,t.styles,r,a[c].innerSize.w,a[c].innerSize.h,h,u,e.config.mode)));var y=p.getElementById("bg-header"),f=p.getElementById("bg-footer");if(y){var g=n-y.offsetHeight-7;y.style.top=g+"px"}if(f){var b=o-f.offsetHeight-7;f.style.bottom=b+"px"}p.close()}var T=e.element.querySelector("#bg-ppdf-content");FamilyTree.anim(T,{opacity:0},{opacity:1},300,FamilyTree.anim.outSin)},FamilyTree.pdfPrevUI._getViewBox=function(e){var t=null;return e?(t=(t="["+(t=e.getAttribute("viewBox"))+"]").replace(/\ /g,","),t=JSON.parse(t)):null},FamilyTree._exportHtml=function(e,t,i,r,a,n,o,l){for(var s="",d=0;d<i.margin.length;d++)s+=i.margin[d]+"px ";var c='<!DOCTYPE html><html style="margin:0;padding:0;"><head></head>'+t+'<body class="'+l+'" style="margin:0; padding:0;"><div style="margin: '+s+";overflow:hidden;width:"+r+"px;height:"+a+'px">';return n&&(c+='<div id="bg-header" style="width:'+r+"px;color:#757575;position:absolute;left:"+i.margin[3]+'px;top:0;">'+n+"</div>"),c+=e,o&&(c+='<div id="bg-footer" style="width:'+r+"px;color:#757575;position:absolute;left:"+i.margin[3]+'px;bottom:0;">'+o+"</div>"),c+="</div>",c+="</body></html>"},FamilyTree.pdfPrevUI.hide=function(e){var t=e.element.querySelector("#bg-ppdf-wrapper");t&&FamilyTree.anim(t,{opacity:1},{opacity:0},300,FamilyTree.anim.inSin,(function(){t.parentNode.removeChild(t);var i=e.element.querySelector("#bg-ppdf-btns");FamilyTree.anim(i,{margin:[0,0,0,0]},{margin:[0,0,0,-280]},300,FamilyTree.anim.inSin,(function(){i.parentNode.removeChild(i)}))}))},FamilyTree.prototype.zoom=function(e,t,i,r){var a=this.getViewBox().slice(0),n=a,o=a[2],l=a[3];!0===e?(a[2]=a[2]/FamilyTree.SCALE_FACTOR,a[3]=a[3]/FamilyTree.SCALE_FACTOR):!1===e?(a[2]=a[2]*FamilyTree.SCALE_FACTOR,a[3]=a[3]*FamilyTree.SCALE_FACTOR):(a[2]=a[2]/e,a[3]=a[3]/e),t||(t=[50,50]),a[0]=n[0]-(a[2]-o)/(100/t[0]),a[1]=n[1]-(a[3]-l)/(100/t[1]);var s=this.getScale(a);if(a[2]=this.width()/s,a[3]=this.height()/s,!0===e&&s<this.config.scaleMax||!1===e&&s>this.config.scaleMin||0!=e&&1!=e&&s<this.config.scaleMax&&s>this.config.scaleMin){this._hideBeforeAnimation();var d=this;i?(clearTimeout(d._timeout),FamilyTree.anim(this.getSvg(),{viewbox:this.getViewBox()},{viewbox:a},this.config.anim.duration,this.config.anim.func,(function(){clearTimeout(d._timeout),d._timeout=setTimeout((function(){d._draw(!0,FamilyTree.action.zoom,null,r)}),500)}))):(this.setViewBox(a),clearTimeout(d._timeout),d._timeout=setTimeout((function(){d._draw(!0,FamilyTree.action.zoom,null,r)}),500))}},FamilyTree.yScrollUI=function(e,t,i,r,a){this.element=e,this.requestParams=i,this.config=t,this.onSetViewBoxCallback=r,this.onDrawCallback=a,this.pos=0},FamilyTree.yScrollUI.prototype.addListener=function(e){var t=this;if(this.config.mouseScrool==FamilyTree.action.yScroll||this.config.mouseScrool==FamilyTree.action.scroll){var i=FamilyTree._getScrollSensitivity();!function(e,i,r){var a=!1;function n(){a=!0;var e=(t.pos-t.bar.scrollTop)/r;if(e>0)e++;else{if(0==e)return void(a=!1);e--}Math.ceil(t.bar.scrollTop)==Math.ceil(t.pos)?a=!1:(t.bar.scrollTop+=e,o(n))}e.addEventListener("wheel",(function(e){var r=0;if(t.config.mouseScrool==FamilyTree.action.yScroll)(r=e.deltaY||e.wheelDeltaY)||(r=e.deltaX||e.wheelDeltaX);else if(t.config.mouseScrool==FamilyTree.action.scroll&&!(r=e.shiftKey?e.deltaX||e.wheelDeltaX:e.deltaY||e.wheelDeltaY))return;r=-r,r=Math.max(-1,Math.min(1,r)),t.pos+=-r*i;var o=parseFloat(t.innerBar.clientHeight)-parseFloat(t.bar.clientHeight);t.pos<0&&(t.pos=0);t.pos>o&&(t.pos=o);a||n()}),{passive:!0});var o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,20)}}(e,i.speed,i.smooth)}},FamilyTree.yScrollUI.prototype.create=function(e){if(this.config.showYScroll===FamilyTree.scroll.visible||this.config.mouseScrool===FamilyTree.action.scroll||this.config.mouseScrool===FamilyTree.action.yScroll){var t=this;this.bar&&this.bar.parentNode.removeChild(this.bar),this.bar=document.createElement("div"),this.config.showYScroll!==FamilyTree.scroll.visible&&(this.bar.style.visibility="hidden"),this.innerBar=document.createElement("div"),this.innerBar.innerHTML="&nbsp",Object.assign(this.bar.style,{position:"absolute",right:0,bottom:0,height:e+"px","overflow-y":"scroll",width:"20px"}),this.element.appendChild(this.bar),this.bar.appendChild(this.innerBar),this.bar.addEventListener("scroll",(function(){if(this.ignore)this.ignore=!1;else{var e=t.requestParams(),i=(parseFloat(t.innerBar.clientHeight)-parseFloat(t.bar.clientHeight))/100,r=this.scrollTop/i,a=(e.boundary.bottom-e.boundary.top)/100;e.viewBox[1]=r*a+e.boundary.top,t.onSetViewBoxCallback(e.viewBox),clearTimeout(this._timeout),this._timeout=setTimeout((function(){t.onDrawCallback()}),500)}}))}},FamilyTree.yScrollUI.prototype.setPosition=function(){if(this.bar){var e=this.requestParams(),t=e.boundary.maxY*e.scale;switch(this.config.orientation){case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:t=Math.abs(e.boundary.minY*e.scale);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:innerWidth=Math.abs(e.boundary.minX*e.scale)}this.innerBar.style.height=t+"px";var i=(e.boundary.bottom-e.boundary.top)/100,r=(e.viewBox[1]-e.boundary.top)/Math.abs(i);r<0?r=0:r>100&&(r=100);var a=(parseFloat(this.innerBar.clientHeight)-parseFloat(this.bar.clientHeight))/100,n=r*a;this.bar.ignore=!0,this.bar.scrollTop=n,this.pos=this.bar.scrollTop,this.bar.style.visibility=a<=0?"hidden":""}},FamilyTree.xScrollUI=function(e,t,i,r,a){this.element=e,this.requestParams=i,this.config=t,this.onSetViewBoxCallback=r,this.onDrawCallback=a,this.pos=0},FamilyTree.xScrollUI.prototype.addListener=function(e){var t=this;if((this.config.mouseScrool==FamilyTree.action.xScroll||this.config.mouseScrool==FamilyTree.action.scroll)&&this.bar){var i=FamilyTree._getScrollSensitivity();!function(e,i,r){var a=!1;function n(){a=!0;var e=(t.pos-t.bar.scrollLeft)/r;if(e>0)e++;else{if(0==e)return void(a=!1);e--}Math.ceil(t.bar.scrollLeft)==Math.ceil(t.pos)?a=!1:(t.bar.scrollLeft+=e,o(n))}e.addEventListener("wheel",(function(e){var r=0;if(t.config.mouseScrool==FamilyTree.action.xScroll)(r=e.deltaX||e.wheelDeltaX)||(r=e.deltaY||e.wheelDeltaY);else if(t.config.mouseScrool==FamilyTree.action.scroll&&!(r=e.shiftKey?e.deltaY||e.wheelDeltaY:e.deltaX||e.wheelDeltaX))return;r=-r,r=Math.max(-1,Math.min(1,r)),t.pos+=-r*i;var o=parseFloat(t.innerBar.clientWidth)-parseFloat(t.bar.clientWidth);t.pos<0&&(t.pos=0);t.pos>o&&(t.pos=o);a||n()}),{passive:!0});var o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,20)}}(e,i.speed,i.smooth)}},FamilyTree.xScrollUI.prototype.create=function(e){if(this.config.showXScroll===FamilyTree.scroll.visible||this.config.mouseScrool===FamilyTree.action.scroll||this.config.mouseScrool===FamilyTree.action.xScroll){var t=this;this.bar&&this.bar.parentNode.removeChild(this.bar),this.bar=document.createElement("div"),this.config.showXScroll!==FamilyTree.scroll.visible&&(this.bar.style.visibility="hidden"),this.innerBar=document.createElement("div");this.requestParams();this.innerBar.innerHTML="&nbsp",Object.assign(this.bar.style,{position:"absolute",left:0,bottom:0,width:e+"px","overflow-x":"scroll",height:"20px"}),this.element.appendChild(this.bar),this.bar.appendChild(this.innerBar),this.bar.addEventListener("scroll",(function(){if(this.ignore)this.ignore=!1;else{var e=t.requestParams(),i=(parseFloat(t.innerBar.clientWidth)-parseFloat(t.bar.clientWidth))/100,r=this.scrollLeft/i,a=(e.boundary.right-e.boundary.left)/100;e.viewBox[0]=r*a+e.boundary.left,t.onSetViewBoxCallback(e.viewBox),clearTimeout(this._timeout),this._timeout=setTimeout((function(){t.onDrawCallback()}),500)}}))}},FamilyTree.xScrollUI.prototype.setPosition=function(){if(this.bar){var e=this.requestParams(),t=Math.abs(e.boundary.maxX-e.boundary.minX)*e.scale;switch(this.config.orientation){case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:innerHeight=Math.abs(e.boundary.minY*e.scale);break;case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:t=Math.abs(e.boundary.minX*e.scale)}this.innerBar.style.width=t+"px";var i=(e.boundary.right-e.boundary.left)/100,r=(e.viewBox[0]-e.boundary.left)/i;r<0?r=0:r>100&&(r=100);var a=(parseFloat(this.innerBar.clientWidth)-parseFloat(this.bar.clientWidth))/100,n=r*a;this.bar.ignore=!0,this.bar.scrollLeft=n,this.pos=this.bar.scrollLeft,this.bar.style.visibility=a<=0?"hidden":""}},void 0===FamilyTree&&(FamilyTree={}),FamilyTree.manager=function(e,t){this.config=e,this.layoutConfigs=t,this.visibleNodeIds=[],this.viewBox=null,this.action=null,this.actionParams=null,this.nodes={},this.oldNodes={},this.maxX=null,this.maxY=null,this.minX=null,this.minY=null,this.bordersByRootIdAndLevel=null,this.roots=null,this.state=null,this.vbIsInitializedFromState=!1,this.rootList=[]},FamilyTree.manager.prototype.read=function(e,t,i,r,a,n,o,l){var s=this;FamilyTree.state._get(this.config.state,t,i,(function(d){s.state=d,s.action=a,s.actionParams=n,a!=FamilyTree.action.init||!s.state||n&&n.method&&"fit"==n.method?(s.viewBox=r,s.vbIsInitializedFromState=!1):(s.viewBox=s.state.vb,s.vbIsInitializedFromState=!0);var c=s.maxX,m=s.maxY,p=s.minX,h=s.minY,u=s.bordersByRootIdAndLevel,y=s.roots,f=s.nodes;if(e){var g=FamilyTree.manager._getResponse(t,i,s.visibleNodeIds,s.config,c,m,p,h,s.viewBox,y,s.action,s.actionParams,f,s.oldNodes,s.vbIsInitializedFromState);a!=FamilyTree.action.exporting&&(s.maxX=c,s.maxY=m,s.minX=p,s.minY=h,s.roots=y,s.nodes=f,s.visibleNodeIds=g.visibleNodeIds),g.bordersByRootIdAndLevel=u,g.roots=y,g.adjustify={x:0,y:0},s.state&&(g.adjustify=s.state.adjustify),o(g)}else s.oldNodes=f||null,s._read((function(e){c=e.maxX,m=e.maxY,p=e.minX,h=e.minY,u=e.bordersByRootIdAndLevel,y=e.roots,f=e.nodes;var r=FamilyTree.manager._getResponse(t,i,s.visibleNodeIds,s.config,c,m,p,h,s.viewBox,y,s.action,s.actionParams,f,s.oldNodes,s.vbIsInitializedFromState);r.notif=e.limit,r.roots=y,r.bordersByRootIdAndLevel=u,r.adjustify=e.adjustify,a!=FamilyTree.action.exporting&&(s.maxX=c,s.maxY=m,s.minX=p,s.minY=h,s.roots=y,s.nodes=f,s.visibleNodeIds=r.visibleNodeIds,s.bordersByRootIdAndLevel=u,s.rootList=e.rootList),o(r)}),l)}))},FamilyTree.manager.prototype._read=function(e,t){var i=this,r=FamilyTree.manager._createNodes(i.config,i.layoutConfigs,i.action,i.actionParams,i.oldNodes,i.state);t(r);var a=r.nodes,n=r.roots,o=FamilyTree.remote;null==o&&(o=FamilyTree.local),o._setPositions(n,i.layoutConfigs,(function(t){var o=FamilyTree.manager._doNotChangePositionOfClickedNodeIfAny(n,a,i.action,i.actionParams,i.oldNodes,i.config.orientation);i.state&&i.action==FamilyTree.action.init&&(o=i.state.adjustify);for(var l={minX:null,minY:null,maxX:null,maxY:null},s={},d=0;d<n.length;d++)FamilyTree.manager._setMinMaxXYAdjustifyIterate(n[d],n[d],l,0,s,o,i.config.orientation);e({minX:l.minX,minY:l.minY,maxX:l.maxX,maxY:l.maxY,bordersByRootIdAndLevel:s,nodes:a,roots:n,rootList:r.rootList,limit:t,adjustify:o})}),a)},FamilyTree.searchUI=function(){},FamilyTree.searchUI.prototype.init=function(e){this.obj=e;var t=this,i=document.createElement("div");i.classList.add("search"),i.style.right=this.obj.config.padding-10+"px",i.style.top=this.obj.config.padding-10+"px";var r=FamilyTree.elements.textbox({},{label:FamilyTree.SEARCH_PLACEHOLDER},"320px");i.innerHTML+=r.html,this.searchTableWrapper=document.createElement("div"),i.appendChild(this.searchTableWrapper),this.obj.element.appendChild(i),FamilyTree.input.init(i),this.input=document.getElementById(r.id),this.input.addEventListener("keypress",(function(e){"Enter"==e.key&&e.preventDefault()})),this.input.addEventListener("keyup",(function(e){"ArrowDown"==e.key?(e.preventDefault(),a()):"ArrowUp"==e.key?(e.preventDefault(),e.stopPropagation(),n()):"Enter"==e.key?(e.preventDefault(),o()):"Escape"==e.key?(e.preventDefault(),t.hide()):t._serverSearch(this.value)}));var a=function(){var e=t.obj.element.querySelectorAll("[data-search-item-id]"),i=t.obj.element.querySelector('[data-selected="yes"]');null==i&&e.length>0?e[0].setAttribute("data-selected","yes"):e.length>0&&i.nextSibling&&i.nextSibling.setAttribute&&(i.removeAttribute("data-selected"),i.nextSibling.setAttribute("data-selected","yes"))},n=function(){var e=t.obj.element.querySelectorAll("[data-search-item-id]"),i=t.obj.element.querySelector('[data-selected="yes"]');null==i&&e.length>0?e[e.length-1].setAttribute("data-selected","yes"):e.length>0&&i.previousSibling&&i.previousSibling.setAttribute&&(i.removeAttribute("data-selected"),i.previousSibling.setAttribute("data-selected","yes"))},o=function(){var e=t.obj.element.querySelector('[data-selected="yes"]');if(e){var i=e.getAttribute("data-search-item-id");0!=FamilyTree.events.publish("searchclick",[t.obj,i])&&t.obj.center(i)}}},FamilyTree.searchUI.prototype.hide=function(){this.searchTableWrapper&&(this.searchTableWrapper.innerHTML=""),this.input&&(this.input.value="",this.input.focus(),this.input.blur())},FamilyTree.searchUI.prototype.find=function(e){this.input&&(this.input.value=e,this._serverSearch(e),this.input.focus())},FamilyTree.searchUI.prototype._serverSearch=function(e){var t=this,i=FamilyTree._search.search(this.obj.config.nodes,e,this.obj.config.searchFields,this.obj.config.searchFields,this.obj.config.searchDisplayField,this.obj.config.searchFieldsWeight),r=FamilyTree._getFistImgField(this.obj.config),a=`<table border="0" cellspacing="0" cellpadding="0">\n                    <tbody>\n                        ${function(){for(var e="",a=0;a<i.length&&!(a>=FamilyTree.SEARCH_RESULT_LIMIT);a++){var n=i[a],o="";if(r){var l=t.obj._get(n.id);"function"==typeof r?o=r(t.obj,t.obj.getNode(n.id),l):l[r]&&(o=l[r])}var s="",d="";t.obj.config.searchDisplayField==n.__searchField?s=n.__searchMarks:t.obj.config.searchDisplayField?(s=n[t.obj.config.searchDisplayField],FamilyTree.isNullOrEmpty(s)&&(s=""),d=n.__searchMarks):s=n.__searchMarks,e+=FamilyTree.searchUI.createItem(o,n.id,s,d)}return e}()}  \n                    </tbody>\n                </table>`;this.searchTableWrapper.innerHTML=a;for(var n=this.obj.element.querySelectorAll("[data-search-item-id]"),o=0;o<n.length;o++)n[o].addEventListener("click",(function(){if(!1!==FamilyTree.events.publish("searchclick",[t.obj,this.getAttribute("data-search-item-id")])){t.obj.center(this.getAttribute("data-search-item-id"));var e=t.obj.element.querySelector('[data-selected="yes"]');e&&e.removeAttribute("data-selected"),this.setAttribute("data-selected","yes"),t.input.focus()}}))},FamilyTree.searchUI.createItem=function(e,t,i,r){return i&&(i="<b>"+i+"</b>"),`<tr data-search-item-id="${t}">\n                <td class="search-image-td">\n                    ${e=e?`<div class="search-photo" style="background-image: url(${e})"></div>`:`<div class="search-photo">${FamilyTree.icon.user(32,32,"#aeaeae")}</div>`}\n                </td>\n                <td class="search-text-td">${i} <br/>${r}</td>\n            </tr>`},void 0===FamilyTree&&(FamilyTree={}),FamilyTree.idb={version:1,dbName:"BALKAN",tableName:"familytree-js",keyPath:"id"},FamilyTree.idb.db=null,FamilyTree.idb._open=function(e){if(FamilyTree._browser().msie)e&&e(!1);else if((navigator.userAgent.toLowerCase().indexOf("safari")>0||navigator.userAgent.toLowerCase().indexOf("firefox")>0)&&window.location!==window.parent.location)e&&e(!1);else{if(!window.indexedDB)return console.error("Your browser doesn't support a stable version of IndexedDB."),void(e&&e(!1));if(null==FamilyTree.idb.db){var t=indexedDB.open(FamilyTree.idb.dbName,FamilyTree.idb.version);t.onerror=function(t){console.error("Cannot open database!"),e&&e(!1)},t.onsuccess=function(t){FamilyTree.idb.db=t.target.result,e&&e(!0)},t.onupgradeneeded=function(e){var t=e.target.result;t.objectStoreNames.contains(FamilyTree.idb.tableName)&&t.deleteObjectStore(FamilyTree.idb.tableName);t.createObjectStore(FamilyTree.idb.tableName,{keyPath:FamilyTree.idb.keyPath})}}else e&&e(!0)}},FamilyTree.idb.read=function(e,t){FamilyTree.idb._open((function(i){if(i){var r=FamilyTree.idb.db.transaction([FamilyTree.idb.tableName]).objectStore(FamilyTree.idb.tableName).get(e);r.onerror=function(e){console.error("Unable to retrieve data from database!"),t&&t(!1)},r.onsuccess=function(e){r.result?t&&t(!0,r.result):t&&t(null)}}else t&&t(!1)}))},FamilyTree.idb.write=function(e,t){FamilyTree.idb.read(e.id,(function(i){if(null==i){var r=FamilyTree.idb.db.transaction([FamilyTree.idb.tableName],"readwrite").objectStore(FamilyTree.idb.tableName).add(e);r.onerror=function(e){console.error("Unable to add data to database!"),t&&t(!1)},r.onsuccess=function(e){t&&t(!0)}}else t&&t(i)}))},FamilyTree.idb.put=function(e,t){FamilyTree.idb._open((function(i){if(i){var r=FamilyTree.idb.db.transaction([FamilyTree.idb.tableName],"readwrite").objectStore(FamilyTree.idb.tableName).put(e);r.onerror=function(e){console.error("Unable to put data to database!"),t&&t(!1)},r.onsuccess=function(e){t&&t(!0)}}else t&&t(!1)}))},FamilyTree.idb.delete=function(e,t){FamilyTree.idb._open((function(i){if(i){var r=FamilyTree.idb.db.transaction([FamilyTree.idb.tableName],"readwrite").objectStore(FamilyTree.idb.tableName).delete(e);r.onerror=function(e){console.error("Unable to retrieve data from database!"),t&&t(!1)},r.onsuccess=function(e){r.error?t&&t(!1):t&&t(!0)}}else t&&t(!1)}))},void 0===FamilyTree&&(FamilyTree={}),void 0===FamilyTree.remote&&(FamilyTree.remote={}),FamilyTree.LIMIT_NODES=!0,FamilyTree.remote._fromResDTO=function(e,t,i,r,a){var n=t[e.id];e.x=n.p[0],e.y=n.p[1],e.w=n.p[2],e.h=n.p[3],null!=n.ln&&(e.leftNeighbor=a[n.ln]),null!=n.rn&&(e.rightNeighbor=a[n.rn]);for(var o=0;o<e.stChildren.length;o++)FamilyTree.remote._fromResDTO(e.stChildren[o],t,i,r,a);for(o=0;o<e.children.length;o++)FamilyTree.remote._fromResDTO(e.children[o],t,i,r,a)},FamilyTree.remote._toReqDTO=function(e,t){var i={p:[e.id,null!=e.parent?e.parent.id:null,null!=e.stParent?e.stParent.id:null,e.w,e.h]};e.children.length>0&&(i.c=FamilyTree.remote._convertToIdArray(e.children)),e.stChildren.length>0&&(i.v=FamilyTree.remote._convertToIdArray(e.stChildren)),null!=e.layout&&0!=e.layout&&(i.l=e.layout),e.isAssistant&&(i.a=1),e.isSplit&&(i.s=e.isSplit),e.padding&&(i.q=e.padding),e.lcn&&(i.k=e.lcn),e.stContainerNodes&&(i.b=FamilyTree.remote._convertToIdArray(e.stContainerNodes)),e._m&&(i.m=e._m.id),e.isPartner&&(i.i=e.isPartner),e.hasPartners&&(i.g=e.hasPartners),e.partnerSeparation&&(i.e=e.partnerSeparation),t.push(i);for(var r=0;r<e.stChildren.length;r++)FamilyTree.remote._toReqDTO(e.stChildren[r],t);for(r=0;r<e.children.length;r++)FamilyTree.remote._toReqDTO(e.children[r],t)},FamilyTree.remote._toReqLayoutConfigsDTO=function(e){var t={};for(var i in e){var r=e[i];t[i]||(t[i]=[]),t[i][0]=r.orientation,t[i][1]=r.levelSeparation,t[i][2]=r.mixedHierarchyNodesSeparation,t[i][3]=r.subtreeSeparation,t[i][4]=r.siblingSeparation,t[i][5]=r.layout,t[i][6]=r.columns,t[i][7]=r.collapse,t[i][8]=r.assistantSeparation,t[i][9]=r.partnerNodeSeparation}return t},FamilyTree.remote._convertToIdArray=function(e){for(var t=[],i=0;i<e.length;i++)t.push(e[i].id);return t},FamilyTree.remote._setPositions=function(e,t,i,r){for(var a=[],n=[],o=FamilyTree.remote._toReqLayoutConfigsDTO(t),l=0;l<e.length;l++)n.push(e[l].id),FamilyTree.remote._toReqDTO(e[l],a);var s={n:a,c:o,r:n,v:"7.13.15"};if(FamilyTree.LIMIT_NODES||(s.l=!0),null!=FamilyTree.remote._fromReqDTO)FamilyTree.remote._fromReqDTO(s.n,s.r,s.c,(function(t){for(var a=0;a<e.length;a++)FamilyTree.remote._fromResDTO(e[a],t,0,e,r);i()}));else{s=JSON.stringify(s);var d=FamilyTree.localStorage.getItem(s);d?FamilyTree.remote._proceed(e,JSON.parse(d),r,i):FamilyTree.remote._findRegion((function(t){FamilyTree._ajax(t,"post",s,"json",(function(t){t.error?i(2):(FamilyTree.remote._proceed(e,t,r,i),FamilyTree.localStorage.setItem(s,JSON.stringify(t)))}))}))}},FamilyTree.remote._proceed=function(e,t,i,r){if("string"==typeof t&&(t=JSON.parse(t)),t.limit&&1==t.limit)r(t.limit);else{for(var a=0;a<e.length;a++)FamilyTree.remote._fromResDTO(e[a],t,0,e,i);r()}},FamilyTree.remote._findRegion=function(e){var t=FamilyTree.localStorage.getItem("funcUrl");if(t)e(t);else{for(var i=["au-e","au-se","brs","ca","ca-e","easia","eus-2","eus","fr","ind","jp-e","jp-w","kr","n-eu","se-asia","s-ind","uk-s","uk-w","us","us-n-c","us-s-c","w-c-us","w-eu","w-ind","w-us-2","wus"],r=[],a=0;a<i.length;a++)r.push(new XMLHttpRequest);for(a=0;a<i.length;a++)!function(){var t="https://"+i[a]+"-balkangraph.azurewebsites.net/api/OrgChartJS",n=r[a];n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){FamilyTree.localStorage.setItem("funcUrl",t),e(t);for(var i=0;i<r.length;i++)r[i].abort()}},n.open("GET",t,!0),n.send()}()}},FamilyTree.prototype._mouseDownHandler=function(e,t,i){var r=this;this.editUI.hide(),this.searchUI.hide(),this.nodeMenuUI.hide(),this.nodeContextMenuUI.hide(),this.menuUI.hide(),this.nodeCircleMenuUI.hide();var a=this.getViewBox(),n=this.getScale(),o=FamilyTree._getClientTouchesXY(t,0),l=FamilyTree._getClientTouchesXY(t,1),s={diffX:0,diffY:0,x0:o.x,y0:o.y,type:"pan",viewBoxLeft:a[0],viewBoxTop:a[1]};t.touches&&t.touches.length>1&&(s.type="pinch",s.dist=Math.sqrt((o.x-l.x)*(o.x-l.x)+(o.y-l.y)*(o.y-l.y)));var d=this.getPointerElement();if("pan"==s.type){this._hideBeforeAnimation();var c=FamilyTree._getOffsetXY(this.element,t),m=c.x/n+a[0]-16/n,p=c.y/n+a[1]-16/n;d.style.display="inherit",d.setAttribute("transform","matrix(0,0,0,0,"+m+","+p+")"),FamilyTree.anim(d,{transform:[0,0,0,0,m,p],opacity:0},{transform:[1/n,0,0,1/n,m,p],opacity:1},300,FamilyTree.anim.outBack)}var h=function(e){var t=FamilyTree._getClientTouchesXY(e,0);if(s&&"pan"==s.type){r._hideBeforeAnimation(),s.diffX=t.x-s.x0,s.diffY=t.y-s.y0;var i=-s.diffY/n+s.viewBoxTop,o=-s.diffX/n+s.viewBoxLeft;r._move(i,o,a)}else if(s&&"pinch"==s.type){var l=FamilyTree._getClientTouchesXY(e,1),d=Math.sqrt((t.x-l.x)*(t.x-l.x)+(t.y-l.y)*(t.y-l.y)),c=1+(d-s.dist)/(s.dist/100)/100;s.dist=d;var m=FamilyTree._pinchMiddlePointInPercent(r.element,r.width(),r.height(),e);r.zoom(c,m)}},u=function(){"pan"==s.type&&r.config.sticky?setTimeout((function(){FamilyTree._moveToBoundaryArea(e,r.getViewBox(),r.response.boundary,(function(){r._draw(!0,FamilyTree.action.pan)}))}),0):"pan"!=s.type||r.config.sticky||r._draw(!0,FamilyTree.action.pan),s=null,d.style.display="none",e.removeEventListener(i.move,h),e.removeEventListener(i.up,u),i.leave&&e.removeEventListener(i.leave,u),i.touchstart&&e.removeEventListener(i.touchstart,u)};e.addEventListener(i.move,h),e.addEventListener(i.up,u),i.leave&&e.addEventListener(i.leave,u),i.touchstart&&e.addEventListener(i.touchstart,u)},void 0===FamilyTree&&(FamilyTree={}),FamilyTree.node=function(e,t,i,r){this.templateName=r,this.id=e,this.pid=t,this.children=[],this.childrenIds=[],this.parent=null,this.stpid=null,this.stParent=null,this.stChildren=[],this.stChildrenIds=[],this.tags=i,this.tags||(this.tags=[])},FamilyTree.prototype._move=function(e,t,i){i[0]=t,i[1]=e,this.setViewBox(i),this.xScrollUI.setPosition(),this.yScrollUI.setPosition()},FamilyTree.prototype.startMove=function(e,t){if(e){if(this._movePosition=e,!this._moveInterval){var i=this,r=this.getViewBox().slice(0),a=this.getScale(),n=0,o=0;this._moveInterval=setInterval((function(){var e={x:0,y:0,xWithoutScale:0,yWithoutScale:0};i._movePosition.left&&(n++,e.x=n*FamilyTree.MOVE_STEP/a,e.xWithoutScale=n*FamilyTree.MOVE_STEP),i._movePosition.right&&(n++,e.x=-n*FamilyTree.MOVE_STEP/a,e.xWithoutScale=-n*FamilyTree.MOVE_STEP),i._movePosition.up&&(o++,e.y=-o*FamilyTree.MOVE_STEP/a,e.yWithoutScale=-o*FamilyTree.MOVE_STEP),i._movePosition.down&&(o++,e.y=o*FamilyTree.MOVE_STEP/a,e.yWithoutScale=o*FamilyTree.MOVE_STEP),i.setViewBox([r[0]+e.x,r[1]+e.y,r[2],r[3]]),i.xScrollUI.setPosition(),i.yScrollUI.setPosition(),t&&t(e)}),FamilyTree.MOVE_INTERVAL)}}else console.error("movePosition parameter not defined")},FamilyTree.prototype.stopMove=function(){this._moveInterval&&(clearInterval(this._moveInterval),this._moveInterval=null,this._movePosition=null)},FamilyTree.prototype._globalMouseDownHandler=function(e,t){var i={move:"mousemove",up:"mouseup",leave:"mouseleave"};if(-1!=t.type.indexOf("touch")&&(1==t.touches.length?this._touch={x:t.touches[0].clientX,y:t.touches[0].clientY}:this._touch=null,i={move:"touchmove",up:"touchend",touchstart:"touchstart"}),e==t.target)return t.stopPropagation(),t.preventDefault(),void this._mouseDownHandler(e,t,i);if(this.config.nodeMouseClick==FamilyTree.action.pan){for(var r=t.target;r!=e&&!r.hasAttribute(FamilyTree.attr.control_expcoll_id)&&!r.hasAttribute(FamilyTree.attr.control_up_id);)r=r.parentNode;if(!r.hasAttribute(FamilyTree.attr.control_expcoll_id)&&!r.hasAttribute(FamilyTree.attr.control_up_id))return t.stopPropagation(),t.preventDefault(),void this._mouseDownHandler(e,t,i)}for(var a=t.target;a!=e;){if(a.hasAttribute(FamilyTree.attr.node_id))return void this._nodeMouseDownHandler(a,t,i);if(a.hasAttribute(FamilyTree.attr.control_node_circle_menu_name))return t.stopPropagation(),t.preventDefault(),void this._nodeCircleNodeMenuItemMouseDownHandler(a,t,i);a=a.parentNode}},FamilyTree.prototype._globalClickHandler=function(e,t){if(-1!=t.type.indexOf("touch")&&this._touch&&1==t.changedTouches.length){if(t.changedTouches.length){var i={x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY},r=FamilyTree.t(this.config.template,!1,this.getScale()).size,a=this.getScale(),n=Math.abs(i.x-this._touch.x)/a,o=Math.abs(i.y-this._touch.y)/a;if(this._touch=null,n>r[0]/10)return;if(o>r[1]/10)return}}else if(-1!=t.type.indexOf("touch")&&null==this._touch)return;for(var l=t.target;l!=e;){if(l.hasAttribute(FamilyTree.attr.control_expcoll_id)){var s=l.getAttribute(FamilyTree.attr.control_expcoll_id),d=this.getNode(s);return void this._expCollHandler(d.id)}if(l.hasAttribute(FamilyTree.attr.node_id)){s=l.getAttribute(FamilyTree.attr.node_id),d=this.getNode(s);return void this._nodeClickHandler(d.id,t)}if(l.hasAttribute(FamilyTree.attr.control_node_menu_id)){t.stopPropagation(),t.preventDefault();s=l.getAttribute(FamilyTree.attr.control_node_menu_id),d=this.getNode(s);return void this._nodeMenuClickHandler(d.id,l,t)}if(l.hasAttribute(FamilyTree.attr.control_node_circle_menu_id)){t.stopPropagation(),t.preventDefault();s=l.getAttribute(FamilyTree.attr.control_node_circle_menu_id);return void this._nodeCircleMenuClickHandler(s)}if(l.hasAttribute(FamilyTree.attr.control_node_circle_menu_name))return t.stopPropagation(),t.preventDefault(),void this._nodeCircleMenuItemClickHandler(l,t);if(l.hasAttribute(FamilyTree.attr.control_add))return void this._lonelyButtonHandler();if(l.hasAttribute(FamilyTree.attr.control_up_id)){s=l.getAttribute(FamilyTree.attr.control_up_id);return t.stopPropagation(),t.preventDefault(),void this._upHandler(s)}if(l.hasAttribute(FamilyTree.attr.c_link_from))return void FamilyTree.events.publish("clink-click",[this,{from:l.getAttribute(FamilyTree.attr.c_link_from),to:l.getAttribute(FamilyTree.attr.c_link_to),event:t}]);if(l.hasAttribute(FamilyTree.attr.s_link_from))return void FamilyTree.events.publish("slink-click",[this,{from:l.getAttribute(FamilyTree.attr.s_link_from),to:l.getAttribute(FamilyTree.attr.s_link_to),event:t}]);l=l.parentNode}},FamilyTree.prototype._globalContextHandler=function(e,t){for(var i=t.target;i!=e;){if(i.hasAttribute(FamilyTree.attr.node_id)){var r=i.getAttribute(FamilyTree.attr.node_id),a=this.getNode(r);return void this._nodeContextHandler(a.id,t)}i=i.parentNode}},FamilyTree.prototype._nodeContextHandler=function(e,t){t.preventDefault(),this.searchUI.hide(),this.nodeMenuUI.hide(),this.nodeContextMenuUI.hide(),this.menuUI.hide(),this.nodeCircleMenuUI.hide();var i=this.get(e),r=null;if(null!=i&&Array.isArray(i.tags))for(var a=0;a<i.tags.length;a++){var n=i.tags[a];this.config.tags[n]&&this.config.tags[n].nodeContextMenu&&(r=this.config.tags[n].nodeContextMenu)}this.nodeContextMenuUI.show(t.pageX,t.pageY,e,null,r)},FamilyTree.prototype._globalDbClickHandler=function(e,t){for(var i=t.target;i!=e;){if(i.hasAttribute(FamilyTree.attr.node_id)){var r=i.getAttribute(FamilyTree.attr.node_id),a=this.getNode(r);return void this._nodeDbClickHandler(a.id,t)}i=i.parentNode}},FamilyTree.prototype._mouseScrollHandler=function(e,t){if(this.config.mouseScrool!=FamilyTree.action.ctrlZoom||t.ctrlKey){var i=this,r=!1,a=this.config.zoom.speed,n=this.config.zoom.smooth,o=0,l=this.getScale(),s=FamilyTree._centerPointInPercent(i.getSvg(),t.pageX,t.pageY),d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,20)};t.preventDefault();var c=t.delta||t.wheelDelta;void 0===c&&(c=-t.detail),c=Math.max(-1,Math.min(1,c)),o+=-c*a,r||function e(){r=!0;var t=(o-l)/n;t>0?t++:t--,l+=t,i.zoom(1-t/12/50,s),parseInt(l)==parseInt(o)?r=!1:d(e)}()}},FamilyTree.prototype._nodeCircleNodeMenuItemMouseDownHandler=function(e,t,i){var r=e.parentNode.getAttribute(FamilyTree.attr.control_node_circle_menu_wrraper_id),a=e.getAttribute(FamilyTree.attr.control_node_circle_menu_name),n=this.nodeCircleMenuUI._menu[a];if(n.draggable){var o=this,l=FamilyTree._getClientXY(t),s=this.getNode(r);e._dragEventFired=!1;var d=o.getScale(),c=null,m=null;this._gragStartedId=r,document.body.style.mozUserSelect=document.body.style.webkitUserSelect=document.body.style.userSelect="none";var p=this.getSvg(),h={x:l.x,y:l.y},u=e.cloneNode(!0);p.insertBefore(u,p.firstChild);var y=FamilyTree._getTransform(u),f=y[4],g=y[5],b=function(e){for(;e&&!e.hasAttribute(FamilyTree.attr.control_node_circle_menu_wrraper_id);)e=e.parentNode;if(e){var t=FamilyTree._getTransform(e);return{x:t[4],y:t[5]}}console.error("cannot find parent"+FamilyTree.attr.control_node_circle_menu_wrraper_id)}(e);u.setAttribute("transform","matrix(1,0,0,1,"+(f+b.x)+","+(g+b.y)+")"),u.style.opacity=.7;var T=function(e,t){if(null!=e){t.classList.remove("drag-over");for(var i=FamilyTree.getStParentNodes(o.getNode(c)),r=0;r<i.length;r++){var a=o.getNodeElement(i[r].id);a&&(a.style.opacity=1)}}},v=function(t){if(h){var i=FamilyTree._getClientXY(t),r=t.target;i.x+=b.x*d,i.y+=b.y*d;var l=FamilyTree._getOffsetXY(o.element,t),s={left:o.width()-(l.x+o.config.padding)<0,right:l.x-o.config.padding<0,down:o.height()-(l.y+o.config.padding)<0,up:l.y-o.config.padding<0};if(s.left||s.right||s.up||s.down){p.classList&&(p.classList.remove("cursor-grab"),p.classList.add("cursor-move"),p.classList.remove("cursor-nodrop"),p.classList.remove("cursor-copy"));var v=y[4],x=y[5],_=h.x,w=h.y,k=i.x,S=i.y;o.startMove(s,(function(e){y[4]=v+e.x,y[5]=x+e.y,h.x=_-e.xWithoutScale,h.y=w-e.yWithoutScale,i.x=k-e.xWithoutScale,i.y=S-e.yWithoutScale,u.setAttribute("transform","matrix("+y.toString()+")")}))}else{for(o.stopMove(),p.classList&&(p.classList.add("cursor-grab"),p.classList.remove("cursor-move"),p.classList.remove("cursor-nodrop"),p.classList.remove("cursor-copy")),T(c,m),c=null,m=null;null!=r&&r!=p;){if(r.hasAttribute&&r.hasAttribute(FamilyTree.attr.node_id)){var I=r.getAttribute(FamilyTree.attr.node_id);c=I,m=r;break}r=r.parentNode}if(null!=c){m.classList.add("drag-over");for(var C=o.getNode(c),A=FamilyTree.getStParentNodes(C),N=0;N<A.length;N++){var L=o.getNodeElement(A[N].id);L&&(L.style.opacity=.1)}p.classList.remove("cursor-grab"),p.classList.remove("cursor-move"),p.classList.add("cursor-copy"),p.classList.remove("cursor-nodrop")}var M=(i.x-h.x)/d,E=(i.y-h.y)/d;if(y[4]=f+M,y[5]=g+E,!e._dragEventFired&&(Math.abs(i.x-h.x)>FamilyTree.FIRE_DRAG_NOT_CLICK_IF_MOVE||Math.abs(i.y-h.y)>FamilyTree.FIRE_DRAG_NOT_CLICK_IF_MOVE))!1===FamilyTree.events.publish("drag",[o.nodeCircleMenuUI,{from:I,menuItem:n,menuItemName:a}])&&F(),e._dragEventFired=!0;u.setAttribute("transform","matrix("+y.toString()+")")}}},F=function(t){if(o.stopMove(),p.classList&&(p.classList.remove("cursor-grab"),p.classList.remove("cursor-move"),p.classList.remove("cursor-nodrop"),p.classList.remove("cursor-copy")),p.removeEventListener(i.move,v),p.removeEventListener(i.up,F),i.leave&&p.removeEventListener(i.leave,F),s.id==c||null==c)return p.removeChild(u),o._gragStartedId=null,void(e._dragEventFired&&FamilyTree.events.publish("drop",[o.nodeCircleMenuUI,{from:s.id,menuItemName:a,menuItem:n}]));var r=o.getNode(c);FamilyTree.events.publish("drop",[o.nodeCircleMenuUI,{from:s.id,to:r.id,menuItem:n,menuItemName:a}]),T(c,m),p.removeChild(u),o._gragStartedId=null};p.addEventListener(i.move,v),p.addEventListener(i.up,F),i.leave&&p.addEventListener(i.leave,F)}},FamilyTree.prototype._nodeMouseDownHandler=function(e,t,i){if(this.config.enableDragDrop){var r=FamilyTree._getClientXY(t),a=e.getAttribute(FamilyTree.attr.node_id),n=this.getNode(a);e._dragEventFired=!1;var o=null,l=null;this._gragStartedId=a,document.body.style.mozUserSelect=document.body.style.webkitUserSelect=document.body.style.userSelect="none";var s=this,d=this.getSvg(),c={x:r.x,y:r.y},m=FamilyTree._getTransform(e),p=m[4],h=m[5],u=s.getScale(),y=e.cloneNode(!0);d.insertBefore(y,d.firstChild),y.style.opacity=.7;var f=function(e,t){if(null!=e){t.classList.remove("drag-over");for(var i=s.getNode(o),r=FamilyTree.getStParentNodes(i),a=0;a<r.length;a++){var n=s.getNodeElement(r[a].id);n&&(n.style.opacity=1)}}},g=function(t){if(c){var i=FamilyTree._getClientXY(t),r=t.target,a=FamilyTree._getOffsetXY(s.element,t),g={left:s.width()-(a.x+s.config.padding)<0,right:a.x-s.config.padding<0,down:s.height()-(a.y+s.config.padding)<0,up:a.y-s.config.padding<0};if(g.left||g.right||g.up||g.down){d.classList&&(d.classList.remove("cursor-grab"),d.classList.add("cursor-move"),d.classList.remove("cursor-nodrop"),d.classList.remove("cursor-copy"));var T=m[4],v=m[5],F=c.x,x=c.y,_=i.x,w=i.y;s.startMove(g,(function(e){m[4]=T+e.x,m[5]=v+e.y,c.x=F-e.xWithoutScale,c.y=x-e.yWithoutScale,i.x=_-e.xWithoutScale,i.y=w-e.yWithoutScale,y.setAttribute("transform","matrix("+m.toString()+")")}))}else{if(s.stopMove(),d.classList&&(d.classList.add("cursor-grab"),d.classList.remove("cursor-move"),d.classList.remove("cursor-nodrop"),d.classList.remove("cursor-copy")),f(o,l),o=null,l=null,s.config.enableDragDrop)for(;null!=r&&r!=d;){if(r.hasAttribute&&r.hasAttribute(FamilyTree.attr.node_id)){var k=r.getAttribute(FamilyTree.attr.node_id);if(s._gragStartedId&&k!=s._gragStartedId){o=k,l=r;break}}r=r.parentNode}if(null!=o){l.classList.add("drag-over");for(var S=s.getNode(o),I=FamilyTree.getStParentNodes(S),C=0;C<I.length;C++){var A=s.getNodeElement(I[C].id);A&&(A.style.opacity=.1)}!s._canUpdateLink(n.id,o)&&d.classList?(d.classList.remove("cursor-grab"),d.classList.remove("cursor-move"),d.classList.remove("cursor-copy"),d.classList.add("cursor-nodrop")):d.classList&&(d.classList.remove("cursor-grab"),d.classList.remove("cursor-move"),d.classList.add("cursor-copy"),d.classList.remove("cursor-nodrop"))}var N=(i.x-c.x)/u,L=(i.y-c.y)/u;if(m[4]=p+N,m[5]=h+L,!e._dragEventFired&&(Math.abs(i.x-c.x)>FamilyTree.FIRE_DRAG_NOT_CLICK_IF_MOVE||Math.abs(i.y-c.y)>FamilyTree.FIRE_DRAG_NOT_CLICK_IF_MOVE))!1===FamilyTree.events.publish("drag",[s,k])&&b(),e._dragEventFired=!0;y.setAttribute("transform","matrix("+m.toString()+")")}}},b=function(t){if(s.stopMove(),d.classList&&(d.classList.remove("cursor-grab"),d.classList.remove("cursor-move"),d.classList.remove("cursor-nodrop"),d.classList.remove("cursor-copy")),d.removeEventListener(i.move,g),d.removeEventListener(i.up,b),i.leave&&d.removeEventListener(i.leave,b),n.id!=o&&null!=o){var r=s.getNode(o);if(!1===FamilyTree.events.publish("drop",[s,n.id,r.id]))return f(o,l),d.removeChild(y),void(s._gragStartedId=null);if(s._canUpdateLink(n.id,o)){var a=s.get(n.id);a.pid=o,a.stpid=null,s.updateNode(a,null,!0)}else d.removeChild(y),f(o,l);s._gragStartedId=null}else{d.removeChild(y),s._gragStartedId=null;FamilyTree._getClientXY(t);e._dragEventFired&&FamilyTree.events.publish("drop",[s,n.id])}};d.addEventListener(i.move,g),d.addEventListener(i.up,b),i.leave&&d.addEventListener(i.leave,b)}},FamilyTree.prototype._resizeHandler=function(e,t){var i=this.getViewBox(),r=this.getSvg(),a=r.getAttribute("width"),n=r.getAttribute("height"),o=a/i[2],l=n/i[3],s=o>l?l:o;r.setAttribute("width",this.width()),r.setAttribute("height",this.height()),i[2]=this.width()/s,i[3]=this.height()/s,this.setViewBox(i),this.xScrollUI.create(this.width()),this.yScrollUI.create(this.height()),this._draw(!1,FamilyTree.action.resize)},FamilyTree.prototype._nodeDbClickHandler=function(e,t){if(!1===FamilyTree.events.publish("dbclick",[this,this.get(e)]))return!1;this._commonClickHandler(e,t,this.config.nodeMouseDbClick)},FamilyTree.prototype._nodeClickHandler=function(e,t){var i=this.getNodeElement(e);if(i&&i._dragEventFired)i._dragEventFired=!1;else{if(!1===FamilyTree.events.publish("click",[this,{node:this.getNode(e),event:t}]))return!1;this._commonClickHandler(e,t,this.config.nodeMouseClick)}},FamilyTree.prototype._nodeCircleMenuItemClickHandler=function(e,t){var i=e.parentNode.getAttribute(FamilyTree.attr.control_node_circle_menu_wrraper_id),r=e.getAttribute(FamilyTree.attr.control_node_circle_menu_name),a=this.nodeCircleMenuUI._menu[r];FamilyTree.events.publish("click",[this.nodeCircleMenuUI,{nodeId:i,menuItemName:r,menuItem:a,event:t}])},FamilyTree.prototype._nodeCircleMenuClickHandler=function(e){this.searchUI.hide(),this.nodeMenuUI.hide(),this.nodeContextMenuUI.hide(),this.menuUI.hide();var t=this.getNode(e),i=null;if(Array.isArray(t.tags))for(var r=0;r<t.tags.length;r++){var a=t.tags[r];this.config.tags[a]&&this.config.tags[a].nodeCircleMenu&&(i=this.config.tags[a].nodeCircleMenu)}this.nodeCircleMenuUI.show(e,i)},FamilyTree.prototype._commonClickHandler=function(e,t,i){if(this.searchUI.hide(),this.nodeMenuUI.hide(),this.nodeContextMenuUI.hide(),this.menuUI.hide(),this.nodeCircleMenuUI.hide(),i==FamilyTree.action.expandCollapse&&this.toggleExpandCollapse(e,t),i==FamilyTree.action.edit){var r=this.getNode(e);this.editUI.show(r.id),this.ripple(r.id,t.clientX,t.clientY)}if(i==FamilyTree.action.details){r=this.getNode(e);this.editUI.show(r.id,!0),this.ripple(r.id,t.clientX,t.clientY)}},FamilyTree.prototype._menuHandlerMouseDownHandler=function(e,t){t.stopPropagation(),t.preventDefault()},FamilyTree.prototype._nodeMenuClickHandler=function(e,t,i){this.searchUI.hide(),this.nodeMenuUI.hide(),this.nodeContextMenuUI.hide(),this.menuUI.hide(),this.nodeCircleMenuUI.hide();var r=this.getNode(e),a=null;if(Array.isArray(r.tags))for(var n=0;n<r.tags.length;n++){var o=r.tags[n];this.config.tags[o]&&this.config.tags[o].nodeMenu&&(a=this.config.tags[o].nodeMenu)}this.nodeMenuUI.showStickIn(t,e,null,a)},FamilyTree.prototype._menuClickHandler=function(e,t){t.stopPropagation(),t.preventDefault(),this.nodeMenuUI.hide(),this.nodeContextMenuUI.hide(),this.menuUI.show(e.offsetLeft,e.offsetTop)},FamilyTree.prototype._lonelyButtonHandler=function(){var e={id:this.generateId()};!1!==this.addNode(e,null,!0)&&this.center(e.id)},FamilyTree.prototype.toggleExpandCollapse=function(e,t){var i=this.getNode(e),r=this.getCollapsedIds(i);if(r.length){if(!1===FamilyTree.events.publish("expcollclick",[this,!1,e,r]))return!1;this.expand(e,r,!1)}else{if(!1===FamilyTree.events.publish("expcollclick",[this,!0,e,i.childrenIds]))return!1;this.collapse(e,i.childrenIds,!1)}t&&this.ripple(i.id,t.clientX,t.clientY)},String.prototype.replaceAll||(String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)}),String.prototype.splice=function(e,t,i){return this.slice(0,e)+i+this.slice(e+Math.abs(t))},String.prototype.insert=function(e,t){return e>0?this.substring(0,e)+t+this.substr(e):t+this},Array.prototype.unique||(Array.prototype.unique=function(){for(var e=this.concat(),t=0;t<e.length;++t)for(var i=t+1;i<e.length;++i)e[t]===e[i]&&e.splice(i--,1);return e}),Object.defineProperty(Array.prototype,"has",{value:function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return!0;return!1},writable:!0,configurable:!0,enumerable:!1}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),r=1;r<arguments.length;r++){var a=arguments[r];if(null!=a)for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(i[n]=a[n])}return i},writable:!0,configurable:!0}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),void 0===FamilyTree&&(FamilyTree={}),FamilyTree.events=function(){var e={};return{on:function(t,i,r){Array.isArray(e[t])||(e[t]=[]),e[t].push({listener:i,event_id:r})},removeAll:function(t){Array.isArray(e[t])||(e[t]=[]),e[t]=[]},removeForEventId:function(t){for(var i in e)if(Array.isArray(e[i]))for(var r=e[i].length-1;r>=0;r--)e[i][r].event_id==t&&e[i].splice(r,1)},publish:function(t,i){if(e[t]){for(var r=[],a=0;a<e[t].length;a++){var n=e[t][a];null!=n.event_id&&n.event_id!=i[0]._event_id||r.push(n.listener)}if(r.length>0){var o=!0;for(a=0;a<r.length;a++)1==i.length?o=r[a](i[0])&&o:2==i.length?o=r[a](i[0],i[1])&&o:3==i.length?o=r[a](i[0],i[1],i[2])&&o:4==i.length?o=r[a](i[0],i[1],i[2],i[3])&&o:5==i.length&&(o=r[a](i[0],i[1],i[2],i[3],i[4])&&o);return o}}}}}(),FamilyTree.prototype.importCSV=function(){var e=this,t=document.createElement("INPUT");t.setAttribute("type","file"),t.setAttribute("accept",".csv"),t.style.display="none",t.onchange=function(t){var i=t.target,r=new FileReader;r.onload=function(){var t=r.result,i=FamilyTree._csvToArray(t,","),a=[],n=i[0];FamilyTree._importSetColumnNames(n,(function(t){for(var r=1;r<i.length;r++){for(var n={},o=0;o<i[r].length;o++){var l=t[o],s=i[r][o];if("tags"==l&&""!=s)s=s.split(",");else if("tags"==l&&""==s)continue;n[l]=s}""!=n.id.trim()&&a.push(n)}var d={nodes:a,columnNames:i[0]};0!=FamilyTree.events.publish("import",[e,d])&&(e.config.nodes=d.nodes,e.draw())}))},r.readAsText(i.files[0])},t.click()},FamilyTree._importSetColumnNames=function(e,t){if(-1==e.indexOf("id")||-1==e.indexOf("pid")){var i=document.createElement("DIV"),r=document.createElement("P");r.style.padding="5px",r.style.color="rgb(122, 122, 122)",r.innerHTML=FamilyTree.IMPORT_MESSAGE,i.appendChild(r);var a=document.createElement("div"),n=document.createElement("div"),o=document.createElement("div"),l=document.createElement("span");a.setAttribute("id","sampleDialog"),a.style.height="260px",a.style.width="400px",a.style.background="white",a.style.border="0.5px solid grey",a.style.position="fixed",a.style.overflow="hidden",a.style.zIndex="99",n.setAttribute("id","title"),n.style.backgroundColor="#e5e5e5",n.style.fontWeight="bold",n.style.color="rgb(122, 122, 122)",n.style.height="20px",n.style.padding="3px 0 0 7px",l.setAttribute("id","close"),l.style.cursor="pointer",l.style.position="absolute",l.style.color="rgb(122, 122, 122)",l.style.fontWeight="bold",l.style.top="2px",l.style.zIndex=100,o.setAttribute("id","content"),o.style.padding="2px",n.innerHTML="Import Organizational Chart Data",l.innerHTML="&times;";var s=document.createElement("HR");s.style.height="0.1px",s.style.backgroundColor="#aeaeae",s.style.border="none",s.style.margin="0",a.appendChild(n),a.appendChild(s),o.appendChild(i),a.appendChild(o),a.appendChild(l),document.body.appendChild(a),FamilyTree._importCenter(a),l.style.left=a.offsetWidth-20+"px";var d=document.createElement("div");d.setAttribute("id","overlay"),d.style.width="100%",d.style.height="100%",d.style.left=0,d.style.top=0,d.style.position="fixed",d.style.background="grey",d.style.opacity="0.5",d.style.zIndex=98,document.body.appendChild(d),a._overlay=d;var c=document.createElement("LABEL"),m=document.createTextNode("Name:");c.setAttribute("for","id-select"),c.appendChild(m),c.style.fontSize="16px",c.style.color="rgb(122, 122, 122)",c.style.padding="5px",c.style.margin="5px",c.style.width="30%",c.style.textAlign="right",c.style.display="inline-block",i.appendChild(c);var p=document.createElement("SELECT");p.id="id-select",p.style.fontSize="16px",p.style.color="rgb(122, 122, 122)",p.style.padding="5px",p.style.margin="5px",p.style.width="60%",p.style.border="1px solid #aeaeae",i.appendChild(p);var h=document.createElement("BR");i.appendChild(h);for(var u=0;u<e.length;u++){(T=document.createElement("option")).setAttribute("value",e[u]);var y=document.createTextNode(e[u]);T.appendChild(y),p.appendChild(T)}var f=document.createElement("LABEL"),g=document.createTextNode("Reports to:");f.setAttribute("for","pid-select"),f.appendChild(g),f.style.fontSize="16px",f.style.color="rgb(122, 122, 122)",f.style.padding="5px",f.style.margin="5px",f.style.width="30%",f.style.textAlign="right",f.style.display="inline-block",i.appendChild(f);var b=document.createElement("SELECT");b.id="pid-select",b.style.fontSize="16px",b.style.color="rgb(122, 122, 122)",b.style.padding="5px",b.style.margin="5px",b.style.width="60%",b.style.border="1px solid #aeaeae",i.appendChild(b);for(u=0;u<e.length;u++){var T;(T=document.createElement("option")).setAttribute("value",e[u]);y=document.createTextNode(e[u]);T.appendChild(y),b.appendChild(T)}var v=document.createElement("BUTTON");v.innerHTML="Import",v.style.fontSize="16px",v.style.color="rgb(122, 122, 122)",v.style.padding="5px 20px",v.style.margin="20px auto",v.style.display="block",v.onclick=function(){a.style.display="none",a._overlay&&a._overlay.parentNode.removeChild(a._overlay);var i=p.options[p.selectedIndex].value,r=e.indexOf(i);e[r]="id";var n=b.options[b.selectedIndex].value,o=e.indexOf(n);e[o]="pid",t(e)};var F=document.createElement("DIV");return F.appendChild(v),i.appendChild(F),l.onclick=function(e){a._overlay&&a._overlay.parentNode.removeChild(a._overlay),a.parentNode.removeChild(a),e.stopPropagation()},n.onmousedown=function(e){e=e||window.event,a._dragging=!0,a._originalLeft=a.offsetLeft,a._originalTop=a.offsetTop,a._mouseLeft=e.clientX,a._mouseTop=e.clientY},document.onmousemove=function(e){e=e||window.event,a._dragging&&(a.style.left=a._originalLeft+e.clientX-a._mouseLeft+"px",a.style.top=a._originalTop+e.clientY-a._mouseTop+"px")},document.onmouseup=function(e){e=e||window.event,a._dragging&&(a.style.left=a._originalLeft+e.clientX-a._mouseLeft+"px",a.style.top=a._originalTop+e.clientY-a._mouseTop+"px",a._dragging=!1)},a}t(e)},FamilyTree._importCenter=function(e){e&&(e.style.left=(window.innerWidth-e.offsetWidth)/2+"px",e.style.top=(window.innerHeight-e.offsetHeight)/2+"px")},FamilyTree.prototype.importXML=function(){var e=this,t=document.createElement("INPUT");t.setAttribute("type","file"),t.setAttribute("accept",".xml"),t.style.display="none",t.onchange=function(t){var i=t.target,r=new FileReader;r.onload=function(){var t=r.result,i=FamilyTree._xml2json(t);0!=FamilyTree.events.publish("import",[e,i])&&(e.config.nodes=i,e.draw())},r.readAsText(i.files[0])},t.click()},FamilyTree.prototype.exportPDFProfile=function(e,t){e=this._defaultExportProfileOptions(e,"pdf"),this._exportProfile(e,t)},FamilyTree.prototype.exportPNGProfile=function(e,t){e=this._defaultExportProfileOptions(e,"png"),this._exportProfile(e,t)},FamilyTree.prototype.shareProfile=function(e){var t;"object"==typeof e?e=(t=e).focusId:t=this.editUI.content(e,!0,!0,"100%",!0);var i=new URL(window.location.href);i.searchParams.append("nodeId",e);var r={title:t.title,text:t.shareText,url:i.href};try{navigator.share(r)}catch(e){console.error("error: "+e)}},FamilyTree.prototype.exportPDF=function(e,t){e=this._defaultExportOptions(e,"pdf"),this._export(e,t)},FamilyTree.prototype.exportPNG=function(e,t){e=this._defaultExportOptions(e,"png"),this._export(e,t)},FamilyTree.prototype.exportSVG=function(e,t){e=this._defaultExportOptions(e,"svg"),this._export(e,t)},FamilyTree.prototype._defaultExportOptions=function(e,t){return null==e&&(e={}),"svg"==t?(e.ext="svg",e.mime="image/svg+xml"):"pdf"==t?(e.mime="application/pdf",e.ext="pdf"):"png"==t&&(e.mime="image/png",e.ext="png"),null==e.margin&&(e.margin=[50,40,50,40]),null==e.padding&&(e.padding=0),null==e.landscape&&(e.landscape=!1),null==e.filename&&(e.filename="FamilyTree."+e.ext),null==e.scale&&(e.scale="fit"),null==e.format&&(e.format="fit"),null==e.header&&(e.header=""),null==e.footer&&(e.footer="Page {current-page} of {total-pages}"),null==e.openInNewTab&&(e.openInNewTab=!1),null==e.mode&&(e.mode=this.config.mode),e},FamilyTree.prototype._export=function(e,t){var i=this,r={id:e.nodeId,expandChildren:e.expandChildren};e.margin&&e.margin[0]<2&&(e.margin[0]=2),e.margin&&e.margin[1]<2&&(e.margin[1]=2),e.margin&&e.margin[2]<2&&(e.margin[2]=2),e.margin&&e.margin[3]<2&&(e.margin[3]=2),this._draw(!1,FamilyTree.action.exporting,r,(function(r){var a=document.createElement("div");if(a.innerHTML=r,e.padding>0){var n=a.querySelector("svg"),o=FamilyTree._getViewBox(n);o[0]-=e.padding,o[1]-=e.padding,o[2]+=2*e.padding,o[3]+=2*e.padding,n.setAttribute("viewBox",o.join()),n.setAttribute("width",o[2]),n.setAttribute("height",o[3])}if("svg"==e.ext)if(t)t(e,a.innerHTML);else{(n=a.querySelector("svg")).classList.add(i.config.mode);var l={content:a.innerHTML,options:e,styles:""},s=FamilyTree.events.publish("exportstart",[i,l]),d=i.element.querySelector("[data-ba-styles]");if(d&&(l.styles+=d.outerHTML),l.styles&&(a.childNodes[0].insertAdjacentHTML("afterbegin",l.styles),l.content=a.innerHTML),!1===s)return!1;if(!1===(s=FamilyTree.events.publish("exportend",[i,l])))return!1;FamilyTree._downloadFile(e.mime,l.content,l.options.filename,l.options.openInNewTab)}else i._pages(e,a.querySelector("svg"),(function(r){var n={content:a.innerHTML,options:e,pages:r,styles:""},o=FamilyTree.events.publish("exportstart",[i,n]),l=i.element.querySelector("[data-ba-styles]");if(l&&(n.styles+=l.outerHTML),!1===o)return!1;t||FamilyTree.loading.show(i),t?t(i,n,a.querySelector("svg")):(n=JSON.stringify(n),FamilyTree._ajax(i.config.exportUrl+"/v3","POST",n,"arraybuffer",(function(t){var r=FamilyTree.events.publish("exportend",[i,t]);if(FamilyTree.loading.hide(i),!1===r)return!1;FamilyTree._downloadFile(e.mime,t,e.filename,e.openInNewTab)})))}))}))},FamilyTree.prototype.exportCSV=function(e){e||(e="FamilyTree.csv");var t={ext:"csv",filename:e,nodes:JSON.parse(JSON.stringify(this.config.nodes))};if(!1===FamilyTree.events.publish("exportstart",[this,t]))return!1;var i=FamilyTree._json2csv(t.nodes),r={ext:t.ext,filename:t.filename,nodes:t.nodes,content:i};if(!1===FamilyTree.events.publish("exportend",[this,r]))return!1;FamilyTree._downloadFile("text/csv;charset=utf-8;","\ufeff"+r.content,r.filename,r.openInNewTab)},FamilyTree.prototype.exportXML=function(e){e||(e="FamilyTree.xml");var t={ext:"xml",filename:e,nodes:JSON.parse(JSON.stringify(this.config.nodes))};if(!1===FamilyTree.events.publish("exportstart",[this,t]))return!1;var i=FamilyTree._json2xml(t.nodes),r={ext:t.ext,filename:t.filename,nodes:t.nodes,content:i};if(!1===FamilyTree.events.publish("exportend",[this,r]))return!1;FamilyTree._downloadFile("application/xml",r.content,r.filename,r.openInNewTab)},FamilyTree.prototype._pages=function(e,t,i){"A5"==e.format&&"fit"!=e.scale||"A4"==e.format&&"fit"!=e.scale||"A3"==e.format&&"fit"!=e.scale||"A2"==e.format&&"fit"!=e.scale||"A1"==e.format&&"fit"!=e.scale||"Letter"==e.format&&"fit"!=e.scale||"Legal"==e.format&&"fit"!=e.scale?i(this._pagesA100(e,t,e.scale)):"A5"==e.format&&"fit"==e.scale||"A4"==e.format&&"fit"==e.scale||"A3"==e.format&&"fit"==e.scale||"A2"==e.format&&"fit"==e.scale||"A1"==e.format&&"fit"==e.scale||"Letter"==e.format&&"fit"==e.scale||"Legal"==e.format&&"fit"==e.scale?i(this._pagesAfit(e,t)):"fit"==e.format&&i(this._pagesFit(e,t))},FamilyTree.prototype._pagesFit=function(e,t){var i=t.getAttribute("width"),r=t.getAttribute("height"),a=FamilyTree._getViewBox(t),n={w:parseFloat(i),h:parseFloat(r)};return[{vb:a,size:{w:n.w+(e.margin[1]+e.margin[3]),h:n.h+(e.margin[0]+e.margin[2])},innerSize:n}]},FamilyTree.prototype._pagesAfit=function(e,t){var i=t.getAttribute("width"),r=0,a=0;switch(e.format){case"A5":r=FamilyTree.A5w,a=FamilyTree.A5h;break;case"A4":r=FamilyTree.A4w,a=FamilyTree.A4h;break;case"A3":r=FamilyTree.A3w,a=FamilyTree.A3h;break;case"A2":r=FamilyTree.A2w,a=FamilyTree.A2h;break;case"A1":r=FamilyTree.A1w,a=FamilyTree.A1h;break;case"Letter":r=FamilyTree.Letterw,a=FamilyTree.Letterh;break;case"Legal":r=FamilyTree.Legalw,a=FamilyTree.Legalh}var n=e.landscape?a-(e.margin[1]+e.margin[3]):r-(e.margin[1]+e.margin[3]),o=(e.landscape?(e.margin[0],e.margin[2]):(e.margin[0],e.margin[2]),n/i);return this._pagesA100(e,t,100*o)},FamilyTree.prototype._pagesA100=function(e,t,i){var r=FamilyTree._getViewBox(t),a=0,n=0;switch(e.format){case"A5":a=FamilyTree.A5w,n=FamilyTree.A5h;break;case"A4":a=FamilyTree.A4w,n=FamilyTree.A4h;break;case"A3":a=FamilyTree.A3w,n=FamilyTree.A3h;break;case"A2":a=FamilyTree.A2w,n=FamilyTree.A2h;break;case"A1":a=FamilyTree.A1w,n=FamilyTree.A1h;break;case"Letter":a=FamilyTree.Letterw,n=FamilyTree.Letterh;break;case"Legal":a=FamilyTree.Legalw,n=FamilyTree.Legalh}var o=r[0],l=r[1],s=r[2],d=r[3],c={w:e.landscape?n-(e.margin[1]+e.margin[3]):a-(e.margin[1]+e.margin[3]),h:e.landscape?a-(e.margin[0]+e.margin[2]):n-(e.margin[0]+e.margin[2])},m={w:e.landscape?n:a,h:e.landscape?a:n};t.setAttribute("preserveAspectRatio","xMinYMin slice"),t.setAttribute("width",c.w),t.setAttribute("height",c.h);for(var p=c.w*(100/i),h=c.h*(100/i),u=o,y=l,f=[];u<s+o;){for(;y<d+l;){var g=[u,y,p,h];g=g.join(),f.push({vb:g,innerSize:c,size:m}),y+=h}u+=p,y=l}return f},FamilyTree.prototype._defaultExportProfileOptions=function(e,t){return(FamilyTree.isNEU(e)||FamilyTree.isNEU(e.id))&&console.error("options.id is not defilned"),"svg"==t?(e.ext="svg",e.mime="image/svg+xml"):"pdf"==t?(e.mime="application/pdf",e.ext="pdf"):"png"==t&&(e.mime="image/png",e.ext="png"),null==e.margin&&(e.margin=[50,40,50,40]),null==e.padding&&(e.padding=0),null==e.landscape&&(e.landscape=!1),null==e.filename&&(e.filename="Profile."+e.ext),null==e.scale&&(e.scale="fit"),null==e.format&&(e.format="A4"),null==e.header&&(e.header=""),null==e.footer&&(e.footer=""),null==e.openInNewTab&&(e.openInNewTab=!1),null==e.mode&&(e.mode=this.config.mode),e},FamilyTree.prototype._exportProfile=function(e,t){var i=this,r=0,a=0;switch(e.format){case"A5":r=FamilyTree.A5w,a=FamilyTree.A5h;break;case"A4":r=FamilyTree.A4w,a=FamilyTree.A4h;break;case"A3":r=FamilyTree.A3w,a=FamilyTree.A3h;break;case"A2":r=FamilyTree.A2w,a=FamilyTree.A2h;break;case"A1":r=FamilyTree.A1w,a=FamilyTree.A1h;break;case"Letter":r=FamilyTree.Letterw,a=FamilyTree.Letterh;break;case"Legal":r=FamilyTree.Legalw,a=FamilyTree.Legalh}var n={w:e.landscape?a-(e.margin[1]+e.margin[3]):r-(e.margin[1]+e.margin[3]),h:e.landscape?r-(e.margin[0]+e.margin[2]):a-(e.margin[0]+e.margin[2])},o={w:e.landscape?a:r,h:e.landscape?r:a},l=this.editUI.content(e.id,!0,!0,"100%",!0).element;FamilyTree.input.init(l);var s={content:l.outerHTML,options:e,pages:[{vb:"",innerSize:n,size:o}],styles:""};if(!t){if(!1===FamilyTree.events.publish("exportstart",[i,s]))return!1;FamilyTree.loading.show(i)}var d=this.element.querySelector("[data-ba-styles]");d&&(s.styles+=d.outerHTML),s=JSON.stringify(s),FamilyTree._ajax(this.config.exportUrl+"/v3","POST",s,"arraybuffer",(function(r){if(t)t(i,r);else{var a=FamilyTree.events.publish("exportend",[i,r]);if(FamilyTree.loading.hide(i),!1===a)return!1;FamilyTree._downloadFile(e.mime,r,e.filename,e.openInNewTab)}}))},FamilyTree.notifierUI=function(){},FamilyTree.notifierUI.prototype.init=function(e){this.obj=e},FamilyTree.notifierUI.prototype.show=function(e,t){if(null!=e){1==e&&(e=FamilyTree.MAX_NODES_MESS,t="#FFCA28"),2==e&&(e=FamilyTree.OFFLINE_MESS,t="#FFCA28");var i=document.createElement("div");i.innerHTML=e,Object.assign(i.style,{position:"absolute","background-color":t,color:"#ffffff",padding:"15px","border-radius":"40px",opacity:0,overflow:"hidden","white-space":"nowrap","text-align":"center"}),this.obj.element.appendChild(i);var r=this.obj.width()/2-i.offsetWidth/2,a=this.obj.height()/2-i.offsetHeight/2;i.style.left=r+"px",i.style.top=a+"px";var n=i.offsetWidth;i.style.width="20px",FamilyTree.anim(i,{opacity:0,width:10},{opacity:1,width:n},this.obj.config.anim.duration,this.obj.config.anim.func)}},FamilyTree.toolbarUI=function(){},FamilyTree.toolbarUI.expandAllIcon='<svg style="margin-bottom:7px;box-shadow: 0px 1px 4px rgba(0,0,0,0.3); border: 1px solid #cacaca;background-color: #f9f9f9;display: block;cursor: pointer;" width="32px" height="32px"><marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="4" markerHeight="4" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#757575" /></marker><line x1="11" y1="11" x2="6" y2="6" stroke="#757575" stroke-width="2" marker-end="url(#arrow)" /><line x1="21" y1="11" x2="26" y2="6" stroke="#757575" stroke-width="2" marker-end="url(#arrow)" /><line x1="21" y1="21" x2="26" y2="26" stroke="#757575" stroke-width="2" marker-end="url(#arrow)" /><line x1="11" y1="21" x2="6" y2="26" stroke="#757575" stroke-width="2" marker-end="url(#arrow)" /><rect x="12" y="12" width="8" height="8" fill="#757575"></rect></svg>',FamilyTree.toolbarUI.fitIcon='<svg  style="margin-bottom:7px;box-shadow: 0px 1px 4px rgba(0,0,0,0.3); border: 1px solid #cacaca;background-color: #f9f9f9;display: block;cursor: pointer;" width="32px" height="32px"><path stroke-width="3" fill="none" stroke="#757575" d="M4,11 L4,4 L11,4"></path><path stroke-width="3" fill="none" stroke="#757575" d="M28,11 L28,4 L21,4"></path><path stroke-width="3" fill="none" stroke="#757575" d="M28,21 L28,28 L21,28"></path><path stroke-width="3" fill="none" stroke="#757575" d="M4,21 L4,28 L11,28"></path><circle cx="16" cy="16" r="5" fill="#757575"></circle></svg>',FamilyTree.toolbarUI.openFullScreenIcon='<svg  style="margin-bottom:7px;box-shadow: 0px 1px 4px rgba(0,0,0,0.3); border: 1px solid #cacaca;background-color: #f9f9f9;display: block;cursor: pointer;" width="32px" height="32px"><path stroke-width="3" fill="none" stroke="#757575" d="M4,11 L4,4 L11,4"></path><path stroke-width="3" fill="none" stroke="#757575" d="M28,11 L28,4 L21,4"></path><path stroke-width="3" fill="none" stroke="#757575" d="M28,21 L28,28 L21,28"></path><path stroke-width="3" fill="none" stroke="#757575" d="M4,21 L4,28 L11,28"></path><line x1="5" y1="5" x2="27" y2="27" stroke-width="3" stroke="#757575"></line><line x1="5" y1="27" x2="27" y2="5" stroke-width="3" stroke="#757575"></line></svg>',FamilyTree.toolbarUI.closeFullScreenIcon='<svg  style="margin-bottom:7px;box-shadow: 0px 1px 4px rgba(0,0,0,0.3); border: 1px solid #cacaca;background-color: #f9f9f9;display: block;cursor: pointer;" width="32px" height="32px"><path stroke-width="3" fill="none" stroke="#757575" d="M4,11 L4,4 L11,4"></path><path stroke-width="3" fill="none" stroke="#757575" d="M28,11 L28,4 L21,4"></path><path stroke-width="3" fill="none" stroke="#757575" d="M28,21 L28,28 L21,28"></path><path stroke-width="3" fill="none" stroke="#757575" d="M4,21 L4,28 L11,28"></path><rect x="11" y="11" width="10" height="10" stroke-width="3" fill="none" stroke="#757575" ></rect></svg>',FamilyTree.toolbarUI.zoomInIcon='<svg style="box-shadow: 0px 1px 4px rgba(0,0,0,0.3); border-left: 1px solid #cacaca; border-right: 1px solid #cacaca; border-top: 1px solid #cacaca; background-color: #f9f9f9;display: block; cursor: pointer;" width="32px" height="32px" ><g><rect fill="#f9f9f9" x="0" y="0" width="32" height="32" ></rect><line x1="8" y1="16" x2="24" y2="16" stroke-width="3" stroke="#757575"></line><line x1="16" y1="8" x2="16" y2="24" stroke-width="3" stroke="#757575"></line></g><line x1="4" y1="32" x2="28" y2="32" stroke-width="1" stroke="#cacaca"></line></svg>',FamilyTree.toolbarUI.zoomOutIcon='<svg style="box-shadow: 0px 1px 4px rgba(0,0,0,0.3); margin-bottom:7px; border-left: 1px solid #cacaca; border-right: 1px solid #cacaca; border-bottom: 1px solid #cacaca; background-color: #f9f9f9;display: block; cursor: pointer;" width="32px" height="32px" ><g><rect fill="#f9f9f9" x="0" y="0" width="32" height="32" ></rect><line x1="8" y1="16" x2="24" y2="16" stroke-width="3" stroke="#757575"></line></g></svg>',FamilyTree.toolbarUI.layoutIcon="<svg "+FamilyTree.attr.tlbr+'="layout" style="box-shadow: 0px 1px 4px rgba(0,0,0,0.3); border: 1px solid #cacaca;background-color: #f9f9f9;display: block;cursor: pointer;" width="32px" height="32px"><path stroke-width="3" fill="none" stroke="#757575" d="M8,24 L16,14 L24,24"></path><path stroke-width="3" fill="none" stroke="#757575" d="M8,16 L16,8 L24,16"></path></svg>',FamilyTree.toolbarUI.prototype.init=function(e,t){if(t){this.obj=e,this.toolbar=t,this._visible=!1,this.div=document.createElement("div"),this.div.classList.add("bg-toolbar-container"),Object.assign(this.div.style,{position:"absolute",padding:"3px",right:this.obj.config.padding-10+"px",bottom:this.obj.config.padding-10+"px"}),t.expandAll&&(this.div.innerHTML+="<div "+FamilyTree.attr.tlbr+'="expand">'+FamilyTree.toolbarUI.expandAllIcon+"</div>"),t.fit&&(this.div.innerHTML+="<div "+FamilyTree.attr.tlbr+'="fit">'+FamilyTree.toolbarUI.fitIcon+"</div>"),t.zoom&&(this.div.innerHTML+="<div "+FamilyTree.attr.tlbr+'="plus">'+FamilyTree.toolbarUI.zoomInIcon+"</div>",this.div.innerHTML+="<div "+FamilyTree.attr.tlbr+'="minus">'+FamilyTree.toolbarUI.zoomOutIcon+"</div>"),t.layout&&(this.div.innerHTML+="<div "+FamilyTree.attr.tlbr+'="layout">'+FamilyTree.toolbarUI.layoutIcon+"</div>",this.layouts=document.createElement("div"),this.layouts.innerHTML="<svg "+FamilyTree.attr.layout+'="normal" style="cursor: pointer;" width="110" height="100"><rect fill="#039BE5" x="35" y="0" width="50" height="27"></rect><rect fill="#F57C00" x="7" y="41" width="50" height="27"></rect><rect fill="#F57C00" x="63" y="41" width="50" height="27"></rect><line stroke="#000000" x1="60" x2="60" y1="27" y2="35" stroke-width="1"></line><line stroke="#000000" x1="32" x2="88" y1="35" y2="35" stroke-width="1"></line><line stroke="#000000" x1="32" x2="32" y1="35" y2="41" stroke-width="1"></line><line stroke="#000000" x1="88" x2="88" y1="35" y2="41" stroke-width="1"></line></svg><svg '+FamilyTree.attr.layout+'="treeRightOffset" style="cursor: pointer;" width="110" height="100"><rect fill="#039BE5" x="35" y="0" width="50" height="27"></rect><rect fill="#F57C00" x="40" y="41" width="50" height="27"></rect><rect fill="#F57C00" x="40" y="73" width="50" height="27"></rect><line stroke="#000000" x1="60" x2="60" y1="27" y2="35" stroke-width="1"></line><line stroke="#000000" x1="60" x2="35" y1="35" y2="35" stroke-width="1"></line><line stroke="#000000" x1="35" x2="35" y1="35" y2="86" stroke-width="1"></line><line stroke="#000000" x1="35" x2="40" y1="86" y2="86" stroke-width="1"></line><line stroke="#000000" x1="35" x2="40" y1="54" y2="54" stroke-width="1"></line></svg><svg '+FamilyTree.attr.layout+'="treeLeftOffset" style="cursor: pointer;" width="110" height="100"><rect fill="#039BE5" x="35" y="0" width="50" height="27"></rect><rect fill="#F57C00" x="30" y="41" width="50" height="27"></rect><rect fill="#F57C00" x="30" y="73" width="50" height="27"></rect><line stroke="#000000" x1="60" x2="60" y1="27" y2="35" stroke-width="1"></line><line stroke="#000000" x1="60" x2="85" y1="35" y2="35" stroke-width="1"></line><line stroke="#000000" x1="85" x2="85" y1="35" y2="86" stroke-width="1"></line><line stroke="#000000" x1="80" x2="85" y1="86" y2="86" stroke-width="1"></line><line stroke="#000000" x1="80" x2="85" y1="54" y2="54" stroke-width="1"></line></svg><svg '+FamilyTree.attr.layout+'="mixed" style="cursor: pointer;" width="110" height="100"><rect fill="#039BE5" x="35" y="0" width="50" height="27"></rect><rect fill="#F57C00" x="35" y="41" width="50" height="27"></rect><rect fill="#F57C00" x="35" y="73" width="50" height="27"></rect><line stroke="#000000" x1="60" x2="60" y1="27" y2="41" stroke-width="1"></line><line stroke="#000000" x1="60" x2="60" y1="68" y2="73" stroke-width="1"></line></svg><svg '+FamilyTree.attr.layout+'="tree" style="cursor: pointer;" width="110" height="100"><rect fill="#039BE5" x="35" y="0" width="50" height="27"></rect><rect fill="#F57C00" x="7" y="41" width="50" height="27"></rect><rect fill="#F57C00" x="7" y="73" width="50" height="27"></rect><rect fill="#F57C00" x="63" y="41" width="50" height="27"></rect><rect fill="#F57C00" x="63" y="73" width="50" height="27"></rect><line stroke="#000000" x1="60" x2="60" y1="27" y2="86" stroke-width="1"></line><line stroke="#000000" x1="57" x2="63" y1="54" y2="54" stroke-width="1"></line><line stroke="#000000" x1="57" x2="63" y1="86" y2="86" stroke-width="1"></line></svg>',this.obj.element.appendChild(this.layouts),Object.assign(this.layouts.style,{position:"absolute",width:"100%",left:"0",bottom:"-145px","box-shadow":"0px 1px 4px rgba(0,0,0,0.3)","background-color":"#f9f9f9",height:"123px","padding-top":"20px","border-top":"1px solid #cacaca"})),t.fullScreen&&(this.div.innerHTML+="<div "+FamilyTree.attr.tlbr+'="fullScreen">'+FamilyTree.toolbarUI.openFullScreenIcon+"</div>"),this.obj.element.appendChild(this.div),this.layoutBtn=this.div.querySelector("["+FamilyTree.attr.tlbr+'="layout"]');var i=this.div.querySelector("["+FamilyTree.attr.tlbr+'="plus"]'),r=this.div.querySelector("["+FamilyTree.attr.tlbr+'="minus"]'),a=this.div.querySelector("["+FamilyTree.attr.tlbr+'="fit"]'),n=this.div.querySelector("["+FamilyTree.attr.tlbr+'="fullScreen"]'),o=this.div.querySelector("["+FamilyTree.attr.tlbr+'="expand"]'),l=this;i&&i.addEventListener("click",(function(){l.obj.zoom(!0,null,!0)})),r&&r.addEventListener("click",(function(){l.obj.zoom(!1,null,!0)})),a&&a.addEventListener("click",(function(){l.obj.fit()})),n&&n.addEventListener("click",(function(){l.obj.toggleFullScreen()})),o&&o.addEventListener("click",(function(){l.obj.expand(null,"all")})),this.layoutBtn&&this.layoutBtn.addEventListener("click",(function(){l._visible?l.hideLayout():l.showLayout()})),this.layouts&&this.layouts.addEventListener("click",(function(e){for(var t=e.target;t;){if(t.hasAttribute&&t.hasAttribute(FamilyTree.attr.layout)){t=t.getAttribute(FamilyTree.attr.layout),l.obj.setLayout(FamilyTree[t]);break}t=t.parentNode}}))}},FamilyTree.toolbarUI.prototype.showLayout=function(){this._visible=!0,this.layoutBtn.style.transform="rotate(180deg) translateX(0px) translateY(0px)",FamilyTree.anim(this.div,{bottom:this.obj.config.padding-10},{bottom:this.obj.config.padding+135},this.obj.config.anim.duration,this.obj.config.anim.func),FamilyTree.anim(this.layouts,{bottom:-145},{bottom:0},this.obj.config.anim.duration,this.obj.config.anim.func)},FamilyTree.toolbarUI.prototype.hideLayout=function(){this._visible=!1,this.layoutBtn.style.transform="rotate(0deg) translateX(0px) translateY(0px)",FamilyTree.anim(this.div,{bottom:this.obj.config.padding+135},{bottom:this.obj.config.padding-10},this.obj.config.anim.duration,this.obj.config.anim.func),FamilyTree.anim(this.layouts,{bottom:0},{bottom:-145},this.obj.config.anim.duration,this.obj.config.anim.func)},FamilyTree.circleMenuUI=function(){},FamilyTree.circleMenuUI.prototype.init=function(e,t){this.obj=e,this.menu=t,this._menu=null,this._buttonsInterval=[],this._linesInterval=[],this._event_id=FamilyTree._guid()},FamilyTree.circleMenuUI.prototype.show=function(e,t){this._show(e,t)},FamilyTree.circleMenuUI.prototype._show=function(e,t){var i=this,r=this.obj.getNode(e),a=FamilyTree.t(r.templateName,r.min,this.obj.getScale());if(!FamilyTree.isNEU(a.nodeCircleMenuButton)){var n=this.obj.getSvg(),o=this.obj.element.querySelector("["+FamilyTree.attr.control_node_circle_menu_id+'="'+e+'"]'),l=this.obj.getNodeElement(e),s=FamilyTree._getTransform(o),d=FamilyTree._getTransform(l),c=s[4]+d[4],m=s[5]+d[5],p=o.querySelectorAll("line"),h=this.obj.element.querySelector("["+FamilyTree.attr.control_node_circle_menu_wrraper_id+"]");if(FamilyTree.isNEU(h)||h.getAttribute(FamilyTree.attr.control_node_circle_menu_wrraper_id)!=e){this.hide(),t||(t=this.menu);var u={nodeId:e,menu:t},y=FamilyTree.events.publish("show",[this,u]);if(this._menu=t,!1===y)return!1;for(var f=0,g=Object.keys(u.menu).length,b=2*a.nodeCircleMenuButton.radius+4,T=2*Math.PI*b,v=T/g-(2*a.nodeCircleMenuButton.radius+2);v<0;)b+=8,v=(T=2*Math.PI*b)/g-(2*a.nodeCircleMenuButton.radius+2);for(var F in(h=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute(FamilyTree.attr.control_node_circle_menu_wrraper_id,e),h.setAttribute("transform","matrix(1,0,0,1,"+c+","+m+")"),n.appendChild(h),u.menu){var x=u.menu[F].icon,_=u.menu[F].color,w=u.menu[F].text;"function"==typeof x&&(x=x()),"function"==typeof _&&(_=_()),"function"==typeof w&&(w=w());var k=document.createElementNS("http://www.w3.org/2000/svg","g");k.setAttribute("transform","matrix(1,0,0,1,0,0)"),k.setAttribute(FamilyTree.attr.control_node_circle_menu_name,F),k.style.cursor="pointer";var S=document.createElementNS("http://www.w3.org/2000/svg","title");FamilyTree.isNEU(w)||(S.innerHTML=w);var I=document.createElementNS("http://www.w3.org/2000/svg","circle");I.setAttribute("cx",0),I.setAttribute("cy",0),I.setAttribute("r",a.nodeCircleMenuButton.radius),I.setAttribute("fill",_),I.setAttribute("stroke-width","1"),I.setAttribute("stroke",a.nodeCircleMenuButton.stroke),k.appendChild(I),k.appendChild(S),k.innerHTML+=x,h.appendChild(k);var C=k.getElementsByTagName("svg")[0];if(C.setAttribute("pointer-events","none"),C){var A=parseInt(C.getAttribute("width")),N=parseInt(C.getAttribute("height"));C.setAttribute("x",-A/2),C.setAttribute("y",-N/2)}var L=f*Math.PI/(g/2);f++;var M=Math.cos(L)*b,E=Math.sin(L)*b;this._buttonsInterval.push(FamilyTree.anim(k,{transform:[1,0,0,1,0,0]},{transform:[1,0,0,1,M,E]},250,FamilyTree.anim.outBack,(function(e){var t=e[0].getAttribute(FamilyTree.attr.control_node_circle_menu_name),r=e[0].parentNode.getAttribute(FamilyTree.attr.control_node_circle_menu_wrraper_id);e[0].addEventListener("mouseenter",(function(e){FamilyTree.events.publish("mouseenter",[i,{from:r,menuItem:u.menu[t],menuItemName:t,event:e}])})),e[0].addEventListener("mouseout",(function(e){FamilyTree.events.publish("mouseout",[i,{from:r,menuItem:u.menu[t],menuItemName:t,event:e}])}))})))}this._linesInterval.push(FamilyTree.anim(p[0],{x1:-a.nodeCircleMenuButton.radius/2,y1:-6,x2:a.nodeCircleMenuButton.radius/2,y2:-6},{x1:-7,y1:-7,x2:7,y2:7},500,FamilyTree.anim.inOutSin)),this._linesInterval.push(FamilyTree.anim(p[1],{x1:-a.nodeCircleMenuButton.radius/2,y1:0,x2:a.nodeCircleMenuButton.radius/2,y2:0},{x1:0,y1:0,x2:0,y2:0},500,FamilyTree.anim.inOutSin)),this._linesInterval.push(FamilyTree.anim(p[2],{x1:-a.nodeCircleMenuButton.radius/2,y1:6,x2:a.nodeCircleMenuButton.radius/2,y2:6},{x1:-7,y1:7,x2:7,y2:-7},500,FamilyTree.anim.inOutSin))}else this.hide()}},FamilyTree.circleMenuUI.prototype.hide=function(){for(var e=this._buttonsInterval.length-1;e>=0;e--)clearInterval(this._buttonsInterval[e]),this._buttonsInterval.splice(e,1);this._buttonsInterval=[];for(e=this._linesInterval.length-1;e>=0;e--)clearInterval(this._linesInterval[e]),this._linesInterval.splice(e,1);this._linesInterval=[];var t=this.obj.element.querySelector("["+FamilyTree.attr.control_node_circle_menu_wrraper_id+"]");if(null!=t){var i=t.getAttribute(FamilyTree.attr.control_node_circle_menu_wrraper_id),r=this.obj.getNode(i),a=FamilyTree.t(r.templateName,r.min,this.obj.getScale()),n=this.obj.element.querySelector("["+FamilyTree.attr.control_node_circle_menu_id+'="'+i+'"]').querySelectorAll("line");n[0].setAttribute("x1",-a.nodeCircleMenuButton.radius/2),n[0].setAttribute("x2",a.nodeCircleMenuButton.radius/2),n[0].setAttribute("y1",-6),n[0].setAttribute("y2",-6),n[1].setAttribute("x1",-a.nodeCircleMenuButton.radius/2),n[1].setAttribute("x2",a.nodeCircleMenuButton.radius/2),n[1].setAttribute("y1",0),n[1].setAttribute("y2",0),n[2].setAttribute("x1",-a.nodeCircleMenuButton.radius/2),n[2].setAttribute("x2",a.nodeCircleMenuButton.radius/2),n[2].setAttribute("y1",6),n[2].setAttribute("y2",6),t.parentElement.removeChild(t),t=null}},FamilyTree.circleMenuUI.prototype.on=function(e,t){return FamilyTree.events.on(e,t,this._event_id),this},FamilyTree.menuUI=function(){},FamilyTree.menuUI.prototype.init=function(e,t){this.obj=e,this.wrapper=null,this.menu=t,this._event_id=FamilyTree._guid()},FamilyTree.menuUI.prototype.showStickIn=function(e,t,i,r){this._show(e,null,t,i,r)},FamilyTree.menuUI.prototype.show=function(e,t,i,r,a){this._show(e,t,i,r,a)},FamilyTree.menuUI.prototype._show=function(e,t,i,r,a){var n=this;this.hide();var o="";a||(a=this.menu);var l={firstNodeId:i,secondNodeId:r,menu:a};if(!1===FamilyTree.events.publish("show",[this,l]))return!1;for(var s in a=l.menu){var d=a[s].icon,c=a[s].text;void 0===d&&(d=FamilyTree.icon[s](24,24,"#7A7A7A")),"function"==typeof c&&(c=c()),"function"==typeof d&&(d=d()),o+="<div "+FamilyTree.attr.item+'="'+s+'">'+d+"<span>&nbsp;&nbsp;"+c+"</span></div>"}if(""!=o){if(this.wrapper=document.createElement("div"),this.wrapper.className="chart-menu",this.wrapper.style.left="-99999px",this.wrapper.style.top="-99999px",this.wrapper.innerHTML=o,this.obj.element.appendChild(this.wrapper),null==t){var m=FamilyTree._menuPosition(e,this.wrapper,this.obj.getSvg());e=m.x,t=m.y}var p=e+45;this.wrapper.style.left=p+"px",this.wrapper.style.top=t+"px",this.wrapper.style.left=p-this.wrapper.offsetWidth+"px";var h=e-this.wrapper.offsetWidth;FamilyTree.anim(this.wrapper,{opacity:0,left:p-this.wrapper.offsetWidth},{opacity:1,left:h},300,FamilyTree.anim.inOutPow);for(var u=this.wrapper.getElementsByTagName("div"),y=0;y<u.length;y++){(s=u[y]).addEventListener("click",(function(e){var t,o=this.getAttribute(FamilyTree.attr.item);if(void 0===a[o].onClick)if("add"===o){var l={id:n.obj.generateId(),pid:i};n.obj.addNode(l,null,!0)}else if("edit"===o){var s=n.obj.getNode(i);n.obj.editUI.show(s.id)}else if("details"===o){s=n.obj.getNode(i);n.obj.editUI.show(s.id,!0)}else"remove"===o?n.obj.removeNode(i,null,!0):"svg"===o?n.obj.exportSVG({filename:"FamilyTree.svg",expandChildren:!1,nodeId:i}):"pdf"===o?n.obj.exportPDF({filename:"FamilyTree.pdf",expandChildren:!1,nodeId:i}):"png"===o?n.obj.exportPNG({filename:"FamilyTree.png",expandChildren:!1,nodeId:i}):"csv"===o?n.obj.exportCSV():"xml"===o&&n.obj.exportXML();else t=a[o].onClick.call(n.obj,i,r);0!=t&&n.hide()}))}}},FamilyTree.menuUI.prototype.hide=function(){null!=this.wrapper&&(this.obj.element.removeChild(this.wrapper),this.wrapper=null)},FamilyTree.menuUI.prototype.on=function(e,t){return FamilyTree.events.on(e,t,this._event_id),this},FamilyTree.prototype.getSvg=function(){var e=this.element.getElementsByTagName("svg");return e&&e.length?e[0]:null},FamilyTree.prototype.getPointerElement=function(){return this.element.querySelector("g[data-pointer]")},FamilyTree.prototype.getNodeElement=function(e){return this.element.querySelector("g["+FamilyTree.attr.node_id+"='"+e+"']")},FamilyTree.prototype.getMenuButton=function(){return this.element.querySelector("["+FamilyTree.attr.control_export_menu+"]")},FamilyTree.editUI=function(){},FamilyTree.editUI.prototype.init=function(e){this.obj=e,this.fields=null,this._event_id=FamilyTree._guid()},FamilyTree.editUI.prototype.on=function(e,t){return FamilyTree.events.on(e,t,this._event_id),this},FamilyTree.editUI.prototype.show=function(e,t,i){if(this.hide(),!1===FamilyTree.events.publish("show",[this,e]))return!1;var r=this,a=this.content(e,t,i);this.obj.element.appendChild(a.element),FamilyTree.input.init(this.obj.element),i?!t&&a.focusId&&FamilyTree.editUI.ficusElement(a.focusId):this.interval=FamilyTree.anim(a.element,{right:-20,opacity:0},{right:0,opacity:1},300,FamilyTree.anim.outSin,(function(){!t&&a.focusId&&FamilyTree.editUI.ficusElement(a.focusId)})),this.obj.element.querySelector("[data-edit-from-close]").addEventListener("click",(function(e){r.hide()})),this.obj.element.querySelector("[data-edit-from-cancel]").addEventListener("click",(function(e){r.hide()})),this.obj.element.querySelector("[data-edit-from-save]").addEventListener("click",(function(t){var i=FamilyTree.input.validateAndGetData(a.element);if(!1!==i){var n=r.obj.get(e),o=FamilyTree.mergeDeep(n,i);r.obj.updateNode(o,null,!0),r.hide()}}));for(var n=this.obj.element.querySelectorAll("[ba-input-btn]"),o=0;o<n.length;o++){n[o].addEventListener("click",(function(t){FamilyTree.events.publish("element-btn-click",[r,{input:this.parentNode.querySelector("input"),nodeId:e}])}))}this.obj.element.querySelector("[data-add-more-fields-btn]").addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault();var t=this,i=FamilyTree.elements.textbox({},{type:"textbox",label:r.obj.config.editForm.addMoreFieldName,btn:r.obj.config.editForm.addMoreBtn},"280px");t.parentNode.insertAdjacentHTML("beforebegin",i.html),t.style.display="none",FamilyTree.input.init(t.parentNode.previousSibling);var a=document.getElementById(i.id);a.focus(),a.nextElementSibling.addEventListener("click",(function(e){e.stopPropagation(),e.preventDefault();var i=r.obj.element.querySelector('[data-binding="'+a.value+'"]');if(FamilyTree.isNEU(a.value)||i)a.focus();else{var n=FamilyTree.elements.textbox({},{type:"textbox",label:a.value,binding:a.value},"280px");a.parentNode.parentNode.parentNode.removeChild(a.parentNode.parentNode),t.parentNode.insertAdjacentHTML("beforebegin",n.html),t.style.display="",FamilyTree.input.init(t.parentNode.previousSibling),document.getElementById(n.id).focus()}}))})),this.obj.element.querySelector("[data-edit-from-btns]").addEventListener("click",(function(t){for(var i=t.target;i&&i.hasAttribute&&!i.hasAttribute("data-edit-from-btn");)i=i.parentNode;if(i&&i.hasAttribute){var n=i.getAttribute("data-edit-from-btn"),o={button:r.obj.config.editForm.buttons[n],name:n,nodeId:e,event:t};if(!1===FamilyTree.events.publish("button-click",[r,o]))return!1;switch(n){case"edit":r.obj.editUI.show(e,!1,!0);break;case"pdf":r.obj.exportPDFProfile({id:e,filename:a.title}),r.hide();break;case"png":r.obj.exportPNGProfile({id:e,filename:a.title}),r.hide();break;case"share":r.obj.shareProfile(e);break;case"remove":r.obj.removeNode(e),r.hide()}}}))},FamilyTree.editUI.ficusElement=function(e){if(!FamilyTree.isNEU(e)){var t=document.getElementById(e);t&&(t.focus(),t.value&&t.value.length&&(t.selectionStart=t.selectionEnd=t.value.length))}},FamilyTree.editUI.prototype.content=function(e,t,i,r,a){var n,o=this.obj.config.editForm.readOnly,l=JSON.parse(JSON.stringify(this.obj.config.editForm.elements)),s=this.obj.config.editForm.addMore,d=this.obj.config.editForm.buttons,c=this.obj.config.editForm.titleBinding,m=this.obj.config.editForm.photoBinding,p=this.obj.getNode(e),h=this.obj._get(e),u=FamilyTree.t(p.templateName,p.min,this.obj.getScale()),y=h[c],f=h[m];if(this.obj.config.editForm.generateElementsFromFields)for(var g=0;g<this.fields.length;g++){var b=this.fields[g];if("tags"!=b){for(var T=!1,v=0;v<l.length;v++){if(Array.isArray(l[v])){for(var F=0;F<l[v].length;F++)if(b==l[v][F].binding){T=!0;break}}else if(b==l[v].binding){T=!0;break}if(T)break}T||l.push({type:"textbox",label:b,binding:b})}}FamilyTree.isNEU(y)&&(y=""),f=FamilyTree.isNEU(f)?FamilyTree.icon.user(150,150,"#8C8C8C",0,0):`<img style="width: 100%;height:100%;border-radius: 50%;" src="${f}"></img>`;var x=!t,_=t?"display:none;":"",w=t||!s?"display:none;":"",k=u.editFormHeaderColor?`style="background-color:${u.editFormHeaderColor};"`:"",S=document.createElement("div");if(S.setAttribute("data-edit-form",""),S.classList.add("edit-form"),S.classList.add(this.obj.config.mode),S.classList.add(p.templateName),Array.isArray(p.tags)&&p.tags.length)for(g=0;g<p.tags.length;g++)S.classList.add(p.tags[g]);S.style.display="flex",S.style.opacity=i?1:0,S.style.right=i?0:"-20px",r&&(S.style.width=r);var I=[],C=a?"":'<svg data-edit-from-close class="edit-form-close"><path style="fill:#ffffff;" d="M21.205,5.007c-0.429-0.444-1.143-0.444-1.587,0c-0.429,0.429-0.429,1.143,0,1.571l8.047,8.047H1.111 C0.492,14.626,0,15.118,0,15.737c0,0.619,0.492,1.127,1.111,1.127h26.554l-8.047,8.032c-0.429,0.444-0.429,1.159,0,1.587 c0.444,0.444,1.159,0.444,1.587,0l9.952-9.952c0.444-0.429,0.444-1.143,0-1.571L21.205,5.007z"></path></svg>';return S.innerHTML=`<div>\n                        <div class="edit-form-header" ${k}>\n                            ${C}\n                            <h1 class="edit-form-title">${y}</h1>\n                            <div class="edit-form-avatar">${f}</div>                        \n                        </div>\n                        <div data-edit-from-btns class="edit-form-instruments">\n                        ${function(){if(a)return"";var e="";for(var i in d){var r=d[i];FamilyTree.isNEU(r)||(x&&r.hideIfEditMode||t&&r.hideIfDetailsMode||o&&r.hideIfDetailsMode||(e+=`<div data-edit-from-btn='${i}' class="ba-img-button" ${k} title="${r.text}">${r.icon}</div>`))}return e}()}    \n                        </div>\n                    </div>\n                    <div class="edit-form-fields">\n                        <div class="edit-form-fields-inner">\n                            <div class="ba-form-fieldset">\n                                ${function(){for(var e="",i=0;i<l.length;i++){var r=l[i];if(Array.isArray(r)){e+='<div class="ba-form-field-100 ba-form-fieldset">';for(var a=0;a<r.length;a++){var o=r[a],s=FamilyTree.elements[o.type](h,o,"unset",t);!FamilyTree.isNEU(s.id)&&FamilyTree.isNEU(n)&&FamilyTree.isNEU(s.value)&&(n=s.id),FamilyTree.isNEU(s.value)||I.push(`${o.label}: ${s.value}`),e+=s.html}e+="</div>"}else{s=FamilyTree.elements[r.type](h,r,"280px",t);!FamilyTree.isNEU(s.id)&&FamilyTree.isNEU(n)&&FamilyTree.isNEU(s.value)&&(n=s.id),FamilyTree.isNEU(s.value)||I.push(`${r.label}: ${s.value}`),e+=s.html}}return e}()}\n\n                                <div class="ba-form-field" style="min-width: 280px; text-align:center; ${w}">\n                                    <a data-add-more-fields-btn href="#" class="ba-link">${s}</a>\n                                </div>\n                            </div>        \n                        </div>\n                    </div>\n                    <div class="ba-form-fieldset" style="padding: 14px 10px; ${_}">\n                        <div class="ba-form-field" style="min-width: initial;">\n                            <button data-edit-from-cancel type="button" class="ba-button transparent">Cancel</button>\n                        </div>\n                        <div class="ba-form-field" style="min-width: initial;">\n                            <button data-edit-from-save type="button" class="ba-button">Save and close</button>\n                        </div>\n                    </div>`,{element:S,focusId:n,title:y,shareText:I.join("\n")}},FamilyTree.editUI.prototype.hide=function(){if(!1===FamilyTree.events.publish("hide",[this]))return!1;FamilyTree.isNEU(this.interval)&&(clearInterval(this.interval),this.interval=null);var e=this.obj.element.querySelector("[data-edit-form]");e&&e.parentNode&&e.parentNode.removeChild(e)},FamilyTree._intersects=function(e,t,i){var r=e.x-i.siblingSeparation/4,a=e.y,n=e.x+e.w+i.siblingSeparation/4,o=e.y;switch(i.orientation){case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:r=e.x,a=e.y-i.siblingSeparation/4,n=e.x,o=e.y+e.h+i.siblingSeparation/4}var l,s,d,c=t.p,m=t.q,p=t.r,h=t.s;return 0!==(l=(n-r)*(h-m)-(p-c)*(o-a))&&(s=((a-o)*(p-r)+(n-r)*(h-a))/l,0<(d=((h-m)*(p-r)+(c-p)*(h-a))/l)&&d<1&&0<s&&s<1)},FamilyTree._addPoint=function(e,t,i,r,a){switch(i.orientation){case FamilyTree.orientation.top:case FamilyTree.orientation.top_left:return FamilyTree._addPointTop(e,t,i,r,a);case FamilyTree.orientation.bottom:case FamilyTree.orientation.bottom_left:return FamilyTree._addPointBottom(e,t,i,r,a);case FamilyTree.orientation.left:case FamilyTree.orientation.left_top:return FamilyTree._addPointLeft(e,t,i,r,a);case FamilyTree.orientation.right:case FamilyTree.orientation.right_top:return FamilyTree._addPointRight(e,t,i,r,a)}},FamilyTree._addPointTop=function(e,t,i,r,a){var n,o,l;return"left"==a?n=e.leftNeighbor?e.x+(e.leftNeighbor.x+e.leftNeighbor.w-e.x)/2:e.x-i.siblingSeparation/2:"right"==a&&(n=e.rightNeighbor?e.x+e.w+(e.rightNeighbor.x-(e.x+e.w))/2:e.x+e.w+i.siblingSeparation/2),t.push([n,t[t.length-1][1]]),t.push([n,e.y-i.levelSeparation/3]),o=t[t.length-1][1],l=n,r.p=n,r.q=o,r.r=l,r},FamilyTree._addPointBottom=function(e,t,i,r,a){var n,o,l;return"left"==a?n=e.leftNeighbor?e.x+(e.leftNeighbor.x+e.leftNeighbor.w-e.x)/2:e.x-i.siblingSeparation/2:"right"==a&&(n=e.rightNeighbor?e.x+e.w+(e.rightNeighbor.x-(e.x+e.w))/2:e.x+e.w+i.siblingSeparation/2),t.push([n,t[t.length-1][1]]),t.push([n,e.y+e.h+i.levelSeparation/3]),o=t[t.length-1][1],l=n,r.p=n,r.q=o,r.r=l,r},FamilyTree._addPointLeft=function(e,t,i,r,a){var n,o=t[t.length-1][0];return"bottom"==a?n=e.rightNeighbor?e.y+e.h+(e.rightNeighbor.y-(e.y+e.h))/2:e.y+e.h+i.siblingSeparation/2:"top"==a&&(n=e.leftNeighbor?e.y+(e.leftNeighbor.y+e.leftNeighbor.h-e.y)/2:e.y-i.siblingSeparation/2),t.push([t[t.length-1][0],n]),t.push([e.x-i.levelSeparation/3,n]),o=t[t.length-1][0],s=n,r.p=o,r.q=n,r.s=s,r},FamilyTree._addPointRight=function(e,t,i,r,a){var n,o=t[t.length-1][0];return"bottom"==a?n=e.rightNeighbor?e.y+e.h+(e.rightNeighbor.y-(e.y+e.h))/2:e.y+e.h+i.siblingSeparation/2:"top"==a&&(n=e.leftNeighbor?e.y+(e.leftNeighbor.y+e.leftNeighbor.h-e.y)/2:e.y-i.siblingSeparation/2),t.push([t[t.length-1][0],n]),t.push([e.x+e.w+i.levelSeparation/3,n]),o=t[t.length-1][0],s=n,r.p=o,r.q=n,r.s=s,r},void 0===FamilyTree&&(FamilyTree={}),FamilyTree.prototype._attachInitEventHandlers=function(e){this._addEvent(window,"resize",this._resizeHandler)},FamilyTree.prototype._attachEventHandlers=function(e){e=this.getSvg();var t=/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1;this.config.enableTouch||t||/Mobi/i.test(navigator.userAgent)||/Android/i.test(navigator.userAgent)?(this._addEvent(e,"touchstart",this._globalMouseDownHandler),this._addEvent(e,"touchend",this._globalClickHandler)):(this._addEvent(e,"mousedown",this._globalMouseDownHandler),this._addEvent(e,"click",this._globalClickHandler),this._addEvent(e,"contextmenu",this._globalContextHandler),this._addEvent(e,"dblclick",this._globalDbClickHandler),this.config.mouseScrool!=FamilyTree.action.zoom&&this.config.mouseScrool!=FamilyTree.action.ctrlZoom||(this._addEvent(e,"DOMMouseScroll",this._mouseScrollHandler),this._addEvent(e,"mousewheel",this._mouseScrollHandler)));var i=this.getMenuButton();i&&this._addEvent(i,"click",this._menuClickHandler)},FamilyTree.prototype._addEvent=function(e,t,i,r){var a,n;(r||(r=""),e.getListenerList||(e.getListenerList={}),e.getListenerList[t+r])||(a=this,n=i,i=function(){if(n)return n.apply(a,[this,arguments[0]])},e.addEventListener?"mousewheel"==t?e.addEventListener(t,o,{passive:!1}):e.addEventListener(t,o,!1):e.attachEvent("on"+t,(function(){var t=i.call(e,window.event);return!1===t&&(window.event.returnValue=!1,window.event.cancelBubble=!0),t})),e.getListenerList[t+r]=o);function o(e){var t=i.apply(this,arguments);return!1===t&&(e.stopPropagation(),e.preventDefault()),t}},FamilyTree.prototype._removeEvent=function(e,t){if(e.getListenerList[t]){var i=e.getListenerList[t];e.removeEventListener(t,i,!1),delete e.getListenerList[t]}},void 0===FamilyTree&&(FamilyTree={}),FamilyTree.anim=function(e,t,i,r,a,n,o){var l,s=10,d=1,c=r/s+1;document.getElementsByTagName("g");return Array.isArray(e)||(e=[e]),Array.isArray(t)||(t=[t]),Array.isArray(i)||(i=[i]),l=setInterval((function(){for(var m=0;m<e.length;m++)for(var p in i[m]){var h=FamilyTree._arrayContains(["top","left","right","bottom","width","height"],p.toLowerCase())?"px":"";switch(p.toLowerCase()){case"d":var u=a((d*s-s)/r)*(i[m][p][0]-t[m][p][0])+t[m][p][0],y=a((d*s-s)/r)*(i[m][p][1]-t[m][p][1])+t[m][p][1];e[m].setAttribute("d",e[m].getAttribute("d")+" L"+u+" "+y);break;case"r":var f=a((d*s-s)/r)*(i[m][p]-t[m][p])+t[m][p];e[m].setAttribute("r",f);break;case"x1":f=a((d*s-s)/r)*(i[m][p]-t[m][p])+t[m][p];e[m].setAttribute("x1",f);break;case"x2":f=a((d*s-s)/r)*(i[m][p]-t[m][p])+t[m][p];e[m].setAttribute("x2",f);break;case"y1":f=a((d*s-s)/r)*(i[m][p]-t[m][p])+t[m][p];e[m].setAttribute("y1",f);break;case"y2":f=a((d*s-s)/r)*(i[m][p]-t[m][p])+t[m][p];e[m].setAttribute("y2",f);break;case"rotate3d":if(i[m][p]){var g=t[m][p],b=i[m][p],T=[0,0,0,0];for(var v in g)T[v]=a((d*s-s)/r)*(b[v]-g[v])+g[v];e[m].style.transform="rotate3d("+T.toString()+"deg)"}break;case"transform":if(i[m][p]){g=t[m][p],b=i[m][p],T=[0,0,0,0,0,0];for(var v in g)T[v]=a((d*s-s)/r)*(b[v]-g[v])+g[v];e[m].hasAttribute("transform")?e[m].setAttribute("transform","matrix("+T.toString()+")"):e[m].style.transform="matrix("+T.toString()+")"}break;case"viewbox":if(i[m][p]){g=t[m][p],b=i[m][p],T=[0,0,0,0];for(var v in g)T[v]=a((d*s-s)/r)*(b[v]-g[v])+g[v];e[m].setAttribute("viewBox",T.toString())}break;case"margin":if(i[m][p]){g=t[m][p],b=i[m][p],T=[0,0,0,0];for(var v in g)T[v]=a((d*s-s)/r)*(b[v]-g[v])+g[v];var F="";for(v=0;v<T.length;v++)F+=parseInt(T[v])+"px ";e[m]&&e[m].style&&(e[m].style[p]=F)}break;case"scrolly":f=a((d*s-s)/r)*(i[m][p]-t[m][p])+t[m][p];e[m].scrollTo(0,f);break;default:f=a((d*s-s)/r)*(i[m][p]-t[m][p])+t[m][p];e[m]&&e[m].style&&(e[m].style[p]=f+h)}}o&&o(),(d+=1)>c+1&&(clearInterval(l),n&&n(e))}),s)},FamilyTree.anim.inPow=function(e){return e<0?0:e>1?1:Math.pow(e,2)},FamilyTree.anim.outPow=function(e){if(e<0)return 0;if(e>1)return 1;return-1*(Math.pow(e-1,2)+-1)},FamilyTree.anim.inOutPow=function(e){if(e<0)return 0;if(e>1)return 1;if((e*=2)<1)return FamilyTree.anim.inPow(e,2)/2;return-.5*(Math.pow(e-2,2)+-2)},FamilyTree.anim.inSin=function(e){return e<0?0:e>1?1:1-Math.cos(e*(Math.PI/2))},FamilyTree.anim.outSin=function(e){return e<0?0:e>1?1:Math.sin(e*(Math.PI/2))},FamilyTree.anim.inOutSin=function(e){return e<0?0:e>1?1:-.5*(Math.cos(Math.PI*e)-1)},FamilyTree.anim.inExp=function(e){return e<0?0:e>1?1:Math.pow(2,10*(e-1))},FamilyTree.anim.outExp=function(e){return e<0?0:e>1?1:1-Math.pow(2,-10*e)},FamilyTree.anim.inOutExp=function(e){return e<0?0:e>1?1:e<.5?.5*Math.pow(2,10*(2*e-1)):.5*(2-Math.pow(2,10*(-2*e+1)))},FamilyTree.anim.inCirc=function(e){return e<0?0:e>1?1:-(Math.sqrt(1-e*e)-1)},FamilyTree.anim.outCirc=function(e){return e<0?0:e>1?1:Math.sqrt(1-(e-1)*(e-1))},FamilyTree.anim.inOutCirc=function(e){return e<0?0:e>1?1:e<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(2*e-2)*(2*e-2))+1)},FamilyTree.anim.rebound=function(e){return e<0?0:e>1?1:e<1/2.75?1-7.5625*e*e:e<2/2.75?1-(7.5625*(e-1.5/2.75)*(e-1.5/2.75)+.75):e<2.5/2.75?1-(7.5625*(e-2.25/2.75)*(e-2.25/2.75)+.9375):1-(7.5625*(e-2.625/2.75)*(e-2.625/2.75)+.984375)},FamilyTree.anim.inBack=function(e){return e<0?0:e>1?1:e*e*(2.70158*e-1.70158)},FamilyTree.anim.outBack=function(e){return e<0?0:e>1?1:(e-1)*(e-1)*(2.70158*(e-1)+1.70158)+1},FamilyTree.anim.inOutBack=function(e){return e<0?0:e>1?1:e<.5?4*e*e*(7.1898*e-2.5949)*.5:.5*((2*e-2)*(2*e-2)*(3.5949*(2*e-2)+2.5949)+2)},FamilyTree.anim.impulse=function(e){var t=2*e;return t*Math.exp(1-t)},FamilyTree.anim.expPulse=function(e){return Math.exp(-2*Math.pow(e,2))},void 0===FamilyTree&&(FamilyTree={}),FamilyTree._ajax=function(e,t,i,r,a){null==r&&(r="arraybuffer");var n=new XMLHttpRequest;n.onload=function(e){4==n.readyState&&200===this.status&&(null==e.target?a(this.response):a(e.target.response))},n.onerror=function(e){a({error:e})},n.open(t,e),n.responseType=r,n.setRequestHeader("Content-Type","application/json"),null==i?n.send():n.send(i)},FamilyTree.localStorage={},FamilyTree.localStorage.getItem=function(e){return localStorage.getItem(e)},FamilyTree.localStorage.setItem=function(e,t){try{localStorage.setItem(e,t)}catch(e){e.code==e.QUOTA_EXCEEDED_ERR?(console.warn("Local storage quota exceeded"),localStorage.clear()):(console.error("Local storage error code:"+e.code),console.error(e))}};export default FamilyTree;